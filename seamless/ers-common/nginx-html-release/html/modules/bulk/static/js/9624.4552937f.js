(self.webpackChunk_unified_bulk=self.webpackChunk_unified_bulk||[]).push([[9624],{4579:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(4315),r=n(2411),l=n.n(r),i=n(9971);const o=function(e){var t=l().useState(null),n=(0,a.Z)(t,2),r=n[0],o=n[1],c=(0,i.useSelector)((function(e){var t;return null==e||null===(t=e.auth)||void 0===t?void 0:t.rbac}),i.shallowEqual);return l().useEffect((function(){var t,n=(null===(t=c.features.find((function(t){return t.module===e})))||void 0===t?void 0:t.features)||[];o(n)}),[c]),r}},4442:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Ce});var a=n(2411),r=n.n(a),l=n(8049),i=n(1746),o=n(4315),c=n(1262),s=n(4614),u=n(5696),m=n(1416);const d=n.n(m)();var f=n(7814),p=n.n(f),v=n(4126),g=function(e){return d("/bss/v1/import/".concat(parseInt(e),"/info?verbose=true"))},h=function(e){return d("/bss/v1/batch/".concat(e,"/status"))},E=function(e){return d(e)},b=(0,u.makeStyles)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}}));const w=function(e){var t=e.children,n=b(),r=a.useState([]),l=(0,o.Z)(r,2),u=l[0],m=l[1],f=a.useState(!1),p=(0,o.Z)(f,2),v=p[0],g=p[1];return a.useEffect((function(){g(!0),d("/bss/v1/import/service/info").then((function(e){if(e.serviceInfo&&0!==e.serviceInfo.length){var t=(0,i.Z)(u);e.serviceInfo.map((function(e){"CX"!==(null==e?void 0:e.importService)&&e.importType.map((function(n){"Inventory"===(null==e?void 0:e.importService)&&"Generic"===n||"Reseller"===(null==e?void 0:e.importService)&&"Generic"===n||t.push({value:"".concat(e.importService,"_").concat(n),key:"".concat(e.importService," ").concat(n)})}))})),m(t)}})).finally((function(){return g(!1)}))}),[]),a.createElement(a.Fragment,null,v?a.createElement(c.Z,{className:n.backdrop,open:v},a.createElement(s.Z,{color:"inherit"})):t({subTypeOptions:u,loading:v}))};var y=n(3135),x=n(7114),S=n(905),Z=n(3553),I=n(4276),N=n(436),T=n(6689),k=n(4297),C=n(9692),B=n(2420),D=n(9971),F=n(3248);const R=function(){var e=(0,F.useSnackbar)().enqueueSnackbar,t=(0,y.useTranslation)().t;function n(e){var n=t("anErrorOccurred");return["resultMessage","message","resultDescription"].forEach((function(t){e.hasOwnProperty(t)&&(n=e[t])})),n}return{showSuccessMessage:function(t){e("string"!=typeof t?n(t):t,{variant:"success"})},showErrorMessage:function(t){e("string"!=typeof t?n(t):t,{variant:"error"})},showInfoMessage:function(t){e("string"!=typeof t?n(t):t,{variant:"info"})},showWarningMessage:function(t){e("string"!=typeof t?n(t):t,{variant:"warning"})}}};var V=(0,C.Z)((function(e){return(0,B.Z)({elements:{marginRight:e.spacing(1)},input:{marginLeft:e.spacing(1),flex:1},uploadBox:{marginTop:e.spacing(2),minWidth:"120px"},Btn:{marginLeft:e.spacing(2)},BtnWrapper:{marginTop:e.spacing(2),display:"flex",alignItems:"center",justifyContent:"flex-start"},uploadInput:{display:"flex",alignItems:"center","& #seamless-unified-upload":{border:"2px solid ".concat(e.palette.success.main),borderRadius:"8px"},"& .file-details":{marginLeft:"10px",padding:"10px",border:"1px solid #e0dfdf",borderRadius:"8px","& span":{fontSize:"14px"}}},uploadIcon:{fontSize:50},box:{color:e.palette.grey[600],transition:"all 0.2s ease-in","&:hover":{background:e.palette.grey[100],color:e.palette.secondary.main}},button:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",alignContent:"center",width:"100%"},flexAlignEnd:{display:"flex",alignItems:"end"},linkClass:{marginTop:"30px",marginLeft:"20px",cursor:"pointer"},sampleGrid:{marginLeft:"120px"}})})),M="",A={campaign:"/home/campaign/campaigns"};const O=function(e){var t,n,c,u,m,f=e.subTypeOptions,g=(e.loading,(0,y.useTranslation)().t),h=(0,l.useHistory)(),E=new URLSearchParams(window.location.search),b=V(),w=(0,a.useState)(!1),C=(0,o.Z)(w,2),B=C[0],F=C[1],O=(0,a.useState)(!1),_=(0,o.Z)(O,2),z=_[0],P=_[1],L=(0,a.useState)(""),j=(0,o.Z)(L,2),U=j[0],H=j[1],W=(0,a.useState)(""),q=(0,o.Z)(W,2),G=q[0],K=q[1],J=(0,l.useHistory)(),Y=(0,D.useSelector)((function(e){return e.auth.user})).userId,Q=R(),X=Q.showErrorMessage,$=Q.showSuccessMessage,ee=(0,a.useState)(!1),te=(0,o.Z)(ee,2),ne=te[0],ae=te[1];r().useEffect((function(){M=E.get("source")||""}),[]);var re=window.config.bulk.bulkImportFileExtension||["csv"],le=null!==(t=null===(n=window.config)||void 0===n||null===(c=n.bulk)||void 0===c?void 0:c.failOnError)&&void 0!==t&&t,ie=(null===(u=window.config)||void 0===u||null===(m=u.bulk)||void 0===m?void 0:m.importSubTypeOptions)||{},oe=(0,x.TA)({initialValues:{importSubType:{type:"",value:"",originalVal:""},importFile:null},onSubmit:function(e){var t,n,a=e.importSubType.type,r=e.importSubType.value,l=new FormData;l.append("file",e.importFile,e.importFile.name),l.append("metainformation",new Blob([JSON.stringify({failOnError:le,scheduler:{scheduledAt:(new Date).toISOString(),schedulerType:"immediate"},uploadedBy:Y,description:"Import request"})],{type:"application/json"})),function(e,t,n,a){var r={importSubType:t};F(!0),function(e,t,n,a){var r=new Headers;r.append("authorization",localStorage.getItem("token")||""),r.append("Accept-Language","en-US;en-IN;q=0.9,en-US;q=0.7,en-GB;q=0.6");var l={method:"POST",headers:r,body:e,redirect:"follow"},i=a?"/api/bss/v1/import/".concat(t,"?").concat(v.stringify(n)):"/api/bss/v1/import/".concat(t),o="".concat(p().protocol,"://").concat(p().server,":").concat(p().port).concat(i);return fetch(o,l).then((function(e){var t=e.headers.get("authorization");return t&&localStorage.setItem("token",t),e.json()}))}(e,n,r,a).then((function(e){var t;e.batchInfo&&e.batchInfo.length?($(e.resultMessage),J.push("/home/bulk/imports/view/".concat(null===(t=e.batchInfo[0])||void 0===t?void 0:t.batchId))):X(e.resultMessage||g("fileCheckError"))})).catch((function(e){return X(e.resultMessage||e.resultDescription||g("anErrorOccurred"))})).finally((function(){F(!1),ae(!1)}))}(l,r,null===(t=ie[a])||void 0===t?void 0:t.type,null===(n=ie[a])||void 0===n?void 0:n.hasQueryParam)},enableReinitialize:!0}),ce=oe.values,se=oe.handleChange,ue=oe.handleSubmit,me=oe.setFieldValue,de=r().useCallback((function(e){(function(e){return d("/osm/v1/resource/samples/".concat(e,".csv?disposition=attachment"))})(e).then((function(t){t.resultCode?X(t.resultDescription):function(e,t){var n=[];n.push(e);var a=window.URL.createObjectURL(new Blob(n,{type:"application/csv"})),r=document.createElement("a");r.href=a,r.download=t||"download",r.click()}(t,"".concat(e,".csv"))})).catch((function(e){return X(e)}))}),[]),fe=window.config.bulk.exportSample;return r().createElement(k.SeamlessContainer,{title:g("newImportPageTitle"),description:g("newImportPageDescription")},r().createElement(r().Fragment,null,r().createElement(Z.Z,{id:"import-subtype-box",display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"flex-end"},r().createElement(k.SeamlessDropDown,{className:b.elements,value:ce.importSubType.originalVal,id:"importSubType",name:"importSubType",label:g("importSubType"),options:[{value:" ",key:"All Types"}].concat((0,i.Z)(f)),onChange:function(e){se(e),function(e){var t=e.target.value.split(/_(.+)/);t&&t.includes("RateCard")?(H("/files/sample_ratecard.csv"),K("sample_ratecard.csv"),P(!0)):t&&t.includes("Trackable_Inventory_Safaricom_Update")?(H("/files/sample_trackablee.csv"),K("sample_trackablee.csv"),P(!0)):t&&t.includes("Serialized_Inventory_Safaricom_Update")?(H("/files/sample_serialized.csv"),K("sample_serialized.csv"),P(!0)):(P(!1),H(""),K("")),me("importSubType",{type:t[0],value:t[1],originalVal:e.target.value})}(e)}})),ce.importSubType.originalVal&&r().createElement(r().Fragment,null,r().createElement(S.Z,{item:!0,xs:6,sm:3,className:b.flexAlignEnd},r().createElement(Z.Z,{id:"new-import-form-fields",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",className:b.uploadBox},r().createElement("div",{className:ce.importFile?b.uploadInput:""},r().createElement("input",{name:"new-import-upload",accept:"image/*, application/pdf, .xlsx, .ods, .doc, .docx, .csv",id:"new-import-upload",type:"file",hidden:!0,onChange:function(e){!function(e){se(e),me("importFile",e.target.files[0]);var t=e.target.files[0].type.split("/")[1];re.includes(t)?ae(!1):(X(g("improperFileFormat")),ae(!0))}(e)}}),r().createElement("label",{htmlFor:"new-import-upload"},r().createElement("span",{id:"seamless-unified-upload",className:b.button},r().createElement(Z.Z,{className:b.box,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",pr:2,pl:2,borderRadius:6,borderColor:"grey.200",border:2},r().createElement(I.Z,{className:b.uploadIcon,fontSize:"large",color:"inherit"},"file_upload"),r().createElement(N.Z,{gutterBottom:!0,variant:"caption"},g("importCSV"))))),r().createElement("div",{className:"file-details"},r().createElement("span",null,ce.importFile&&ce.importFile.name?"File name: ".concat(ce.importFile.name):""))))),r().createElement(S.Z,{item:!0,xs:6,sm:3,className:b.sampleGrid},z&&r().createElement(T.Z,{className:b.linkClass,onClick:function(e){return(t=document.createElement("a")).setAttribute("href",U),t.setAttribute("download",G),document.body.appendChild(t),void t.click();var t}},"Download sample file"),fe&&r().createElement(T.Z,{className:b.linkClass,onClick:function(e){return de(ce.importSubType.originalVal)}},"Download sample File"))),r().createElement("div",{className:b.BtnWrapper},ce.importSubType.originalVal&&r().createElement(r().Fragment,null,r().createElement(k.SeamlessButton,{disabled:ne,onClick:function(e){return ue()},id:"submit-import",variant:"contained",color:"primary"},g("submitButton"),B&&r().createElement(s.Z,{color:"inherit",size:14,thickness:6,style:{marginLeft:"8px"}}))),r().createElement(k.SeamlessButton,{onClick:function(){var e=A[M];e?h.push(e):h.goBack()},id:"cancel-import",variant:"contained",color:"primary",className:b.Btn},g("cancelBtn")))))},_=function(){return a.createElement(w,null,(function(e){return a.createElement(O,e)}))};var z=n(8896);const P=function(e){var t=e.disable,n=void 0!==t&&t;return a.createElement(k.SeamlessButton,{component:l.Link,to:"/home/bulk/imports/new",variant:"contained",color:"primary",disabled:n,endIcon:a.createElement(z.Z,null)},"Submit New Import")};var L=n(6470),j=n(7162),U=n.n(j),H=(0,u.makeStyles)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}}));const W=function(e){var t=e.children,n=H(),r=a.useState(),i=(0,o.Z)(r,2),u=i[0],m=i[1],d=a.useState([]),f=(0,o.Z)(d,2),p=f[0],v=f[1],E=a.useState(!0),b=(0,o.Z)(E,2),w=b[0],y=b[1],x=(0,l.useParams)().batchId,S=a.useState([]),Z=(0,o.Z)(S,2),I=Z[0],N=Z[1],T=a.useState([]),k=(0,o.Z)(T,2),C=k[0],B=k[1],D=function(){var e=(0,L.Z)(U().mark((function e(){var t;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),t="",e.next=4,h(x).then((function(e){var n,a=[];e.batchInfo&&e.batchInfo.map((function(e,t){e.index=t,a.push(e)})),N(a),t=null==e||null===(n=e.batchInfo[0])||void 0===n?void 0:n.importId,B(null==e?void 0:e.batchInfo[(null==e?void 0:e.batchInfo.length)-1])})).catch((function(e){null==e||e.resultCode}));case 4:return e.next=6,g(t).then((function(e){m(e.importInfo),v(e.batchInfo)})).finally((function(){return y(!1)}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a.useEffect((function(){D()}),[]),a.createElement(a.Fragment,null,w?a.createElement(c.Z,{className:n.backdrop,open:w},a.createElement(s.Z,{color:"inherit"})):t({batchInfo:p,importInfo:u,loading:w,batchInfoData:I,setBatchInfoData:N,dynamicImportInfo:C,setDynamicImportInfo:B}))};var q=n(5457),G=n(8597),K=n(1744),J=n.n(K),Y=n(7277),Q=n(6277);const X="CREATE_BULK_IMPORT",$="VIEW_BULK_IMPORT_DETAILS",ee="VIEW_BULK_IMPORT_LIST",te="APPROVE_IMPORT_BUTTON",ne="DISAPPROVE_IMPORT_BUTTON",ae="RESUBMIT_BUTTON",re=function(){return{base64_encode:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",a="",r=e.length%3;if(r>0)for(;r<3;r++)a+="=",e+="\0";for(r=0;r<e.length;r+=3){r>0&&r/3*4%76==0&&(n+="\r\n");var l=(e.charCodeAt(r)<<16)+(e.charCodeAt(r+1)<<8)+e.charCodeAt(r+2),i=[l>>>18&63,l>>>12&63,l>>>6&63,63&l];n+=t[i[0]]+t[i[1]]+t[i[2]]+t[i[3]]}return n.substring(0,n.length-a.length)+a},base64_decode:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="="==(e=e.replace(new RegExp("[^"+t.split("")+"=]","g"),"")).charAt(e.length-1)?"="==e.charAt(e.length-2)?"AA":"A":"",a="";e=e.substr(0,e.length-n.length)+n;for(var r=0;r<e.length;r+=4){var l=(t.indexOf(e.charAt(r))<<18)+(t.indexOf(e.charAt(r+1))<<12)+(t.indexOf(e.charAt(r+2))<<6)+t.indexOf(e.charAt(r+3));a+=String.fromCharCode(l>>>16&255,l>>>8&255,255&l)}return a.substring(0,a.length-n.length)},getValueByKey:function(e,t,n){return(new RegExp("^"+n+t+"(.*)$","m").exec(e)||"")[1]},configJSFilter:function(e,t,n){return e.split(/\r?\n/).filter((function(e){return e.toLowerCase().indexOf(n)>-1})).toString().split(t)[1].replace(/['",]+/g,"")},dateConversion:function(e){var t,n,a,r="";return e&&(r=(null==e||null===(t=e.split("T"))||void 0===t?void 0:t[0])+" "+(null==e||null===(n=e.split("T"))||void 0===n||null===(a=n[1])||void 0===a?void 0:a.slice(0,8))),r}}};var le=n(1978);function ie(e,t){return e instanceof Blob?e:new Blob([e],t)}const oe=function(e,t){if(window.navigator.msSaveBlob){var n=ie(e,{type:"text/csv"});window.navigator.msSaveBlob(n,t)}else{var a=document.createElement("a");if(a.download=t,window.URL.createObjectURL){var r=ie(e,{type:"text/csv"});a.href=window.URL.createObjectURL(r)}else a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(e);if(document.createEvent){var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!0),a.dispatchEvent(l)}else a.click()}};var ce=n(4104),se=n.n(ce),ue=n(8069),me=(0,C.Z)((function(e){return(0,B.Z)({spacingBottom:{marginBottom:e.spacing(1)},skeleton:{height:20},fieldHeading:{fontWeight:"bold",textTransform:"capitalize",fontSize:14},fieldValue:{textTransform:"capitalize",fontSize:14,wordBreak:"break-all","& .import-file-name":{textTransform:"none !important"}},rowSpacing:{marginBottom:e.spacing(.5)},alignEnd:{textAlign:"end"},flexBox:{display:"flex",alignItems:"center"}})}));const de=function(e){var t,n,r,i,c,s,u,m,f=e.batchInfo,p=e.importInfo,v=e.loading,g=e.batchInfoData,b=(e.setBatchInfoData,e.dynamicImportInfo),w=e.setDynamicImportInfo,x=R(),Z=x.showErrorMessage,I=x.showSuccessMessage,T=(0,l.useHistory)(),C=(0,y.useTranslation)().t,B=me(),D=a.useState(!1),F=(0,o.Z)(D,2),V=F[0],M=F[1],A=a.useState(!1),O=(0,o.Z)(A,2),_=(O[0],O[1],se()().checkPermission),z=re().dateConversion,P=null==b?void 0:b.creationDate,L=null==b?void 0:b.lastUpdated;if(V)return a.createElement(ue.Z,{sx:{bgcolor:"grey.900"},variant:"rectangular",width:"100%",height:400});var j=[{field:"importId",headerName:C("importId"),flex:1,renderCell:function(e){var t;return a.createElement("a",{onClick:function(){var t,n,a;n=null==e||null===(t=e.row)||void 0===t?void 0:t.importId,h(null===(a=f[0])||void 0===a?void 0:a.batchId).then((function(e){var t,a=null===(t=e.batchInfo)||void 0===t?void 0:t.filter((function(e){return e.importId===n}));M(!0),w(a[0]),M(!1)}))},style:{textDecoration:"underline",fontSize:"12px",cursor:"pointer"}},null==e||null===(t=e.row)||void 0===t?void 0:t.importId)}},{field:"creationDate",headerName:C("submitted"),width:180,renderCell:function(e){var t;return e.getValue("creationDate")?a.createElement(a.Fragment,null,z(null===(t=e.getValue("creationDate"))||void 0===t?void 0:t.toString())):a.createElement(N.Z,null," ",C("emptyValueMark"))}},{field:"processed",headerName:C("processed"),flex:1,renderCell:function(e){var t,n;return a.createElement(a.Fragment,null,a.createElement("span",{style:{textTransform:"capitalize"}},null===(t=e.row)||void 0===t||null===(n=t.records)||void 0===n?void 0:n.processed))}},{field:"success",headerName:C("successful"),flex:1,renderCell:function(e){var t,n;return a.createElement(a.Fragment,null,a.createElement("span",{style:{textTransform:"capitalize"}},null===(t=e.row)||void 0===t||null===(n=t.records)||void 0===n?void 0:n.success))}},{field:"failed",headerName:C("failed"),flex:1,renderCell:function(e){var t,n;return a.createElement(a.Fragment,null,a.createElement("span",{style:{textTransform:"capitalize"}},null===(t=e.row)||void 0===t||null===(n=t.records)||void 0===n?void 0:n.failed))}},{field:"retriableFileName",headerName:C("file"),flex:1,renderCell:function(e){var t;return a.createElement("a",{onClick:function(){var t,n;return U(null==e||null===(t=e.row)||void 0===t?void 0:t.retriableFileId,null==e||null===(n=e.row)||void 0===n?void 0:n.retriableFileName)},style:{textDecoration:"underline",fontSize:"12px"}},(null==e||null===(t=e.row)||void 0===t?void 0:t.retriableFileName)||C("emptyValueMark"))}},{field:"action",headerName:C("action"),flex:1,renderCell:function(e){var t,n,r;return a.createElement(a.Fragment,null,_(ae)&&a.createElement(k.SeamlessButton,{variant:"contained",color:"primary",disabled:(null==e||null===(t=e.row)||void 0===t?void 0:t.failed)<=0&&(null==e||null===(n=e.row)||void 0===n?void 0:n.success)>0||e.row.index!==g.length-1||null==e||null===(r=e.row)||void 0===r||!r.retriableFileName,onClick:function(){var t;return H(null==e||null===(t=e.row)||void 0===t?void 0:t.importId)}},C("re-submit")))}}],U=function(e,t){var n=(0,le.getDownloadRetrySrc)(e);E(n).then((function(e){return new Blob([e],{type:"text/csv"})})).then((function(e){oe(e,p?t:"".concat(p.importId,"-import-file.csv"))})).catch((function(e){Z(C("errorCsvDownload"))}))},H=function(e){(function(e){var t="/bss/v1/import/".concat(parseInt(e),"/resubmit");return d(t,{method:"POST"})})(e).then((function(e){0===e.resultCode?(I(e.resultMessage||C("resubmitted")),window.location.reload()):Z(e.resultMessage)})).catch((function(e){Z(e.message)}))};return a.createElement(k.SeamlessContainer,{title:C("importDetailsPageTitle"),description:C("importDetailsPageDescription")},a.createElement(S.Z,{container:!0,spacing:3,className:B.spacingBottom},a.createElement(S.Z,{item:!0,xs:12},a.createElement(S.Z,{container:!0,spacing:3,className:B.spacingBottom},a.createElement(S.Z,{item:!0,xs:12,sm:6},a.createElement(N.Z,{variant:"subtitle1",color:"primary"},C("batchInformation"))),a.createElement(S.Z,{item:!0,xs:12,sm:6,className:B.alignEnd},a.createElement(k.SeamlessButton,{onClick:function(e){return T.replace(window.location.pathname)},id:"cancel-import",variant:"contained",color:"primary"},"Refresh ",a.createElement(G.Z,{fontSize:"small"})))),a.createElement(S.Z,{container:!0,className:(0,Q.default)(B.rowSpacing,B.spacingBottom),spacing:3},a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("batchId"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},f?"".concat(null===(t=f[0])||void 0===t?void 0:t.batchId):"")),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("importType"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},f?"".concat(null===(n=f[0])||void 0===n?void 0:n.importType," ").concat(null===(r=f[0])||void 0===r?void 0:r.importSubType):"")),a.createElement(S.Z,{container:!0,className:(0,Q.default)(B.rowSpacing,B.spacingBottom),spacing:3,alignItems:"center"},a.createElement(S.Z,{item:!0,xs:6,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading),style:{marginLeft:10}},C("fileName"))),a.createElement(S.Z,{item:!0,xs:6,sm:3,className:B.flexBox},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},a.createElement("span",{className:"import-file-name"},p?p.fileName:"")),a.createElement(Y.Z,{onClick:function(){return e="".concat((0,le.getSrc)(p.fileLocation||"","inventory")),void E(e).then((function(e){return new Blob([e],{type:"text/csv"})})).then((function(e){oe(e,p?p.fileName:"".concat(p.importId,"-import-file.csv"))})).catch((function(e){Z(C("errorCsvDownload"))}));var e},style:{marginLeft:"10px",border:"1px solid"}},a.createElement(q.Z,{fontSize:"small"}))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("schedulerType"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},f&&(null===(i=f[0])||void 0===i||null===(c=i.schedule)||void 0===c?void 0:c.schedulerType))),a.createElement(S.Z,{item:!0,xs:12,sm:3,style:{marginLeft:10}},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("user"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},p?p.uploadedBy:""))),a.createElement(S.Z,{item:!0,xs:12,sm:12},a.createElement(N.Z,{variant:"subtitle1",color:"primary"},C("importInformation"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("importId"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},null!=b&&b.importId?null==b?void 0:b.importId:C("emptyValueMark"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("status"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},null!=b&&b.batchStatus?null==b?void 0:b.batchStatus:null!=b&&b.batchStatus?"Pending":C("emptyValueMark")))),a.createElement(S.Z,{container:!0,className:(0,Q.default)(B.rowSpacing,B.spacingBottom),spacing:3},a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("summary"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},null!=b&&b.description?null==b?void 0:b.description:C("emptyValueMark"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("reasonOfFailuire"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue),style:{cursor:"pointer"},onClick:function(){return U(null==b?void 0:b.errorFileId,null==b?void 0:b.errorFileName)}},a.createElement("u",null,null!=b&&b.errorFileName?null==b?void 0:b.errorFileName:C("emptyValueMark"))))),a.createElement(S.Z,{container:!0,className:(0,Q.default)(B.rowSpacing,B.spacingBottom),spacing:3},a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("submitted"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},P?(null==P?void 0:P.split("T")[0])+" "+(null==P||null===(s=P.split("T")[1])||void 0===s?void 0:s.slice(0,8)):C("emptyValueMark"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("finished"))),a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},L?(null==L?void 0:L.split("T")[0])+" "+(null==L||null===(u=L.split("T")[1])||void 0===u?void 0:u.slice(0,8)):C("emptyValueMark")))),b&&(null==b||null===(m=b.extraProperties)||void 0===m?void 0:m.length)>1&&a.createElement(S.Z,{container:!0,className:(0,Q.default)(B.rowSpacing,B.spacingBottom),spacing:3,alignItems:"center"},a.createElement(S.Z,{item:!0,xs:12,sm:3},a.createElement(N.Z,{className:(0,Q.default)(B.fieldHeading)},C("failInfo"),": ")),a.createElement(S.Z,{item:!0,xs:12,sm:6},a.createElement(N.Z,{className:(0,Q.default)(B.fieldValue)},null==b?void 0:b.extraProperties[1].value))))),a.createElement("div",{style:{height:800,width:"100%"}},a.createElement(J(),{rowCount:g.length,rows:g,loading:v,pageSize:10,columns:j,getRowId:function(e){return null==e?void 0:e.importId},disableColumnFilter:!0,disableDensitySelector:!0,hideFooterPagination:!0,disableColumnSelector:!0})))},fe=function(){return a.createElement(W,null,(function(e){return a.createElement(de,e)}))};var pe=n(7560);const ve=function(e){var t=e.children,n=e.schedulerType,r=e.approveAndReject,l=a.useState([]),i=(0,o.Z)(l,2),c=i[0],s=i[1],u=a.useState(!1),m=(0,o.Z)(u,2),f=m[0],p=m[1],v=(0,y.useTranslation)().t,g=new Date,h=new Date((new Date).setMonth(g.getMonth()-6)),E=new Date((new Date).setFullYear(g.getFullYear()+10)),b={from:h.toISOString(),to:E.toISOString()},w=R(),x=w.showSuccessMessage,S=w.showErrorMessage;r=function(e,t){p(!0),function(e,t){return d("/bss/v1/import/".concat(e,"/update"),{method:"PUT",body:t})}(t,"approve"===e?{newBatchState:"immediate",newStatus:"pending"}:{newBatchState:"rejected",newStatus:"rejected"}).then((function(e){0===e.resultCode?x(e.resultMessage):S(e)})).catch((function(e){return S(e)})).finally((function(){return Z()}))};var Z=function(){(function(e,t){return d("/bss/v1/batch/scheduled/info?from=".concat(e.from,"&to=").concat(e.to,"&scheduleType=").concat("All"===t?"":t))})(b,n).then((function(e){0===e.resultCode?s(e.scheduledBatches):1003===e.resultCode?(s([]),S(v("noRecordText"))):(s([]),S(e))})).catch((function(e){s([]),S(e)})).finally((function(){return p(!1)}))};return a.useEffect((function(){p(!0),Z()}),[n]),a.createElement(a.Fragment,null,t({imports:c,loading:f,approveAndReject:r}))};var ge=n(8592),he=n(30),Ee=n(552),be=n(3507),we=n(9781),ye=n(1463),xe=n(6054);const Se=function(e){var t=e.imports,n=e.loading,r=e.approveAndReject,i=(0,y.useTranslation)().t,o=se()().checkPermission,c=re().dateConversion,s=[{field:"batchId",headerName:i("batchId"),sortable:!1,width:120},{field:"importSubType",headerName:i("type"),sortable:!0,flex:1,renderCell:function(e){var t,n;return a.createElement(a.Fragment,null,a.createElement("span",null,"".concat((null===(t=e.row)||void 0===t||null===(n=t.imports[0])||void 0===n?void 0:n.importSubType)||i("emptyValueMark"))))}},{field:"creationDate",headerName:i("submitted"),sortable:!0,flex:1,renderCell:function(e){var t;return e.getValue("creationDate")?a.createElement(a.Fragment,null,c(null===(t=e.getValue("creationDate"))||void 0===t?void 0:t.toString())):a.createElement(N.Z,null," ",i("emptyValueMark"))}},{field:"batchStatus",headerName:i("status"),sortable:!0,flex:1,renderCell:function(e){var t,n;return a.createElement(a.Fragment,null,a.createElement("span",{style:{textTransform:"capitalize"}},"".concat((null===(t=e.row)||void 0===t||null===(n=t.batchStatus)||void 0===n?void 0:n.toString())||i("emptyValueMark"))))}},{field:"batchDesc",headerName:i("summary"),sortable:!1,flex:1},{field:"actions",headerName:i("actions"),sortable:!1,renderCell:function(e){return a.createElement("div",null,a.createElement(ge.Z,null,a.createElement(Y.Z,{component:l.Link,to:"/home/bulk/imports/view/".concat(e.row.batchId)},a.createElement(Ee.Z,{fontSize:"small"})),o(te)&&"pending-approval"===(null==e?void 0:e.row.batchStatus)?a.createElement(he.ZP,{title:"Approve"},a.createElement(Y.Z,{onClick:function(){var t,n;return r("approve",null==e||null===(t=e.row)||void 0===t||null===(n=t.id)||void 0===n?void 0:n.toString())}},a.createElement(be.Z,{fontSize:"small",style:{color:ye.Z[400]}}))):null,o(ne)&&"pending-approval"===(null==e?void 0:e.row.batchStatus)?a.createElement(he.ZP,{title:"Reject"},a.createElement(Y.Z,{onClick:function(){var t,n;return r("reject",null==e||null===(t=e.row)||void 0===t||null===(n=t.id)||void 0===n?void 0:n.toString())}},a.createElement(we.Z,{fontSize:"small",style:{color:xe.Z[400]}}))):null))},flex:1}];return a.createElement(J(),{loading:n,columnBuffer:2,rowCount:t.length,rows:t&&t.sort((function(e,t){return new Date(t.creationDate).getTime()-new Date(e.creationDate).getTime()})),getRowId:function(e){return e.batchId},columns:s})},Ze=function(e){return a.createElement(ve,e,(function(t){var n=t.imports,r=t.loading,l=t.approveAndReject;return a.createElement(Se,(0,pe.Z)({},e,{imports:n,loading:r,approveAndReject:l}))}))},Ie=function(){return a.createElement(fe,null)};var Ne=(0,C.Z)((function(e){return(0,B.Z)({elements:{marginRight:e.spacing(1),marginTop:e.spacing(1),marginLeft:e.spacing(1)},dropdown:{width:"20%"}})}));const Te=function(){var e=(0,y.useTranslation)().t,t=Ne(),n=a.useState(""),r=(0,o.Z)(n,2),l=r[0],c=r[1],s=window.config.bulk.schedulerTypes;return a.createElement(k.SeamlessContainer,{title:e("newImportPageTitle"),description:e("newImportPageDescription")},a.createElement(Z.Z,null,a.createElement(S.Z,null,a.createElement(Z.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end"},a.createElement(P,null)),a.createElement(Z.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-start"},a.createElement(k.SeamlessDropDown,{options:[{value:"All",key:e("all")}].concat((0,i.Z)(s)),className:t.dropdown,onChange:function(e){return t=e.target.value,void c(t);var t},label:e("schedulerType")}))),a.createElement("div",{style:{height:600,width:"100%"}},a.createElement(Ze,{schedulerType:l}))))},ke=function(){var e=(0,l.useRouteMatch)().path,t=se()().AccessControlled;return a.createElement(l.Switch,null,a.createElement(l.Route,{path:"".concat(e,"/view/:batchId")},a.createElement(t,{feature:$},a.createElement(Ie,null))),a.createElement(l.Route,{path:"".concat(e,"/new")},a.createElement(t,{feature:X},a.createElement(_,null))),a.createElement(l.Route,null,a.createElement(t,{feature:ee},a.createElement(Te,null))))},Ce=function(){var e=(0,l.useRouteMatch)().path;return a.createElement(l.Switch,null,a.createElement(l.Route,{path:"".concat(e,"/imports"),component:ke}),a.createElement(l.Redirect,{to:e+"/imports"}))}}}]);