(self.webpackChunk_unified_contract=self.webpackChunk_unified_contract||[]).push([[8840],{34579:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var a=n(74315),r=n(2411),o=n.n(r),i=n(38670);const l=function(e){var t=o().useState(null),n=(0,a.Z)(t,2),r=n[0],l=n[1],c=(0,i.useSelector)((function(e){var t;return null==e||null===(t=e.auth)||void 0===t?void 0:t.rbac}),i.shallowEqual);return o().useEffect((function(){var t,n=(null===(t=c.features.find((function(t){return t.module===e})))||void 0===t?void 0:t.features)||[];l(n)}),[c]),r}},62653:(e,t,n)=>{"use strict";n.d(t,{i:()=>fa,a:()=>la});var a=n(2411),r=n.n(a),o=n(44104),i=n.n(o),l=n(48049),c=n(37603),s=n(29609),u=n(33553),d=n(7560),m=n(55238),p=n(74315),f=n(51119),g=n(19721);const y=function(){var e=(0,g.useSnackbar)().enqueueSnackbar,t=(0,s.useTranslation)().t;function n(e){var n=t("anErrorOccurred");return["resultMessage","message","resultDescription"].forEach((function(t){e.hasOwnProperty(t)&&(n=e[t])})),n}return{showSuccessMessage:function(t){e("string"!=typeof t?n(t):t,{variant:"success"})},showErrorMessage:function(t){e("string"!=typeof t?n(t):t,{variant:"error"})},showInfoMessage:function(t){e("string"!=typeof t?n(t):t,{variant:"info"})},showWarningMessage:function(t){e("string"!=typeof t?n(t):t,{variant:"warning"})}}};var v=n(61416);const h=n.n(v)();var E,S,T="/acms/v2",b=null!==(E=null===(S=window.config)||void 0===S?void 0:S.showActiveContracts)&&void 0!==E&&E,C=function(e){return h("".concat(T,"/contracts/").concat(e))},Z=function(){return h("".concat(T,"/deferred-commission-spans"))},w=function(){return h("/acms/reseller-type/")},D=function(){return h("/acms/country/")},x=function(e,t,n){return h("".concat(T,"/contract-price-entries"),{method:"POST",body:t})},I=function(e,t,n){return h("".concat(T,"/contract-price-entries/").concat(e,"?updateFlag=").concat(n),{method:"PUT",body:t})},O=function(e,t){var n=t?"&productVariantId=".concat(t):"";return h("".concat(T,"/export-price-entry?contractId=").concat(e).concat(n))},R=function(){return h("".concat(T,"/rule-condition/regions/level/2"))},k=function(e){return h("/acms/concerted-rule-info/".concat(e))};function N(e){return h("/dms/auth/getResellerInfo",{method:"POST",body:{dealerID:{id:e,type:"resellerId"},fetchAccountBalanceInformation:!1}})}var M,P,F,A,B=n(41744),V=n.n(B),W=n(38670);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}A=(null===(M=window.config)||void 0===M?void 0:M.defaultPerPageItems)||20;var q=(null===(P=window.config)||void 0===P||null===(F=P.contract)||void 0===F?void 0:F.isRegionCreateContract)||!1,L="";const j=function(e){var t,n,r,o=e.children,i=e.searchQuery,l=void 0===i?"":i,c=y().showErrorMessage,u=(0,s.useTranslation)().t,d=(0,W.useSelector)((function(e){return e.auth})).user,m=a.useState([]),f=(0,p.Z)(m,2),g=f[0],v=f[1],E=a.useState([]),S=(0,p.Z)(E,2),C=S[0],Z=S[1],x=a.useState(!1),I=(0,p.Z)(x,2),O=I[0],R=I[1],k=a.useState(0),N=(0,p.Z)(k,2),M=N[0],P=N[1],F=a.useState(0),V=(0,p.Z)(F,2),_=V[0],j=V[1],z=a.useState([]),H=(0,p.Z)(z,2),U=H[0],G=H[1],X=null==d||null===(t=d.info)||void 0===t||null===(n=t.additionalFields)||void 0===n?void 0:n.filter((function(e){return"regionCode"===(null==e?void 0:e.name)})),$=q&&(null===(r=X[0])||void 0===r?void 0:r.value),Q=(0,B.useServerTable)({page:0,perPage:$?1e3:A,order:"desc",orderBy:"startTime",filter:{}}),J=a.useCallback((function(e){R(!0);var t=[];D().then((function(e){return G(e),w()})).then((function(n){return t=[{typeKey:0,id:"ALL",name:u("all")}].concat(n),Z(t),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="?page=".concat(e.page,"&size=").concat(e.size);return b&&!t&&(t=";contractStatus=1"),h("".concat(T,"/contracts").concat(t).concat(n))}({page:L===e?Q.page:0,size:$?1e3:Q.perPage},e)})).then((function(n){L=e;var a=n.contractList;$&&(a=a.filter((function(e){var t,n,a,r;return(null===(t=X[0])||void 0===t||null===(n=t.value)||void 0===n?void 0:n.includes(null===(a=e.contractDataMap)||void 0===a?void 0:a.regionCode))&&!(null==e||null===(r=e.contractDataMap)||void 0===r||!r.regionCode)})));var r=a.map((function(e){j(_+1);var n=function(e,t){if(void 0===t)return"";var n=e.find((function(e){return e.typeKey===t}));return n?n.name:""}(t,e.resellerType);return K(K({},e.contractDataMap),{},{contractKey:e.contractKey,name:e.name,description:e.description,importId:e.importId,resellerType:e.resellerType,resellerTypeName:n,country:e.country,contractStatus:e.contractStatus,createdBy:e.createdBy})}));v(r),P($?_:n.totalCount)})).catch((function(e){c(e),L=""})).finally((function(){return R(!1)}))}),[Q.page,Q.perPage]);return a.useEffect((function(){J(l)}),[J,l]),a.createElement(a.Fragment,null,o(K({contracts:g,resellerTypes:C,countries:U,loading:O,totalCount:M},Q)))};var z=n(56470),H=n(77162),U=n.n(H),G=n(77277),X=n(38592),$=n(90436),Q=n(24276),J=n(80030),Y=n(8629),ee=n(38724),te=n(70331),ne=n(15223),ae=n(67358),re=n(99781),oe=n(79692),ie=n(12420),le=n(16874),ce=n(73507),se=n(64874),ue=n(60552),de=n(35457);const me="CREATE_CONTRACT",pe="CREATE_CONTRACT_ACTIVE_STATUS",fe="APPROVE_REJECT_CONTRACT",ge="UPDATE_CONTRACT",ye="VIEW_CONTRACTS",ve="VIEW_PRODUCTS_RULES",he="CLONE_CONTRACT",Ee="ADD_PRODUCT_RULES",Se="VIEW_PRODUCT_RANGE_RULES",Te="UPDATE_PRODUCT_RULES",be="DELETE_PRODUCT_RULES",Ce="UPDATE_PRODUCT_STATUS",Ze="CONTRACT_PRICE",we="VIEW_CONTRACT",De="EXPORT_CONTRACT",xe="EDIT_CONTRACT";function Ie(e,t){return e instanceof Blob?e:new Blob([e],t)}const Oe=function(e,t){if(window.navigator.msSaveBlob){var n=Ie(e,{type:"text/csv"});window.navigator.msSaveBlob(n,t)}else{var a=document.createElement("a");if(a.download=t,window.URL.createObjectURL){var r=Ie(e,{type:"text/csv"});a.href=window.URL.createObjectURL(r)}else a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(e);if(document.createEvent){var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!0),a.dispatchEvent(o)}else a.click()}};var Re=(0,oe.Z)((function(e){return(0,ie.Z)({root:{marginTop:e.spacing(5),width:"100%",padding:e.spacing(2)},formWrapper:{padding:"".concat(e.spacing(1.5)," 0")},formWidget:{marginTop:e.spacing(5),"& .MuiFormControl-root":{marginBottom:e.spacing(1.5),marginRight:e.spacing(1.5)},"& .MuiTypography-root":{marginBottom:e.spacing(1)}},saveBtn:{marginTop:e.spacing(3)},modalImageSize:{maxWidth:70},dialogWrapper:{textAlign:"center","& .MuiDialog-container":{width:"100%"},"& .MuiDialogContent-root":{marginTop:e.spacing(2),marginBottom:e.spacing(3),marginRight:"auto",marginLeft:"auto"}},fontHeavy:{fontWeight:e.typography.fontWeightBold},modalContentSpacing:{marginTop:e.spacing(3),marginBottom:e.spacing(3)},btnSpace:{marginRight:e.spacing(2)},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1},subTitle:{marginBottom:e.spacing(3)},dialogContent:{marginTop:e.spacing(2),marginBottom:e.spacing(7)},element:{marginRight:e.spacing(1),marginBottom:e.spacing(2)}})})),ke=[];const Ne=function(e){var t,n,r,o,c,u=e.loading,d=e.contracts,m=e.resellerTypes,f=e.countries,g=e.page,v=e.perPage,E=e.onPageChange,S=e.onPageSizeChange,b=e.totalCount,w=e.onApproveOrReject,D=Re(),x=(0,l.useHistory)(),I=(0,s.useTranslation)().t,R=(0,W.useSelector)((function(e){return e.auth})).user,k=i()().checkPermission,N=y(),M=N.showErrorMessage,P=N.showSuccessMessage,F=a.useState(!1),A=(0,p.Z)(F,2),B=A[0],_=A[1],K=a.useState(""),q=(0,p.Z)(K,2),L=(q[0],q[1]),j=a.useState({clonedContractKey:0,name:"",description:"",importId:"",resellerType:0,country:1,contractStatus:0,clonedFrom:"",createdBy:"",contractDataMap:{contract_type:"Regular",commission_mode:"Instant"}}),H=(0,p.Z)(j,2),oe=H[0],ie=H[1],me=a.useState(!1),pe=(0,p.Z)(me,2),ge=pe[0],ye=pe[1],ve=a.useState(!1),Ee=(0,p.Z)(ve,2),Se=Ee[0],Te=Ee[1],be=a.useState([]),Ce=(0,p.Z)(be,2),Ie=Ce[0],Ne=Ce[1],Me=((0,W.useSelector)((function(e){return e}),W.shallowEqual),(null===(t=window.config)||void 0===t||null===(n=t.contract)||void 0===n?void 0:n.isRegionCreateContract)||!1),Pe=null==R||null===(r=R.info)||void 0===r||null===(o=r.additionalFields)||void 0===o?void 0:o.filter((function(e){return"regionCode"===(null==e?void 0:e.name)})),Fe=Me&&(null===(c=Pe[0])||void 0===c?void 0:c.value);a.useEffect((function(){var e=!0;return ke.length>0?Ne(ke):(Z().then((function(t){ke=t,e&&Ne(t)})).catch((function(e){return M(e)})).finally((function(){return ye(!1)})),function(){e=!1})}),[]);var Ae=function(e){if(void 0===e)return"";var t=f.find((function(t){return t.countryKey.toString()===e}));return t?t.name:""},Be=function(){L(""),_(!1)},Ve=a.useCallback((function(e){var t,n=e;if("Instant"===n.contractDataMap.commission_mode){var a,r={contract_type:"Regular",commission_mode:null==n||null===(a=n.contractDataMap)||void 0===a?void 0:a.commission_mode};n.contractDataMap=r}if(Me){var o=n.region&&n.region.split(":");n.contractDataMap.regionCode=o&&o[0],n.contractDataMap.regionName=o&&o[1]}(t=n,h("".concat(T,"/contracts/clone"),{method:"POST",body:t})).then((function(e){P(I("cloneContractSuccessMessage")),_(!1),x.push("/home/contract/contracts/")})).catch((function(e){return M(e)}))}),[]),We=function(){var e=(0,z.Z)(U().mark((function e(t,n){return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Te(!0),e.next=3,O(t).then((function(e){e.resultCode?M(I("errorCsvDownload")):Oe(e,"".concat(n,".csv"))})).finally((function(){return Te(!1)})).catch((function(e){return M(e)}));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),_e=[{field:"importId",headerName:I("importId"),sortable:!0,width:150,renderCell:function(e){return a.createElement(J.ZP,{title:e.getValue("importId")},a.createElement("div",null,e.getValue("importId")))}},{field:"name",headerName:I("contractName"),sortable:!0,width:150,renderCell:function(e){return a.createElement(J.ZP,{title:e.getValue("name")},a.createElement("div",null,e.getValue("name")))}},{field:"contract_type",headerName:I("contractType"),sortable:!0,width:140,renderCell:function(e){return a.createElement(J.ZP,{title:e.getValue("contract_type")},a.createElement("div",null,e.getValue("contract_type")))}},{field:"description",headerName:I("description"),sortable:!0,width:200,renderCell:function(e){return a.createElement(J.ZP,{title:e.getValue("description")},a.createElement("div",null,e.getValue("description")))}},{field:"resellerType",headerName:I("resellerType"),sortable:!1,width:180,renderCell:function(e){return a.createElement(J.ZP,{title:e.getValue("resellerType")},a.createElement("div",null,e.getValue("resellerTypeName")))}},{field:"commission_mode",headerName:I("commission_mode"),sortable:!0,width:150,renderCell:function(e){return a.createElement(J.ZP,{title:e.getValue("commission_mode")},a.createElement("div",null,e.getValue("commission_mode")))}},{field:"country",headerName:I("country"),sortable:!0,width:150,renderCell:function(e){var t,n;return a.createElement(J.ZP,{title:Ae(null===(t=e.getValue("country"))||void 0===t?void 0:t.toString())},a.createElement("div",null,Ae(null===(n=e.getValue("country"))||void 0===n?void 0:n.toString())))}},{field:"contractStatus",headerName:I("status"),sortable:!1,width:100,renderCell:function(e){return a.createElement(J.ZP,{title:1===e.getValue("contractStatus")?I("active"):I("inactive")},a.createElement("div",null,a.createElement(le.Z,{style:{fill:1===e.getValue("contractStatus")?"green":"red"}})))}},{field:"actions",headerName:I("actions"),sortable:!1,width:250,renderCell:function(e){var t,n;return a.createElement("div",null,a.createElement(X.Z,{size:"small",color:"primary","aria-label":"group action buttons"},k(we)&&a.createElement(J.ZP,{title:I("view")},a.createElement(G.Z,{component:l.Link,to:"/home/contract/contracts/view/"+e.getValue("contractKey")},a.createElement(ue.Z,{fontSize:"small"}))),k(xe)&&a.createElement(J.ZP,{title:I("edit")},a.createElement(G.Z,{component:l.Link,to:"/home/contract/contracts/edit/"+e.getValue("contractKey")},a.createElement(se.Z,{fontSize:"small"}))),k(he)&&a.createElement(J.ZP,{title:I("clone")},a.createElement(G.Z,{onClick:function(){var t,n;L(e.getValue("name")),_(!0),t=e.getValue("id"),n=e.getValue("name"),C(t).then((function(e){var t={clonedContractKey:e.contractKey,name:"",description:"",importId:"",resellerType:0,country:1,contractStatus:0,clonedFrom:n,createdBy:e.createdBy,contractDataMap:{contract_type:"Regular",commission_mode:"Instant"}};if(Me){var a="".concat(e.contractDataMap.regionCode,":").concat(e.contractDataMap.regionName);t.region=a}ie(t)})).catch((function(e){return M(e)}))}},a.createElement(Q.Z,{fontSize:"small",color:"primary"},"content_copy"))),k(De)&&a.createElement(J.ZP,{title:I("export")},a.createElement(G.Z,{onClick:function(){We(e.getValue("contractKey"),e.getValue("name"))}},a.createElement(de.Z,{fontSize:"small"}))),k(Ze)&&a.createElement(J.ZP,{title:I("price")},a.createElement(G.Z,{component:l.Link,to:"/home/contract/contracts/"+e.getValue("contractKey")+"/products"},a.createElement(Q.Z,{fontSize:"small",color:"primary"},"sell"))),k(fe)&&0==(null==e||null===(t=e.row)||void 0===t?void 0:t.contractStatus)&&a.createElement(J.ZP,{title:I("approve")},a.createElement(G.Z,{onClick:function(){return w(null==e?void 0:e.row,1)}},a.createElement(ce.Z,{fontSize:"small",color:"primary"}))),k(fe)&&0==(null==e||null===(n=e.row)||void 0===n?void 0:n.contractStatus)&&a.createElement(J.ZP,{title:I("reject")},a.createElement(G.Z,{onClick:function(){return w(null==e?void 0:e.row,2)}},a.createElement(re.Z,{fontSize:"small",color:"primary"})))))}}];return a.createElement(a.Fragment,null,Fe?a.createElement(V(),{pagination:!0,rowCount:b,rows:d,loading:u||ge,columns:_e,getRowId:function(e){return e.contractKey},columnBuffer:3}):a.createElement(V(),{onPageSizeChange:function(e){S(e.pageSize)},onPageChange:function(e){E(e.page)},pagination:!0,paginationMode:"server",page:g,pageSize:v,rowCount:b,rows:d,loading:u||ge,columns:_e,getRowId:function(e){return e.contractKey},columnBuffer:3,sortingMode:"server"}),a.createElement(Y.Z,{fullWidth:!0,maxWidth:"lg",open:B,onClose:Be,"aria-labelledby":"product-variant-dialog"},a.createElement(te.Z,{className:D.appBar},a.createElement(ne.Z,null,a.createElement(Q.Z,{fontSize:"small",color:"inherit"},"content_copy"),a.createElement($.Z,{variant:"h6",className:D.title},I("clone")))),a.createElement(ee.Z,{className:D.dialogContent},a.createElement(Ln,{"data-testid":"create-contract",data:oe,loading:u||ge,resellerTypes:m,deferredCommissionSpans:Ie,countries:f,isRegionCreateContract:Me,onFormSubmit:function(e){Ve(e)},handleViewClose:Be}))),a.createElement(Y.Z,{fullWidth:!0,maxWidth:"sm",open:Se,onClose:function(){Te(!1)},"aria-labelledby":"csv-download-dialog"},a.createElement(ee.Z,{className:D.dialogWrapper},a.createElement($.Z,{variant:"body1",className:D.modalContentSpacing},I("downloading")),a.createElement(ae.Z,null))))};var Me=n(11746),Pe=n(8526),Fe=n(77114),Ae=n(4614),Be=n(6277),Ve=n(27616),We=n(70660),_e=n(8284),Ke=n(38016),qe=(0,oe.Z)((function(e){return(0,ie.Z)({element:{margin:e.spacing(1)},root:{width:"100%",margin:e.spacing(1)},heading:{fontSize:e.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0},progress:{marginLeft:"8px"}})}));const Le=function(e){var t=e.data,n=e.loading,r=e.resellerTypes,o=e.onFormSubmit,i=qe(),d=(0,s.useTranslation)().t,m=(0,l.useHistory)(),f=a.useState("panel1"),g=(0,p.Z)(f,2),y=g[0],v=g[1],h=Pe.Ry().shape({resellerType:Pe.Z_().nullable(),importId:Pe.Z_().nullable(),name:Pe.Z_().nullable()}),E=(0,Fe.TA)({initialValues:t,validationSchema:h,onSubmit:function(e){return o(e)},enableReinitialize:!0}),S=E.values,T=E.handleChange,b=E.handleSubmit,C=E.handleReset;return E.setFieldValue,a.createElement("div",{className:i.root},a.createElement(Ve.Z,{expanded:"panel1"===y,onChange:("panel1",function(e,t){v(!!t&&"panel1")})},a.createElement(_e.Z,{expandIcon:a.createElement(Ke.Z,null),"aria-controls":"panel1bh-content",id:"panel1bh-header"},a.createElement($.Z,{className:i.heading},a.createElement("strong",null,d("advancedSearch")))),a.createElement(We.Z,null,a.createElement(u.Z,{display:"flex",className:i.root,flexDirection:"column"},a.createElement(u.Z,{display:"flex",flexDirection:"row",alignItems:"center"},a.createElement(c.SeamlessInput,{fullWidth:!0,className:(0,Be.default)(i.element),name:"importId",value:S.importId,onChange:T,label:d("importId")}),a.createElement(c.SeamlessInput,{fullWidth:!0,className:(0,Be.default)(i.element),name:"name",value:S.name,onChange:T,label:d("contractName")}),a.createElement(c.SeamlessDropDown,{id:"resellerType-drop-down",fullWidth:!0,className:i.element,label:d("resellerType"),helperText:d("pleaseSelect_",{fieldName:"resellerType"}),options:[{name:d("dropdownSelectPlaceholder"),typeKey:""}].concat((0,Me.Z)(r)).map((function(e){return{key:e.name,value:e.typeKey}})),name:"resellerType",value:S.resellerType,onChange:T}),a.createElement(c.SeamlessDropDown,{id:"contractStatus-drop-down",fullWidth:!0,className:i.element,label:d("contractStatus"),helperText:d("pleaseSelect_",{fieldName:"contractStatus"}),options:[{key:d("dropdownSelectPlaceholder"),value:""},{key:d("active"),value:"1"},{key:d("inactive"),value:"0"}],name:"contractStatus",value:S.contractStatus,onChange:T})),a.createElement(u.Z,null,a.createElement(c.SeamlessButton,{onClick:function(){C(S),m.push("/home/contract/contracts")},className:(0,Be.default)(i.element),color:"secondary",variant:"outlined"},d("resetSearch","Reset Search")),a.createElement(c.SeamlessButton,{onClick:function(e){return b()},className:(0,Be.default)(i.element),disabled:n,color:"primary",variant:"contained"},d("search","Search"),n&&a.createElement(Ae.Z,{color:"inherit",size:14,thickness:6,className:i.progress})))))))};var je=n(49429),ze=n(79249),He=n(60905);const Ue=function(){return(0,W.useSelector)((function(e){return e.auth}),W.shallowEqual).user};var Ge,Xe,$e=(0,oe.Z)((function(e){var t,n;return(0,ie.Z)({blurBackDrop:{backdropFilter:"blur(2px)",backgroundColor:"rgba(0, 0, 0, 0.2)"},dialogHeader:{fontSize:18,fontWeight:"bold",align:"left",backgroundColor:e.palette.primary.main,color:null==e||null===(t=e.palette)||void 0===t||null===(n=t.common)||void 0===n?void 0:n.white}})})),Qe={importId:"",name:"",resellerType:"",contractStatus:null!==(Ge=null===(Xe=window.config)||void 0===Xe?void 0:Xe.showActiveContracts)&&void 0!==Ge&&Ge?1:""};const Je=function(){var e=r().useState(""),t=(0,p.Z)(e,2),n=t[0],a=t[1],o=r().useState(!1),i=(0,p.Z)(o,2),u=i[0],f=i[1],g=r().useState({}),v=(0,p.Z)(g,2),E=v[0],S=v[1],b=r().useState(),C=(0,p.Z)(b,2),Z=C[0],w=C[1],D=y(),x=D.showErrorMessage,I=D.showSuccessMessage,O=(D.showInfoMessage,D.showWarningMessage,(0,s.useTranslation)().t),R=Ue(),k=(0,l.useHistory)(),N=$e(),M=function(e){if(e){var t="";for(var n in e)e[n]&&(t+=";".concat(n,"=").concat(e[n]));a(t)}},P=function(e,t){e.contractStatus=t,e.modifiedBy=R.userId,S(e),w(t),f(!0)};return r().createElement(j,{searchQuery:n},(function(e){var t=e.contracts,n=e.resellerTypes,a=e.countries,o=e.loading,i=e.totalCount,l=(0,m.Z)(e,["contracts","resellerTypes","countries","loading","totalCount"]);return r().createElement("div",{style:{height:600,width:"100%"}},r().createElement(Le,{data:Qe,resellerTypes:n,loading:o,onFormSubmit:M}),o?r().createElement(Ae.Z,null):r().createElement(Ne,(0,d.Z)({contracts:t,resellerTypes:n,countries:a,loading:o,totalCount:i},l,{onApproveOrReject:P})),r().createElement(Y.Z,{open:u,keepMounted:!0,maxWidth:"sm",fullWidth:!0,onClose:function(){f(!1)},disableBackdropClick:!0,BackdropProps:{classes:{root:N.blurBackDrop}}},r().createElement(ze.Z,{className:N.dialogHeader,color:"primary",disableTypography:!0},O(1===Z?"approveContract":"rejectContract")),r().createElement(ee.Z,null,r().createElement(He.Z,{item:!0,xs:12},r().createElement($.Z,null,"".concat(O("areYouSureToApproveRejectContract",{item:O(1===Z?"approve":"reject")})," : ").concat(E.name," ").concat(O("questionMark"))))),r().createElement(je.Z,null,r().createElement(c.SeamlessButton,{variant:"outlined",color:"primary",onClick:function(){f(!1)}},O("no")),r().createElement(c.SeamlessButton,{variant:"contained",color:"primary",onClick:function(){var e,t,n;n=[0,1,2],(e=E,t=e.id,h("".concat(T,"/contracts/").concat(t),{method:"PUT",body:e})).then((function(e){n.includes(null==e?void 0:e.contractStatus)?(I((null==e?void 0:e.resultMessage)||O("recordUpdatedSuccessfully")),k.push("/home/contract/contracts")):x((null==e?void 0:e.resultMessage)||O("recordNotUpdated"))})).catch((function(e){return x(e)})).finally((function(){f(!1)}))}},O("yes")))))}))};var Ye=n(18896);const et=function(e){var t=e.disable,n=void 0!==t&&t,r=e.label,o=e.path,i=(0,s.useTranslation)().t;return r=r||i("createContract"),o=o||"/home/contract/contracts/create",a.createElement(c.SeamlessButton,{component:l.Link,to:o,variant:"contained",color:"primary",disabled:n,endIcon:a.createElement(Ye.Z,null)},r)};var tt=n(98069),nt=n(19258),at=n(21324),rt=n(86619),ot=n(61564),it=n(40823),lt=n(42068),ct=n(22759),st=(0,oe.Z)((function(e){return(0,ie.Z)({button:{margin:e.spacing(1)},element:{marginRight:e.spacing(1),marginBottom:e.spacing(2)},dateField:{margin:e.spacing(1),width:"100%"},spacingBottom:{marginBottom:e.spacing(2)},textColor:{color:"red"},dialogWrapper:{textAlign:"left","& .MuiDialogContent-root":{marginTop:e.spacing(2),marginBottom:e.spacing(3),marginRight:"auto",marginLeft:"auto"}},fontHeavy:{fontWeight:e.typography.fontWeightBold},btnSpace:{marginRight:e.spacing(2)},alignCenter:{textAlign:"center"},disabled:{opacity:.5}})}));const ut=function(e){var t,n,r,o=e.data,m=e.countries,f=e.resellerTypes,g=e.deferredCommissionSpans,v=e.isRegionCreateContract,h=e.onFormSubmit,E=e.update,S=e.loading,T=e.view,b=y(),C=b.showWarningMessage,Z=b.showErrorMessage,w=(0,W.useSelector)((function(e){return e.auth})).user,D=i()().checkPermission,x=(0,s.useTranslation)().t,I=st(),O=a.useState(!1),k=(0,p.Z)(O,2),M=k[0],P=k[1],F=a.useState(!1),A=(0,p.Z)(F,2),B=A[0],V=A[1],_=a.useState(!1),K=(0,p.Z)(_,2),q=K[0],L=K[1],j=a.useState(!1),z=(0,p.Z)(j,2),H=z[0],U=z[1],X=a.useState([]),Q=(0,p.Z)(X,2),J=Q[0],Y=Q[1],ee=a.useState(!1),te=(0,p.Z)(ee,2),ne=te[0],re=te[1],oe=a.useState(!1),ie=(0,p.Z)(oe,2),le=ie[0],ce=ie[1],se=a.useState(!1),ue=(0,p.Z)(se,2),de=ue[0],me=ue[1];a.useEffect((function(){V("Special"===o.contract_type)}),[o.contract_type]);var fe=[{key:"- ".concat(x("select")," -"),value:" "}],ge=a.useState(fe),ye=(0,p.Z)(ge,2),ve=ye[0],he=ye[1];a.useEffect((function(){"Custom"===o.contractSubType&&ce(!0)}),[o.contractSubType]);var Ee=function(){qe("selectedDay",""),U(!1)},Se=null==w||null===(t=w.info)||void 0===t||null===(n=t.additionalFields)||void 0===n?void 0:n.filter((function(e){return"regionCode"===(null==e?void 0:e.name)})),Te=v&&(null===(r=Se[0])||void 0===r?void 0:r.value),be=[{key:x("regular"),value:"Regular"}],Ce=[{key:x("instant"),value:"Instant"},{key:x("deferred"),value:"Deferred"}],Ze=[{key:x("inactive"),value:0}],we=D(pe);1==we&&Ze.push({key:x("active"),value:1});var De=[{key:x("none"),value:"None"},{key:x("specificDay"),value:"Specific Day"},{key:x("custom"),value:"Custom"}],xe=[{key:"S",value:x("sunday")},{key:"M",value:x("monday")},{key:"T",value:x("tuesday")},{key:"W",value:x("wednesday")},{key:"T",value:x("thursday")},{key:"F",value:x("friday")},{key:"S",value:x("saturday")}],Ie=window.config.openCalendarWith||"year",Oe=Pe.Ry().shape({name:Pe.Z_().required(x("contractNameRequiredError")).matches(/^[a-zA-Z0-9_ ]*$/,x("contractNameAlphaNumericAndSpacesOrUnderscoreError")),importId:Pe.Z_().required(x("importIdRequiredError")).matches(/^[a-zA-Z0-9_]*$/,x("importIdAlphaNumericAndUnderscoreError")),description:Pe.Z_(),region:Te?Pe.Z_().required():Pe.Z_()}),Re=(0,Fe.TA)({initialValues:o,onSubmit:function(e){return h&&h(e)},validationSchema:Oe,enableReinitialize:!0}),ke=Re.values,Ne=Re.errors,Ae=Re.handleChange,Ve=Re.handleBlur,We=Re.handleSubmit,_e=Re.handleReset,Ke=Re.validateForm,qe=Re.setFieldValue;return a.useEffect((function(){v&&(me(!0),R().then((function(e){if(0==e.resultCode){var t,n=e.conditionOptions;Te&&(n=n.filter((function(e){var t,n;return null===(t=Se[0])||void 0===t||null===(n=t.value)||void 0===n?void 0:n.includes(e.split(":")[0])}))),(null===(t=n)||void 0===t?void 0:t.length)>1&&we&&fe.push({key:x("allRegions"),value:"ALL:ALL"});var a=n.map((function(e){var t=e.split(":"),n=e,a=t[1]||t[0];return{value:n,key:a.charAt(0).toUpperCase()+a.slice(1)}}));he(v?[].concat(fe,(0,Me.Z)(a)):(0,Me.Z)(a))}else Z(e);me(!1)})).catch((function(e){return Z(e)})).finally((function(){return me(!1)}))),v&&(me(!0),N(w.userId).then((function(e){if(0==e.resultCode){var t,n,a,r,o=null===(t=e.resellerInfo)||void 0===t||null===(n=t.additionalFields)||void 0===n?void 0:n.find((function(e){return"regionCode"===(null==e?void 0:e.name)})),i=null===(a=e.resellerInfo)||void 0===a||null===(r=a.additionalFields)||void 0===r?void 0:r.find((function(e){return"regionName"===(null==e?void 0:e.name)}));if(o&&i){var l="".concat(null==o?void 0:o.value,":").concat(null==i?void 0:i.value),c=null==l?void 0:l.split(",");1==(null==c?void 0:c.length)&&l&&qe("region",l)}}else Z(e.resultDescription)})).catch((function(e){return Z(e)})).finally((function(){return me(!1)})))}),[]),S?a.createElement(u.Z,{justifyContent:"flex-start",display:"flex",flexDirection:"column",width:"100%",p:1,borderColor:"grey.200",border:.2,borderRadius:6},a.createElement(u.Z,{m:2,width:"30%"},a.createElement(tt.Z,{height:40,variant:"text",animation:"wave"}),a.createElement(tt.Z,{height:40,variant:"text",animation:"wave"})),a.createElement(u.Z,{m:2,width:"30%"},a.createElement(tt.Z,{height:20,variant:"text",animation:"wave"}),a.createElement(tt.Z,{height:20,variant:"text",animation:"wave"})),a.createElement(u.Z,{m:2,width:"30%"},a.createElement(tt.Z,{height:20,variant:"text",animation:"wave"}),a.createElement(tt.Z,{height:20,variant:"text",animation:"wave"}))):a.createElement(He.Z,{container:!0},a.createElement(He.Z,{container:!0,spacing:2,className:I.spacingBottom},a.createElement(He.Z,{container:!0,item:!0,spacing:2,xs:12},a.createElement(He.Z,{item:!0,xs:6},de?a.createElement(ae.Z,null):null)),a.createElement(He.Z,{container:!0,item:!0,spacing:2,xs:12},a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,disabled:T||E,id:"contract-type-drop-down",required:!0,label:x("contractType"),helperText:x("selectContractType"),options:be.map((function(e){return{value:e.value,key:e.key}})),name:"contract_type",value:ke.contract_type,onChange:function(e){switch(Ae(e),e.target.value){case"Special":V(!0);break;default:Ee(),qe("contractSubType","None"),V(!1)}}})),v&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,disabled:T||E,id:"region-drop-down",required:!0,label:x("region"),helperText:x("selectRegion"),options:ve,name:"region",value:ke.region,onChange:function(e){var t;return qe("region",null===(t=e.target.value)||void 0===t?void 0:t.trim())},error:!!Ne.region})),B&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,disabled:T||E,id:"contract-sub-type-drop-down",required:!0,label:x("contractSubType"),helperText:x("selectContractSubType"),options:De.map((function(e){return{value:e.value,key:e.key}})),name:"contractSubType",value:ke.contractSubType,onChange:function(e){switch(Ae(e),L(!1),re(!1),ce(!1),Ee(),e.target.value){case"Specific Day":L(!0);break;case"Custom":re(!0)}}}))),a.createElement(He.Z,{container:!0,item:!0,spacing:2,xs:12},(H||ke.selectedDay)&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessInput,{disabled:!0,className:(0,Be.default)(I.element),fullWidth:!0,name:"selectedDay",value:ke.selectedDay,label:x("day")}))),(ne||le)&&a.createElement(ot.M,{utils:nt.Z},a.createElement(He.Z,{item:!0,xs:6},a.createElement(it.e,{disabled:T||E,error:!!Ne.startDate,className:(0,Be.default)(I.dateField),views:["year","month","date"],openTo:Ie,variant:"inline",format:"dd/MM/yyyy",margin:"normal",id:"startDate",label:x("startDate"),name:"startDate",value:ke.startDate,onChange:function(e){Ae({target:{value:e,name:"startDate"}})},KeyboardButtonProps:{"aria-label":"change date"}})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(it.e,{disabled:T||E,error:!!Ne.endDate,className:(0,Be.default)(I.dateField),views:["year","month","date"],openTo:"year",variant:"inline",format:"dd/MM/yyyy",margin:"normal",id:"endDate",label:x("endDate"),name:"endDate",value:ke.endDate,onChange:function(e){Ae({target:{value:e,name:"endDate"}})},KeyboardButtonProps:{"aria-label":"change date"}})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(lt.e,{disabled:T||E,className:(0,Be.default)(I.dateField),margin:"normal",id:"startDateTimePicker",label:x("startTime"),value:ke.startDate,onChange:function(e){return qe("startDate",e)},KeyboardButtonProps:{"aria-label":"change time"}})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(lt.e,{disabled:T||E,className:(0,Be.default)(I.dateField),margin:"normal",id:"endDateTimePicker",label:x("endTime"),value:ke.endDate,onChange:function(e){return qe("endDate",e)},KeyboardButtonProps:{"aria-label":"change time"}}))),!ne&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessInput,{disabled:T||B&&!H&&!E&&!le,className:(0,Be.default)(I.element),fullWidth:!0,required:!0,error:!!Ne.name,name:"name",value:ke.name,onChange:Ae,onBlur:Ve,label:x("name")})),!ne&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessInput,{disabled:T||E||B&&!H&&!le,className:(0,Be.default)(I.element),fullWidth:!0,required:!0,error:!!Ne.importId,name:"importId",value:ke.importId,onChange:Ae,onBlur:Ve,label:x("importId")})),!ne&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessInput,{disabled:T||B&&!H&&!E&&!le,className:(0,Be.default)(I.element),fullWidth:!0,error:!!Ne.description,name:"description",value:ke.description,onChange:Ae,onBlur:Ve,label:x("description")})),!B&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,id:"reseller-type-drop-down",required:!0,disabled:T||E,label:x("usedForResellerType"),helperText:x("selectResellerType"),options:f.map((function(e){return{value:e.typeKey,key:e.name}})),name:"resellerType",value:ke.resellerType,onChange:Ae})),B&&!ne&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(ct.ZP,{disabled:T||E||B&&!H&&!le,multiple:!0,value:J,id:"used-for-reseller-type",options:f,limitTags:1,disableCloseOnSelect:!0,getOptionLabel:function(e){return e.name},onChange:function(e,t){Y(t||void 0)},renderOption:function(e,t){var n=t.selected;return a.createElement(a.Fragment,null,a.createElement(at.Z,{style:{marginRight:8},checked:n}),e.name)},renderInput:function(e){return a.createElement(rt.Z,(0,d.Z)({},e,{variant:"standard",label:x("usedForResellerType")}))}})),!ne&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{disabled:T||E||B&&!H&&!le,className:(0,Be.default)(I.element),fullWidth:!0,id:"country-drop-down",required:!0,label:x("country"),helperText:x("selectCountry"),options:m.map((function(e){return{value:e.countryKey,key:e.name}})),name:"country",value:ke.country,onChange:Ae})),!ne&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{disabled:T||B&&!H&&!E&&!le,className:(0,Be.default)(I.element),fullWidth:!0,id:"contract-status-drop-down",required:!0,label:x("contractStatus"),helperText:x("selectContractStatus"),options:Ze.map((function(e){return{value:e.value,key:e.key}})),name:"contractStatus",value:ke.contractStatus,onChange:function(e){Ae(e),"0"===e.target.value?P(!0):P(!1)}})),!ne&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{disabled:T||E||B&&!H&&!le,className:(0,Be.default)(I.element),fullWidth:!0,id:"commission-mode-drop-down",required:!0,label:x("commissionMode"),helperText:x("selectCommissionMode"),options:Ce.map((function(e){return{value:e.value,key:e.key}})),name:"commission_mode",value:ke.commission_mode,onChange:Ae})),"Deferred"===ke.commission_mode&&!ne&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{disabled:T||E||B&&!H&&!le,className:(0,Be.default)(I.element),fullWidth:!0,id:"deferred-time-span",required:!0,label:x("deferredTimeSpan"),helperText:x("selectDeferredTimeSpan"),options:g.map((function(e){return{value:e.deferredCommissionValue,key:e.deferredCommissionLabel}})),name:"deferred_timespan",value:ke.deferred_timespan,onChange:Ae}))),E&&M&&a.createElement(He.Z,{item:!0,xs:12},a.createElement($.Z,{variant:"body1",className:I.textColor},x("contractStatusChangeWarning"))),T&&a.createElement(He.Z,{item:!0,xs:12},a.createElement(c.SeamlessButton,{type:"button",variant:"contained",color:"primary",component:l.Link,to:"/home/contract/contracts"},x("backButton"))),!T&&!ne&&a.createElement(He.Z,{item:!0,xs:12},a.createElement(c.SeamlessButton,{disabled:B&&!H&&!E&&!le,onClick:function(){Ke().then((function(e){var t=Object.values(e);t.length>0?C(t[0]):We()}))},className:(0,Be.default)(I.element,I.button),color:"primary",variant:"contained"},x(E?"update":"submit")),a.createElement(c.SeamlessButton,{disabled:B&&!H&&!E&&!le,onClick:_e,className:(0,Be.default)(I.element,I.button),color:"primary",variant:"outlined"},x("reset"))),!T&&ne&&a.createElement(He.Z,null,a.createElement(c.SeamlessButton,{type:"button",variant:"contained",color:"primary",className:I.btnSpace,onClick:function(e){ce(!0),re(!1)}},x("save")),a.createElement(c.SeamlessButton,{type:"button",variant:"outlined",color:"secondary",onClick:function(e){re(!1),ce(!1),qe("contractSubType","None")}},x("backButton"))),a.createElement(c.SeamlessDialog,{open:q,className:I.dialogWrapper,maxWidth:"md",fullWidth:!0,title:"Create new - Specific day"},a.createElement(u.Z,null,a.createElement(c.SeamlessInput,{disabled:!0,className:(0,Be.default)(I.element),fullWidth:!0,name:"contractSubType",value:ke.contractSubType,label:x("contractSubType")}),a.createElement($.Z,{variant:"caption",className:(0,Be.default)(I.disabled)},x("day")),a.createElement(u.Z,{flexDirection:"column",alignItems:"flex-start",mb:2},xe.map((function(e,t){return a.createElement(G.Z,{className:I.btnSpace,color:ke.selectedDay===e.value?"primary":"default",variant:"contained",key:t,name:"selectedDay",onClick:function(t){return function(e){qe("selectedDay",e)}(e.value)}},e.key)}))),a.createElement(c.SeamlessInput,{disabled:!0,className:(0,Be.default)(I.element),fullWidth:!0,name:"selectedDay",value:ke.selectedDay}),a.createElement(u.Z,{className:(0,Be.default)(I.alignCenter)},a.createElement(c.SeamlessButton,{type:"button",variant:"contained",color:"primary",className:I.btnSpace,onClick:function(){""!==ke.selectedDay?(L(!1),U(!0)):C("Please select one of the days")}},x("save")),a.createElement(c.SeamlessButton,{type:"button",variant:"outlined",color:"secondary",onClick:function(e){L(!1),Ee(),qe("contractSubType","None")}},x("backButton"))))))};function dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var mt=window.config,pt=(null==mt?void 0:mt.defaultPerPageItems)||20,ft=(null==mt?void 0:mt.currency)||"MNT",gt=!1;function yt(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.productList||e.products;return t&&(a=a.filter((function(e){return e.entryKey>0&&!gt||e.entryKey<=0&&gt}))),a.map((function(e,t){var a,r,o,i,l,c=gt&&(null===(a=e.variants)||void 0===a?void 0:a.length)>1||!1,s=!c&&e.variants&&e.variants[0]?null===(r=e.variants[0])||void 0===r?void 0:r.productSKU:e.name,u=!c&&e.variants&&null!=e&&e.variants[0]?null===(o=e.variants[0])||void 0===o?void 0:o.variantId:e.id,d=!c&&e.variants&&"available"===(null==e||null===(i=e.variants[0])||void 0===i?void 0:i.status)?1:0;return{index:"".concat(t).concat(u).concat(Number(e.productKey)),productName:e.productName||s,globalSku:e.globalSku||s,productKey:e.productKey||u,contractKey:e.contractKey||n.contactId,currencyName:e.currencyName||ft,currencyId:e.currencyId||1,supplierKey:e.supplierKey||e.supplierId,productType:e.productType,denominationValue:e.denominationValue,denominationType:e.denominationType,entryKey:e.entryKey||0,status:gt?d:e.status,isAvailable:e.variants?null===(l=e.variants[0])||void 0===l?void 0:l.status:e.status||0,multiProducts:c,variants:c?e.variants:[]}}))}const vt=function(e){var t=e.children,n=e.refresh,r=e.searchQuery,o=y().showErrorMessage,i=a.useState([]),c=(0,p.Z)(i,2),s=c[0],u=c[1],d=a.useState(!1),m=(0,p.Z)(d,2),g=m[0],v=m[1],E=a.useState(0),S=(0,p.Z)(E,2),b=S[0],C=S[1],Z=(0,l.useParams)().id,w=(0,B.useServerTable)({page:0,perPage:pt,order:"asc",orderBy:"productName",filter:{}});a.useEffect((function(){return gt=!1,new URLSearchParams(window.location.search).has("show")&&(gt=!0),function(){gt=!1}}),[]);var D=a.useCallback((function(){var e,t;v(!0),(e={page:w.page,size:w.perPage,contractId:Z},t="?page=".concat(e.page,"&size=").concat(e.size),h("".concat(T,"/contracts/").concat(e.contractId,"/products").concat(t))).then((function(e){u(yt(e)),C(e.totalCount)})).catch((function(e){return o(e)})).finally((function(){return v(!1)}))}),[w.page,w.perPage]),x=a.useCallback((function(e){var t={page:w.page,size:w.perPage},n=[];for(var a in e)e[a]&&n.push({key:a,operation:"categoryId"==a?"equals":"contains",value:e[a]});v(!0),function(e,t){var n="page=".concat(e.page,"&perPage=").concat(e.size);return h("/pms/v1/product/filter?order=asc&orderBy=id&".concat(n),{method:"POST",body:t})}(t,{filters:n}).then((function(e){u(yt(e,!1,{contactId:Z})),C(e.metaData.totalCount)})).catch((function(e){return o(e)})).finally((function(){return v(!1)}))}),[w.page,w.perPage]);return a.useEffect((function(){gt?x(r):D()}),[n,D,r]),a.createElement(a.Fragment,null,t(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dt(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({products:s,loading:g,totalCount:b},w)))};var ht=n(82938),Et=n(91256),St=n(27556),Tt=n(37390),bt=n(58987),Ct=n(89571),Zt=n(15584),wt=n(97485),Dt=n(7089),xt=n(89058),It=n(53444),Ot=n(12999);function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nt=(0,oe.Z)((function(e){return(0,ie.Z)({filterRoot:{paddingLeft:12,marginTop:8},toggle:{"& .MuiSwitch-switchBase":{color:"#FF0000"},"& .MuiSwitch-track":{backgroundColor:"#FF0000"},"& .Mui-checked":{color:"#0dc50a"},"& .Mui-checked + .MuiSwitch-track":{backgroundColor:"#0dc50a"}},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1},btnSpace:{marginRight:e.spacing(2)},actions:{"& h2":{display:"none"}},inlineBlock:{display:"inline-block"},colHead:{fontWeight:"bolder",fontSize:"1rem",borderBottom:"1px solid"},dialogWrapper:{textAlign:"center","& .MuiDialog-container":{width:"100%"},"& .MuiDialogContent-root":{marginTop:e.spacing(2),marginBottom:e.spacing(3),marginRight:"auto",marginLeft:"auto"}},modalContentSpacing:{marginTop:e.spacing(3),marginBottom:e.spacing(3)}})}));function Mt(e){var t=Nt(),n=e.item,r=e.applyValue;return a.createElement("div",{className:t.filterRoot},a.createElement(rt.Z,{className:t.filterRoot,name:n.field,value:n.value,onChange:function(e){r(kt(kt({},n),{},{value:e.target.value}))}}))}var Pt=null,Ft=null,At=null;const Bt=function(e){var t,n,r,o=e.loading,d=e.products,m=e.page,f=e.perPage,g=e.onPageChange,v=e.onPageSizeChange,E=e.totalCount,S=e.handleActivateDeactivate,b=e.handleDelete,C=(y().showInfoMessage,i()().checkPermission),Z=Nt(),w=(0,l.useParams)().id,D=y().showErrorMessage,x=a.useState(!1),I=(0,p.Z)(x,2),R=I[0],k=I[1],N=a.useState(!1),M=(0,p.Z)(N,2),P=M[0],F=M[1],A=a.useState(!1),B=(0,p.Z)(A,2),W=B[0],_=B[1],K=a.useState(!1),q=(0,p.Z)(K,2),L=q[0],j=q[1],H=a.useState(!1),X=(0,p.Z)(H,2),Q=X[0],re=X[1],oe=a.useState(!0),ie=(0,p.Z)(oe,2),le=(ie[0],ie[1]),ce=a.useState(),me=(0,p.Z)(ce,2),pe=me[0],fe=me[1],ge=a.useState([]),ye=(0,p.Z)(ge,2),ve=ye[0],he=ye[1],Ze=a.useState({}),we=(0,p.Z)(Ze,2),De=(we[0],we[1]),xe=a.useState("0"),Ie=(0,p.Z)(xe,2),Re=Ie[0],ke=Ie[1],Ne=a.useState(0),Pe=(0,p.Z)(Ne,2),Fe=Pe[0],Ae=Pe[1],Be=a.useState(!1),Ve=(0,p.Z)(Be,2),We=Ve[0],_e=Ve[1],Ke=a.useState(!1),qe=(0,p.Z)(Ke,2),Le=qe[0],je=qe[1],ze=(0,s.useTranslation)().t,He=(0,l.useHistory)();a.useEffect((function(){Ft=null}),[]),a.useEffect((function(){he(d)}),[d]);var Ue=[{label:"Equal",value:"contain",getApplyFilterFn:function(e){return e.columnField&&e.value&&e.operatorValue?function(t){var n,a;return(null===(n=t.value)||void 0===n?void 0:n.toUpperCase())==(null===(a=e.value)||void 0===a?void 0:a.toUpperCase())}:null},InputComponent:Mt}],Ge=a.useCallback((function(e){var t=e.filterModel.items[0].value;Pt&&clearTimeout(Pt),Pt=setTimeout((function(){t&&t!==Ft&&function(e){var t,n;m=Ft===e?m:0,je(!0),(t={contractId:w,page:m,size:f,productSku:e},n="?page=".concat(t.page,"&size=").concat(t.size),h("".concat(T,"/contracts/").concat(t.contractId,"/").concat(t.productSku).concat(n))).then((function(t){"0"==t.resultCode&&(Ft=e,he((0,Me.Z)(t.productList)))})).catch((function(e){return D(e)})).finally((function(){return je(!1)}))}(t),!t&&Ft&&He.push("/home/contract/contracts/".concat(w,"/products"))}),800)}),[]),Xe=function(){var e=(0,z.Z)(U().mark((function e(t,n,a){return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _e(!0),e.next=3,O(t,n).then((function(e){e.resultCode?D(ze("errorCsvDownload")):Oe(e,"".concat(a,".csv"))})).finally((function(){return _e(!1)})).catch((function(e){return D(e)}));case 3:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),$e=[{field:"globalSku",headerName:ze("productSku"),sortable:!0,filterable:!0,flex:1,filterOperators:Ue,renderCell:function(e){return a.createElement(J.ZP,{title:e.getValue("productName")},a.createElement("div",null,e.getValue("globalSku")))}},{field:"actions",headerName:ze("actions"),sortable:!1,filterable:!1,renderCell:function(e){return a.createElement("div",null,0===e.getValue("entryKey")?a.createElement(a.Fragment,null,C(Ee)&&(e.getValue("multiProducts")?a.createElement(J.ZP,{title:ze("showAllVariantsForProduct",{item:e.getValue("productName")})},a.createElement(G.Z,{onClick:function(){At=e.row,fe(e.row),re(!0)}},a.createElement(Ot.Z,{fontSize:"small"}))):a.createElement(a.Fragment,null,1===e.getValue("status")?a.createElement(J.ZP,{title:ze("addMargin",{item:e.getValue("globalSku")})},a.createElement(G.Z,{onClick:function(){At=e.row,fe(e.row),j(!0),_(!0),le(!0)}},a.createElement(It.Z,{fontSize:"small"}))):a.createElement(Dt.Z,{color:"secondary",size:"small",label:ze("notAvailable")})))):a.createElement("div",null,C(Se)&&a.createElement(J.ZP,{title:ze("view")},a.createElement(G.Z,{onClick:function(){At=e.row,fe(e.row),j(!1),_(!0)}},a.createElement(ue.Z,{fontSize:"small"}))),C(Te)&&a.createElement(J.ZP,{title:ze("edit")},a.createElement(G.Z,{onClick:function(){At=e.row,fe(e.row),j(!0),_(!0)}},a.createElement(se.Z,{fontSize:"small"}))),a.createElement(J.ZP,{title:ze("export")},a.createElement(G.Z,{onClick:function(){Xe(e.getValue("contractKey"),e.getValue("productKey"),e.getValue("globalSku"))}},a.createElement(de.Z,{fontSize:"small"}))),C(be)&&a.createElement(J.ZP,{title:ze("delete")},a.createElement(G.Z,{onClick:function(){fe(e.row),F(!0)},disabled:!C(be)},a.createElement(xt.Z,{fontSize:"small"}))),C(Ce)&&a.createElement(J.ZP,{title:ze("toggleProductStatus")},a.createElement(ht.Z,{onClick:function(t){return function(e,t,n){Ae(n);var a=ve;fe(t),e.target.checked?(ke("1"),a[n].status=1,S(null==t?void 0:t.entryKey,"1")):(ke("0"),a[n].status=0,k(!0)),he(a)}(t,e.row,e.rowIndex)},checked:1===e.getValue("status"),value:e.getValue("status"),name:"status",disabled:!C(Ce),color:"primary",className:Z.toggle,inputProps:{"aria-label":"secondary checkbox"}}))))},flex:1.5}];return a.createElement(a.Fragment,null,a.createElement(V(),{onPageSizeChange:function(e){v(e.pageSize)},onPageChange:function(e){g(e.page)},pagination:!0,paginationMode:"server",page:m,pageSize:f,rowCount:E,onFilterModelChange:Ge,rows:ve,loading:o||Le,columns:$e,getRowId:function(e){return(null==e?void 0:e.index)||e.productKey},columnBuffer:3,sortingMode:"server",disableSelectionOnClick:!0}),a.createElement(Ht,{open:R,onClose:function(){var e=ve;e[Fe].status=null==pe?void 0:pe.status,he(e),k(!1)},onOk:function(){S(null==pe?void 0:pe.entryKey,Re),k(!1)},dialogTitle:ze("changeProductRuleStatusConfirmationTitle"),dialogDescription:"".concat(ze("changeProductRuleStatusConfirmationDescription"))}),a.createElement(Ht,{open:P,onClose:function(){F(!1)},onOk:function(){b(null==pe?void 0:pe.entryKey),F(!1)},dialogTitle:ze("deleteProductRuleConfirmationTitle"),dialogDescription:"".concat(ze("deleteProductRuleConfirmationDescription"))}),a.createElement(Y.Z,{fullWidth:!0,maxWidth:"lg",open:W,onClose:function(){return _(!1)},"aria-labelledby":"product-variant-dialog"},a.createElement(te.Z,{className:Z.appBar},a.createElement(ne.Z,null,a.createElement($.Z,{variant:"h6",className:Z.title},ze("viewProductRangeRulesPageTitle")))),a.createElement(ee.Z,null,a.createElement("div",{style:{height:400,width:"100%"}},a.createElement(ln,{productData:At,productId:null==pe?void 0:pe.productKey,contractId:null==pe?void 0:pe.contractKey,updateRuleView:L,onRuleSelection:function(e,t){De(e),le(!(t.length>0))}}))),a.createElement(u.Z,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",marginBottom:"10px"},a.createElement(c.SeamlessButton,{type:"button",variant:"outlined",color:"primary",className:Z.btnSpace,onClick:function(){return _(!1)}},ze("ok")))),a.createElement(Y.Z,{fullWidth:!0,maxWidth:"lg",open:Q,onClose:function(){return re(!1)},"aria-labelledby":"product-variant-dialog"},a.createElement(te.Z,{className:Z.appBar},a.createElement(ne.Z,null,a.createElement($.Z,{variant:"h6",className:Z.title},ze("viewMoreProductsPageTitle",{product:(null===(t=At)||void 0===t?void 0:t.productName)||" product"})))),a.createElement(ee.Z,null,a.createElement("div",{style:{height:400,width:"100%"}},a.createElement(Et.Z,{component:St.Z},a.createElement(Tt.Z,null,a.createElement(bt.Z,{style:{borderBottom:1}},a.createElement(Ct.Z,null,a.createElement(Zt.Z,{className:Z.colHead},ze("productSku")),a.createElement(Zt.Z,{className:Z.colHead,align:"right"},ze("actions")))),a.createElement(wt.Z,null,At&&(null===(n=At)||void 0===n||null===(r=n.variants)||void 0===r?void 0:r.length)>0?At.variants.map((function(e,t){return a.createElement(Ct.Z,{key:e.variantId},a.createElement(Zt.Z,{component:"th",scope:"row"},e.productSKU),a.createElement(Zt.Z,{align:"right"},a.createElement(a.Fragment,null,"available"===e.status?a.createElement(J.ZP,{title:ze("addMargin",{item:e.productSKU})},a.createElement(G.Z,{onClick:function(){At={productName:e.productSKU,globalSku:e.productSKU,productKey:e.variantId,contractKey:w,currencyName:At.currencyName||"MNT",currencyId:1,supplierKey:At.supplierId,productType:At.productType,entryKey:0,status:1},re(!1),fe(At),j(!0),_(!0),le(!0)}},a.createElement(It.Z,{fontSize:"small"}))):a.createElement(Dt.Z,{color:"secondary",size:"small",label:ze("notAvailable")}))))})):a.createElement(Ct.Z,null,a.createElement(Zt.Z,{component:"th",scope:"row"},ze("noProductDataFound","Sorry, No product found")))))))),a.createElement(u.Z,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",marginBottom:"10px"},a.createElement(c.SeamlessButton,{type:"button",variant:"outlined",color:"primary",className:Z.btnSpace,onClick:function(){return re(!1)}},ze("cancel")))),a.createElement(Y.Z,{fullWidth:!0,maxWidth:"sm",open:We,onClose:function(){_e(!1)},"aria-labelledby":"csv-download-dialog"},a.createElement(ee.Z,{className:Z.dialogWrapper},a.createElement($.Z,{variant:"body1",className:Z.modalContentSpacing},ze("downloading")),a.createElement(ae.Z,null))))},Vt=function(e){var t=e.children,n=(0,s.useTranslation)().t,r=y(),o=r.showErrorMessage,i=r.showSuccessMessage,l=(r.showInfoMessage,r.showWarningMessage,a.useState(!1)),c=(0,p.Z)(l,2),u=c[0],d=c[1];return a.createElement(a.Fragment,null,t({handleActivateDeactivate:function(e,t){d(!0),function(e,t){return h("".concat(T,"/product-status-update/").concat(e,"?status=").concat(t),{method:"PUT",body:{}})}(e,t).then((function(e){i(n("statusChangedSuccessfully"))})).catch((function(e){return o(e)})).finally((function(){return d(!1)}))},loading:u}))},Wt=function(e){var t=e.children,n=(0,s.useTranslation)().t,r=y(),o=r.showErrorMessage,i=r.showSuccessMessage,l=a.useState(!1),c=(0,p.Z)(l,2),u=c[0],d=c[1];return a.createElement(a.Fragment,null,t({handleDelete:function(e){var t;d(!0),(t=e,h("".concat(T,"/contract-price-entries/").concat(t),{method:"DELETE"})).then((function(e){i(n("deleteProductRuleSuccessMessage"))})).catch((function(e){return o(e.apierror.message)})).finally((function(){return d(!1)}))},loading:u}))};var _t=(0,oe.Z)((function(e){return(0,ie.Z)({element:{margin:e.spacing(1)},wrapper:{width:"100%",margin:e.spacing(1)},width50:{width:"50%"},width100:{width:"100%"},autoCompleteSpacing:{paddingLeft:e.spacing(1.2),paddingRight:e.spacing(1.2)},heading:{fontSize:e.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0},progress:{marginLeft:"8px"}})}));const Kt=function(e){var t=e.data,n=e.loading,r=e.onFormSubmit,o=_t(),i=(0,s.useTranslation)().t,m=(0,l.useParams)().id,f=(0,l.useHistory)(),g=a.useState("panel1"),v=(0,p.Z)(g,2),E=v[0],S=v[1],T=a.useState(),b=(0,p.Z)(T,2),C=b[0],Z=b[1],w=a.useState(!1),D=(0,p.Z)(w,2),x=(D[0],D[1]),I=a.useState(!0),O=(0,p.Z)(I,2),R=O[0],k=O[1],N=y(),M=N.showErrorMessage,P=(N.showSuccessMessage,N.showInfoMessage,N.showWarningMessage,Pe.Ry().shape({resellerType:Pe.Z_().nullable(),importId:Pe.Z_().nullable(),name:Pe.Z_().nullable()})),F=(0,Fe.TA)({initialValues:t,validationSchema:P,onSubmit:function(e){return r(e)},enableReinitialize:!0}),A=F.values,B=F.handleChange,V=F.handleSubmit,W=F.handleReset;return F.setFieldValue,a.useEffect((function(){x(!0),h("/pms/v1/productCategory").then((function(e){Z(e.productCategories),k(!1)})).catch((function(e){M(i("anErrorOccurred"))})).finally((function(){return x(!1)}))}),[]),a.createElement("div",{className:o.wrapper},a.createElement(Ve.Z,{expanded:"panel1"===E,onChange:("panel1",function(e,t){S(!!t&&"panel1")})},a.createElement(_e.Z,{expandIcon:a.createElement(Ke.Z,null),"aria-controls":"panel1bh-content",id:"panel1bh-header"},a.createElement($.Z,{className:o.heading},a.createElement("strong",null,i("advancedSearch")))),a.createElement(We.Z,null,a.createElement(u.Z,{display:"flex",className:o.wrapper,flexDirection:"column"},a.createElement(u.Z,{display:"flex",flexDirection:"row",alignItems:"center"},a.createElement(ct.ZP,{disabled:R,className:(0,Be.default)(o.width100,o.autoCompleteSpacing),id:"categoryId",options:C,getOptionLabel:function(e){return e.name},onChange:function(e,t){B({target:{value:t.id,name:"categoryId"}})},renderInput:function(e){return a.createElement(rt.Z,(0,d.Z)({},e,{variant:"outlined",label:i("productCategories"),placeholder:i("productCategories"),id:"product-categories",value:A.categoryName}))}})),a.createElement(u.Z,{display:"flex",flexDirection:"row",alignItems:"center"},a.createElement(c.SeamlessDropDown,{id:"product-type-drop-down",fullWidth:!0,className:(0,Be.default)(o.element),label:i("productType"),helperText:i("pleaseSelectValue"),options:[{key:i("choose"),value:""},{key:i("serialised"),value:"serialised"},{key:i("non-serialised","non-serialised"),value:"non-serialised"},{key:i("services"),value:"services"},{key:i("trackable-non-serialised"),value:"trackable-non-serialised"},{key:i("services-b2b"),value:"services-b2b"},{key:i("services-topup"),value:"services-topup"},{key:i("services-custom"),value:"services-custom"},{key:i("batch"),value:"batch"}].map((function(e){return{value:e.value,key:e.key}})),name:"productType",value:A.productType,onChange:B}),a.createElement(c.SeamlessInput,{fullWidth:!0,className:(0,Be.default)(o.element),name:"productName",value:A.productName,onChange:B,helperText:i("pleaseEnterValue"),label:i("productName")})),a.createElement(u.Z,null,a.createElement(c.SeamlessButton,{onClick:function(){W(A),f.push("/home/contract/contracts/".concat(m,"/products?show=1"))},className:(0,Be.default)(o.element),color:"secondary",variant:"outlined"},i("resetSearch","Reset Search")),a.createElement(c.SeamlessButton,{onClick:function(e){return V()},className:(0,Be.default)(o.element),disabled:n,color:"primary",variant:"contained"},i("search","Search"),n&&a.createElement(Ae.Z,{color:"inherit",size:14,thickness:6,className:o.progress})))))))};var qt={productType:"",productName:"",categoryId:"",productIds:""},Lt=!0;const jt=function(){var e=(0,s.useTranslation)().t,t=(0,l.useParams)().id,n=r().useState(qt),a=(0,p.Z)(n,2),o=a[0],i=a[1],c=function(e){e&&i(e)};return r().useEffect((function(){Lt=!0,new URLSearchParams(window.location.search).has("show")&&(Lt=!1)}),[]),r().createElement(Vt,null,(function(n){var a=n.handleActivateDeactivate;return r().createElement(Wt,null,(function(n){var i=n.handleDelete,l=n.loading;return r().createElement(vt,{refresh:l,searchQuery:o},(function(n){var o=n.products,l=n.loading,s=n.totalCount,p=(0,m.Z)(n,["products","loading","totalCount"]);return r().createElement("div",{style:{height:600,width:"100%"}},Lt?r().createElement(u.Z,{display:"flex",flexDirection:"row",style:{marginTop:"2rem"},justifyContent:"flex-end"},r().createElement(et,{label:e("addMargin","Add Margin"),path:"/home/contract/contracts/".concat(t,"/products?show=1")})):r().createElement(Kt,{data:qt,loading:l,onFormSubmit:c}),r().createElement(Bt,(0,d.Z)({handleActivateDeactivate:a,handleDelete:i,products:o,loading:l,totalCount:s},p)))}))}))}))};var zt=(0,oe.Z)((function(e){return(0,ie.Z)({root:{marginTop:e.spacing(5),width:"100%",padding:e.spacing(2)},dialogWrapper:{textAlign:"center","& .MuiDialog-container":{width:"100%"},"& .MuiDialogContent-root":{marginTop:e.spacing(2),marginBottom:e.spacing(3),marginRight:"auto",marginLeft:"auto"}},fontHeavy:{fontWeight:e.typography.fontWeightBold},modalContentSpacing:{marginTop:e.spacing(3),marginBottom:e.spacing(3)},btnSpace:{marginRight:e.spacing(2)}})}));const Ht=function(e){var t=e.open,n=e.onClose,r=e.onOk,o=e.dialogTitle,i=e.dialogDescription,l=zt(),u=(0,s.useTranslation)().t;return a.createElement(c.SeamlessDialog,{open:t,onClose:n,className:l.dialogWrapper,maxWidth:"md",fullWidth:!0},a.createElement(c.SeamlessContainer,{title:o,description:i},a.createElement(a.Fragment,null,a.createElement(c.SeamlessButton,{type:"button",variant:"outlined",color:"primary",className:l.btnSpace,onClick:n},u("noConfirmationButton")),a.createElement(c.SeamlessButton,{type:"button",variant:"contained",color:"primary",onClick:r},u("yesConfirmationButton")))))};var Ut=function(e){var t=new Date(e);return new Date<t},Gt=function(e,t){var n="";return e.filter((function(e){e.id===t&&(n=e.accountType)})),n},Xt=function(e,t){var n="";return e.filter((function(e){e.contractTagId===t&&(n=e.tagName)})),n},$t=function(e,t){var n="";return e.filter((function(e){e.accountTypeKey===t&&(n=e.walletName)})),n},Qt=function(e,t){var n="";return e.filter((function(e){e.contractValueTypeId===t&&(n=e.valueType)})),n},Jt=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e};function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}const en=function(e){var t=e.children,n=e.productId,r=e.contractId,o=e.onlyFutureAllowed,i=e.values,c=y().showErrorMessage,u=((0,s.useTranslation)().t,(0,l.useHistory)(),a.useState({rules:[],comment:"",validFrom:!0,startDate:"",startTime:""})),d=(0,p.Z)(u,2),m=d[0],g=d[1],v=a.useState([]),E=(0,p.Z)(v,2),S=E[0],b=(E[1],a.useState(!1)),C=(0,p.Z)(b,2),Z=C[0],w=C[1],D=a.useState(0),x=(0,p.Z)(D,2),I=x[0],O=x[1],R=a.useState([]),k=(0,p.Z)(R,2),N=k[0],M=k[1],P=a.useState([]),F=(0,p.Z)(P,2),A=F[0],V=(F[1],a.useState([])),W=(0,p.Z)(V,2),_=W[0],K=(W[1],a.useState([])),q=(0,p.Z)(K,2),L=q[0],j=(q[1],a.useState([])),z=(0,p.Z)(j,2),H=z[0],U=(z[1],(0,l.useParams)().id),G=(0,B.useServerTable)({page:0,perPage:20,order:"asc",orderBy:"productName",filter:{}}),X=a.useCallback((function(){w(!0),h("/acms/contract-account-type/").then((function(e){return e.map((function(e){var t={id:e.id,accountType:e.accountType};A.push(t)})),h("/acms/contract-tag/")})).then((function(e){return e.map((function(e){var t={contractTagId:e.contractTagId,tagName:e.tagName};_.push(t)})),h("/acms/wallet-type/")})).then((function(e){return e.map((function(e){var t={accountTypeKey:e.accountTypeKey,walletId:e.walletId,walletName:e.walletName,description:e.description};L.push(t)})),h("/acms/contract-value-type/")})).then((function(e){e.map((function(e){var t={contractValueTypeId:e.contractValueTypeId,valueType:e.valueType};H.push(t)}));var t=-1!==location.pathname.indexOf("add-rules");return o||t?void 0:function(e,t){return h("".concat(T,"/contract-price-entries?contractId=").concat(e,"&productId=").concat(t))}(Number(U),n)})).then((function(e){var t;e&&(null===(t=e.contractPriceEntryList)||void 0===t?void 0:t.length)>0&&(e.contractPriceEntryList.map((function(e){if(!i||i.entryKey===e.entryKey){var t=e.validFrom,a=[];e.priceEntryRange.map((function(o,i){var l=o.fromAmount+"-"+o.toAmount,c={rangeFrom:o.fromAmount.toString(),rangeTo:o.toAmount.toString(),quantity:"",productRules:[],id:o.id};0===o.marginRules.length&&o.marginRules.push({validFrom:t,range:l.toString(),id:i,contractTag:"",contractAccountTypeId:"",accountId:"",valueExpression:"",productId:n,contractId:r,walletType:"",groupId:0,entryKey:o.entryKey?o.entryKey:void 0,entryKeyRange:void 0,valueType:0,isFuture:!1,comment:e.comment}),o.marginRules.map((function(a,o){var s=$(a);c.productRules.push({accountType:a.contractAccountTypeId?a.contractAccountTypeId:0,accountId:a.accountId?a.accountId:"",expressionValue:a.valueType?a.valueType:0,contractValue:a.valueExpression?a.valueExpression:"",groupId:a.groupId?a.groupId:0,ftlGrammar:s,walletType:a.walletType?a.walletType:0,tag:a.contractTag?a.contractTag:0});var u={validFrom:0===o&&0===i?t:"",range:0===o?l.toString():"",id:a.id,contractTag:Xt(_,a.contractTag),contractAccountTypeId:Gt(A,a.contractAccountTypeId),accountId:a.accountId?a.accountId:"",valueExpression:a.valueExpression?a.valueExpression:"",productId:n,contractId:r,walletType:$t(L,a.walletType),entryKey:a.entryKey,entryKeyRange:a.entryKeyRange,valueType:Qt(H,a.valueType),isFuture:Ut(t),comment:0===o&&0===i?e.comment:""};u.range&&S.push(u)})),a.push(c)})),g({rules:a,comment:e.comment,validFrom:!t,startTime:new Date(t).toISOString(),startDate:new Date(t).toISOString()})}})),M(e.contractPriceEntryList),O(e.totalCount))})).catch((function(e){return c(e)})).finally((function(){return w(!1)}))}),[G.page,G.perPage]),$=function(e){var t={expressions:[],amount:"",valueType:"per",conditions:[],operation:!0,ftlId:Jt(1e3,1e4)};if(e.ftlGrammar)return e.ftlGrammar.forEach((function(n,a){if(a!==e.ftlGrammar.length-1){var r={amount:"",paymentAgreement:"-",paymentMode:"-",transactionFromDate:(new Date).toISOString(),transactionFromTime:(new Date).toISOString(),transactionToDate:(new Date).toISOString(),transactionToTime:(new Date).toISOString(),receiverType:"-",weekDay:"-",gatewayCode:"-",regionCode:"-",areaCode:"-",territoryCode:"-",thanaCode:"-",operationType:"-",valueType:"per"};if(n.paymentMode&&(-1===t.conditions.indexOf("Payment Mode")&&t.conditions.push("Payment Mode"),r.paymentMode=n.paymentMode),n.paymentAgreement&&(-1===t.conditions.indexOf("Payment Agreement")&&t.conditions.push("Payment Agreement"),r.paymentAgreement=n.paymentAgreement),n.receiverType&&(-1===t.conditions.indexOf("Receiver Type")&&t.conditions.push("Receiver Type"),r.receiverType=n.receiverType),n.weekDay&&(-1===t.conditions.indexOf("Week Day")&&t.conditions.push("Week Day"),r.weekDay=n.weekDay),n.operationType&&(-1===t.conditions.indexOf("Operation Type")&&t.conditions.push("Operation Type"),r.operationType=n.operationType),n.transactionDate){-1===t.conditions.indexOf("Transaction Date")&&t.conditions.push("Transaction Date");var o=n.transactionDate.split("&");r.transactionFromDate=new Date(o[0]).toISOString(),r.transactionToDate=new Date(o[1]).toISOString()}if(n.transactionTime){-1===t.conditions.indexOf("Transaction Time")&&t.conditions.push("Transaction Time");var i=(new Date).toISOString().split("T")[0],l=n.transactionTime.split("&");r.transactionFromTime=new Date(i+" "+l[0]).toISOString(),r.transactionToTime=new Date(i+" "+l[1]).toISOString()}n.gatewayCode&&(-1===t.conditions.indexOf("Gateway Code")&&t.conditions.push("Gateway Code"),r.gatewayCode=n.gatewayCode),n.regionCode&&(-1===t.conditions.indexOf("Region Code")&&t.conditions.push("Region Code"),r.regionCode=n.regionCode),n.areaCode&&(-1===t.conditions.indexOf("Area Code")&&t.conditions.push("Area Code"),r.areaCode=n.areaCode),n.territoryCode&&(-1===t.conditions.indexOf("Territory Code")&&t.conditions.push("Territory Code"),r.territoryCode=n.territoryCode),n.thanaCode&&(-1===t.conditions.indexOf("Thana Code")&&t.conditions.push("Thana Code"),r.thanaCode=n.thanaCode),n.valueType&&(r.valueType=n.valueType),n.amount&&(r.amount=n.amount),t.expressions.push(r)}else n.valueType&&(t.valueType=n.valueType),n.amount&&(t.amount=n.amount)})),t};return a.useEffect((function(){X()}),[X]),a.createElement(a.Fragment,null,t(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({contractPriceEntryList:m,accountTypes:A,contractTags:_,walletTypes:L,valueTypes:H,originalResponse:N,update:-1!==location.pathname.indexOf("edit-rules")||-1!==location.pathname.indexOf("view-rules"),productsRule:S,loading:Z,totalCount:I},G)))};var tn=n(84278),nn=n(31807),an=(0,oe.Z)((function(e){return(0,ie.Z)({cellCustomColor:{backgroundColor:"#E6E6E6"},activeColor:{backgroundColor:"#00D100"},fontBold:{fontWeight:"bold",marginRight:e.spacing(.5)},skuTitle:{marginTop:e.spacing(2),marginBottom:e.spacing(3)},displayInline:{display:"inline-block"}})})),rn=0;const on=function(e){var t=e.loading,n=e.productsRule,r=e.productData,o=e.onPageChange,i=e.onPageSizeChange,c=e.totalCount,u=e.updateRuleView,d=(e.onRuleSelection,e.originalResponse),m=e.hideActions,f=void 0!==m&&m,g=an(),v=(0,l.useHistory)(),h=y().showInfoMessage,E=a.useState([]),S=(0,p.Z)(E,2),T=S[0],b=S[1],C=a.useState([]),Z=(0,p.Z)(C,2),w=(Z[0],Z[1],(0,s.useTranslation)().t);a.useEffect((function(){rn>0&&!t&&n.length<=0&&r&&(h("Margin is not yet defined for ".concat(r.productName,", Redirecting to Add screen")),v.push("/home/contract/contracts/".concat(r.contractKey,"/products/").concat(r.productKey,"/add-rules"),{data:r})),t?rn++:rn=0}),[t,n]);var D=function(e,t){var n=d.findIndex((function(t){return t.entryKey===e.entryKey}));e.hasOwnProperty("id")?v.replace("/home/contract/contracts/".concat(e.contractId,"/products/").concat(e.productId,"/").concat(t,"-rules/").concat(e.range),{data:r,values:e,rowIndex:n}):h(w("selectRule"))},x=[{field:"validFrom",headerName:w("validFrom"),sortable:!0,width:150,renderCell:function(e){return a.createElement(J.ZP,{title:e.getValue("validFrom")?(0,tn.Z)((0,nn.Z)(new Date(e.getValue("validFrom")).toISOString()),"dd-MM-yyyy HH:mm:ss"):""},a.createElement("div",null,e.getValue("validFrom")?(0,tn.Z)((0,nn.Z)(new Date(e.getValue("validFrom")).toISOString()),"dd-MM-yyyy HH:mm:ss"):""))},cellClassName:function(e){return e.getValue("isFuture")?"":g.activeColor},filterable:!1},{field:"range",headerName:w("range"),sortable:!0,flex:1,cellClassName:function(e){return e.getValue("isFuture")?"":g.activeColor},filterable:!1,renderCell:function(e){return a.createElement(J.ZP,{title:e.getValue("range")},a.createElement("div",null,e.getValue("range")))}},{field:"actions",headerName:w("actions"),sortable:!1,flex:1,cellClassName:g.cellCustomColor,filterable:!1,hide:f,renderCell:function(e){return a.createElement("div",null,a.createElement(X.Z,{size:"small",color:"primary",variant:"text","aria-label":"product rule types action buttons",className:g.displayInline},a.createElement(J.ZP,{title:w("view")},a.createElement(G.Z,{onClick:function(){return D(e.row,"view")}},a.createElement(ue.Z,{fontSize:"small"}))),u&&a.createElement(J.ZP,{title:w("edit")},a.createElement(G.Z,{onClick:function(){return D(e.row,"edit")}},a.createElement(se.Z,{fontSize:"small"})))))}}];return a.useEffect((function(){b(n)}),[T,n]),a.createElement(a.Fragment,null,null!=r&&r.globalSku?a.createElement("div",{className:g.skuTitle},a.createElement($.Z,{color:"primary",variant:"body1",display:"inline",className:g.fontBold},"".concat(w("productSku"),": ")),a.createElement($.Z,{variant:"body1",display:"inline"},r.globalSku)):"",a.createElement(V(),{onPageSizeChange:function(e){i(e.pageSize)},onPageChange:function(e){o(e.page)},rowCount:c,rows:T,loading:t,pageSize:0,columns:x,getRowId:function(e){return e.id},disableColumnFilter:!0,disableDensitySelector:!0,disableColumnSelector:!0,disableSelectionOnClick:!0}))},ln=function(e){var t=e.productId,n=e.updateRuleView,a=e.onRuleSelection,o=e.contractId,i=e.productData;return r().createElement(en,{productId:t,contractId:o},(function(e){var t=e.accountTypes,o=e.contractPriceEntryList,l=e.contractTags,c=e.walletTypes,s=e.valueTypes,u=e.originalResponse,p=e.update,f=e.productsRule,g=e.loading,y=e.totalCount,v=(0,m.Z)(e,["accountTypes","contractPriceEntryList","contractTags","walletTypes","valueTypes","originalResponse","update","productsRule","loading","totalCount"]);return r().createElement("div",{style:{height:600,width:"100%"}},r().createElement(on,(0,d.Z)({productsRule:f,loading:g,totalCount:y,productData:i,contractPriceEntryList:o,accountTypes:t,contractTags:l,valueTypes:s,originalResponse:u,walletTypes:c,updateRuleView:n,onRuleSelection:a,update:p},v)))}))};var cn=n(41262),sn=n(61837),un=n(73698),dn=n(12231),mn=n(49378),pn=n(28395),fn=n(9080);function gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gn(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var vn=(0,oe.Z)((function(e){return(0,ie.Z)({formControl:{margin:e.spacing(1),minWidth:120},selectInput:{width:"100%",lineHeight:"2em"},btnSpace:{marginRight:e.spacing(2)},button:{width:"100%"},element:{marginRight:e.spacing(1),marginBottom:e.spacing(2)},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1},form:{display:"flex",flexDirection:"column"},dateField:{margin:e.spacing(1),width:"100%"},spacingBottom:{marginBottom:e.spacing(2)},label:{color:"#292b2b",fontSize:"14px"},fontHeavy:{fontWeight:e.typography.fontWeightBold},inputHelper:{"& .MuiFormHelperText-root":{fontSize:"8px"}},fieldArrayWrapper:{border:"1px solid #EDEDED",marginLeft:"0",marginTop:"10px",width:"100%",borderRadius:"10px",padding:"10px",background:"#F7F7F7"},conditionCloseBtn:{marginLeft:"auto",marginRight:"auto",marginTop:e.spacing(1),marginBottom:e.spacing(1),display:"block"},fontBold:{fontWeight:"bold"}})})),hn=[{value:"-",key:"Select"}],En={};const Sn=function(e){var t,n,r,o,i,l,u=e.setOpenView,d=e.setFtlExpression,m=e.ftlExpression,f=e.ftlGrammarDetails,g=e.cancelFTLOperation,v=e.FTLSuccessCallback,E=e.addRuleRowCallback,S=e.regionCode,b=vn(),C=y(),Z=C.showErrorMessage,w=C.showSuccessMessage,D=(0,s.useTranslation)().t,x=(0,W.useSelector)((function(e){return e.auth})).user,I=a.useState([]),O=(0,p.Z)(I,2),R=O[0],k=O[1],N=a.useState(!1),M=(0,p.Z)(N,2),P=M[0],F=M[1],A=a.useState(!1),B=(0,p.Z)(A,2),V=B[0],_=B[1],K=a.useState(!1),q=(0,p.Z)(K,2),L=q[0],j=q[1],z=a.useState(!1),H=(0,p.Z)(z,2),U=H[0],G=H[1],X=a.useState(!1),Y=(0,p.Z)(X,2),ee=Y[0],te=Y[1],ne=a.useState(!1),ae=(0,p.Z)(ne,2),re=ae[0],oe=ae[1],ie=a.useState(!1),le=(0,p.Z)(ie,2),ce=le[0],se=le[1],ue=a.useState({}),de=(0,p.Z)(ue,2),me=de[0],pe=de[1],fe=a.useState({}),ge=(0,p.Z)(fe,2),ye=ge[0],ve=ge[1],he=a.useState({}),Ee=(0,p.Z)(he,2),Se=Ee[0],Te=Ee[1],be=(null===(t=window.config)||void 0===t||null===(n=t.contract)||void 0===n?void 0:n.isRegionCreateContract)||!1,Ce=Pe.Ry().shape({expressions:Pe.IX().of(Pe.Ry().shape({paymentMode:Pe.Z_().required(D("paymentModeRequired")),paymentAgreement:Pe.Z_().required(D("paymentAgreementRequired")),transactionFromDate:Pe.Z_().required(D("rangeRequired")),transactionToDate:Pe.Z_().required(D("rangeRequired")),transactionFromTime:Pe.Z_().required(D("rangeRequired")),transactionToTime:Pe.Z_().required(D("rangeRequired")),receiverType:Pe.Z_().required(D("receiverTypeRequired")),weekDay:Pe.Z_().required(D("weekDayRequired")),operationType:Pe.Z_().required(D("operationTypeRequired")),valueType:Pe.Z_().notOneOf(["-"],D("valueTypeRequired")),amount:Pe.Z_().required(D("amountRequired")),gatewayCode:Pe.Z_(),regionCode:Pe.Z_(),areaCode:Pe.Z_(),territoryCode:Pe.Z_(),thanaCode:Pe.Z_()})),conditions:Pe.IX().of(Pe.Z_()).min(1).required(D("conditionRequired")),valueType:Pe.Z_().notOneOf(["-"],D("valueTypeRequired")),amount:Pe.Z_().required(D("amountRequired")),operation:Pe.Z_()}),Ze=[{value:"-",key:"Select"},{value:"per",key:"Percentage"},{value:"abs",key:"Absolute"}],we=null==x||null===(r=x.info)||void 0===r||null===(o=r.additionalFields)||void 0===o?void 0:o.filter((function(e){return"regionCode"===(null==e?void 0:e.name)})),De=be&&(null===(i=we[0])||void 0===i?void 0:i.value),xe=0!==R.length?null===(l=R.filter((function(e){return"regionCode"===e.condition}))[0])||void 0===l?void 0:l.conditionOptions:[];De&&(xe=xe.filter((function(e){var t,n;return null===(t=we[0])||void 0===t||null===(n=t.value)||void 0===n?void 0:n.includes(e.split(":")[0])}))),a.useEffect((function(){j(!1),f&&0!==f.conditions.length?G(!0):G(!1)}),[f]),a.useEffect((function(){te(!1),F(!0),h("".concat(T,"/rule-condition")).then((function(e){var t=e.findIndex((function(e){return"valueType"===e.condition}));t>-1&&e.splice(t,1),k(e)})).catch((function(e){var t=e.apierror?e.apierror:e;t.subErrors&&0!==t.subErrors.length?t.subErrors.forEach((function(e){Z(e?"".concat(e.field," ").concat(e.message):D("anErrorOccurred"))})):Z(e.message||t.message||D("anErrorOccurred"))})).finally((function(){F(!1)}))}),[]);var Ie=function(e){var t=e.replace(/([A-Z])/g," $1");return t.charAt(0).toUpperCase()+t.slice(1)},Oe=function(e){var t=e.name;return a.createElement(Fe.gN,{name:t,render:function(e){var n=(0,Fe.u9)(e.form.errors,t),r=(0,Fe.u9)(e.form.touched,t);return a.createElement("span",{style:{color:"red"}},r&&n?n:null)}})},Re=function(e,t,n){return t.conditions.includes(Ie(e))&&"-"===n?(te(!0),a.createElement("span",{style:{color:"red"}},D("".concat(e,"Required")))):(te(!1),a.createElement("span",null))};a.useEffect((function(){var e;S&&ke(S),(null===(e=f.expressions)||void 0===e?void 0:e.length)>0&&f.expressions.forEach((function(e,t){S&&(f.expressions[t].regionCode=S),m&&(En[t]={territoryCode:!0,thanaCode:!0})}))}),[S]);var ke=function(e){_(!0),["-","ALL"].includes(e)?(pe({}),ve({}),Te({})):function(e){return h("".concat(T,"/rule-condition/subregions/").concat(e,"/level/2"))}(e).then((function(t){if(0==t.resultCode){var n=null==t?void 0:t.conditionOptions.map((function(e){var t=e.split(":"),n=t[0],a=t[1]||t[0];return{value:n,key:a.charAt(0).toUpperCase()+a.slice(1)}}));me[e]=(0,Me.Z)(n),pe(me)}else Z(t.resultDescription)})).catch((function(e){return Z(e)})).finally((function(){return _(!1)}))};return a.createElement(Fe.J9,{initialValues:f,onSubmit:function(e){return function(e){if(ee)Z(D("pleaseCheckTheErrors"));else if(0!==e.conditions.length){var t,n=e.expressions,a=[];0!==n.length&&n.forEach((function(t){var n="".concat((0,tn.Z)(new Date(t.transactionFromDate),"yyyy-MM-dd HH:mm:ss"),"&").concat((0,tn.Z)(new Date(t.transactionToDate),"yyyy-MM-dd HH:mm:ss")).trim(),r="".concat((0,tn.Z)(new Date(t.transactionFromTime),"HH:mm:ss"),"&").concat((0,tn.Z)(new Date(t.transactionToTime),"HH:mm:ss")).trim();a.push({paymentMode:e.conditions.indexOf("Payment Mode")>-1?t.paymentMode:void 0,paymentAgreement:e.conditions.indexOf("Payment Agreement")>-1?t.paymentAgreement:void 0,receiverType:e.conditions.indexOf("Receiver Type")>-1?t.receiverType:void 0,weekDay:e.conditions.indexOf("Week Day")>-1?t.weekDay:void 0,operationType:e.conditions.indexOf("Operation Type")>-1?t.operationType:void 0,amount:t.amount?t.amount:void 0,valueType:t.valueType?t.valueType:void 0,transactionDate:e.conditions.indexOf("Transaction Date")>-1?n:void 0,transactionTime:e.conditions.indexOf("Transaction Time")>-1?r:void 0,gatewayCode:e.conditions.indexOf("Gateway Code")>-1?"-"===t.gatewayCode?void 0:t.gatewayCode:void 0,regionCode:e.conditions.indexOf("Region Code")>-1?"-"===t.regionCode?void 0:t.regionCode:void 0,areaCode:e.conditions.indexOf("Area Code")>-1?"-"===t.areaCode?void 0:t.areaCode:void 0,territoryCode:e.conditions.indexOf("Territory Code")>-1?"-"===t.territoryCode?void 0:t.territoryCode:void 0,thanaCode:e.conditions.indexOf("Thana Code")>-1?"-"===t.thanaCode?void 0:t.thanaCode:void 0})})),a.push({amount:e.amount,valueType:e.valueType}),_(!0),(t=a,h("".concat(T,"/compute-expression"),{method:"POST",body:t})).then((function(t){if(t.freeMarkerExpression&&""!==t.freeMarkerExpression){var n=e.operation?t.freeMarkerExpression:"-".concat(t.freeMarkerExpression);w(t.resultDescription),j(!0),v(n,e)}else Z(t.resultDescription||D("anErrorOccurred"))})).catch((function(e){Z(e.message||D("anErrorOccurred"))})).finally((function(){_(!1)}))}else Z(D("selectOneCondition"))}(e)},validationSchema:Ce,enableReinitialize:!0},(function(e){var t=e.values,n=e.handleChange,r=e.errors,o=e.touched,i=e.isValid,l=e.dirty,s=e.setFieldValue;return a.createElement(Fe.l0,{className:b.form},a.createElement(He.Z,{container:!0,spacing:2,className:b.spacingBottom},a.createElement(He.Z,{item:!0,xs:4},a.createElement($.Z,{variant:"caption",className:(0,Be.default)(b.label,b.spacingBottom)},D("conditions"),"*",P&&a.createElement(Ae.Z,{color:"inherit",size:14,thickness:6,style:{marginLeft:"8px"}})),a.createElement(un.Z,{labelId:"conditions",id:"conditions",multiple:!0,required:0===t.conditions.length,className:b.selectInput,name:"conditions",value:t.conditions,open:ce,onOpen:function(){return se(!0)},onClose:function(){return se(!1)},onChange:n,disabled:P,renderValue:function(e){return a.createElement(J.ZP,{title:e.join(", ")},a.createElement("span",null,e.join(", ")))}},R.map((function(e){var n=e.condition;return a.createElement(dn.Z,{key:n,value:Ie(n)},a.createElement(at.Z,{checked:t.conditions&&t.conditions.indexOf(Ie(n))>-1}),a.createElement(mn.Z,{primary:Ie(n)}))})),a.createElement(c.SeamlessButton,{size:"small",color:"primary",variant:"contained",className:b.conditionCloseBtn,onClick:function(){se(!1)}},D("ok"))))),a.createElement(Fe.F2,{name:"expressions",render:function(e){e.insert;var r=e.remove,o=e.push;return a.createElement(a.Fragment,null,t&&t.expressions.length>0&&a.createElement(a.Fragment,null,t.expressions.map((function(e,o){var i,l,u,d,m,p,f,g,y,v,E,C,w,x;return a.createElement(He.Z,{key:"expression-".concat(o),container:!0,alignItems:"center",spacing:2,className:(0,Be.default)(b.spacingBottom,b.fieldArrayWrapper)},a.createElement(He.Z,{item:!0,xs:12},function(e,t){var n=a.createElement("span",null),r=e.expressions[t];return["Gateway Code","Region Code","Area Code","Territory Code","Thana Code"].map((function(t){e.conditions.includes(t)&&("-"===r.areaCode&&"-"===r.gatewayCode&&"-"===r.regionCode&&"-"===r.territoryCode&&"-"===r.thanaCode?(oe(!0),n=a.createElement("span",{style:{color:"red"}},D("Please select atlease one dropdown value"))):(oe(!1),n=a.createElement("span",null)))})),n}(t,o)),t.conditions.indexOf("Payment Mode")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,id:"expressions[".concat(o,"].Payment Mode"),name:"expressions[".concat(o,"].paymentMode"),value:e.paymentMode,required:t.conditions.indexOf("Payment Mode")>-1,label:D("paymentMode"),onChange:n,options:["Select"].concat((0,Me.Z)(0!==R.length?null===(i=R.filter((function(e){return"paymentMode"===e.condition}))[0])||void 0===i?void 0:i.conditionOptions:[])).map((function(e){return{value:"Select"===e?"-":e,key:e.charAt(0).toUpperCase()+e.slice(1)}}))}),Re("paymentMode",t,e.paymentMode)),t.conditions.indexOf("Payment Agreement")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,id:"expressions[".concat(o,"].paymentAgreement"),name:"expressions[".concat(o,"].paymentAgreement"),value:e.paymentAgreement,label:D("paymentAgreement"),required:t.conditions.indexOf("Payment Agreement")>-1,onChange:n,options:["Select"].concat((0,Me.Z)(0!==R.length?null===(l=R.filter((function(e){return"paymentAgreement"===e.condition}))[0])||void 0===l?void 0:l.conditionOptions:[])).map((function(e){return{value:"Select"===e?"-":e,key:e.charAt(0).toUpperCase()+e.slice(1)}}))}),Re("paymentAgreement",t,e.paymentAgreement)),t.conditions.indexOf("Receiver Type")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,id:"expressions[".concat(o,"].receiverType"),name:"expressions[".concat(o,"].receiverType"),value:e.receiverType,label:D("receiverType"),required:t.conditions.indexOf("Receiver Type")>-1,onChange:n,options:["Select"].concat((0,Me.Z)(0!==R.length?null===(u=R.filter((function(e){return"receiverType"===e.condition}))[0])||void 0===u?void 0:u.conditionOptions[0].split(","):[])).map((function(e){return{value:e.split(":")[0]?"Select"===e?"-":e.split(":")[0]:"",key:"Select"!==e?e.split(":")[1]:e}})).filter((function(e){return""!==e.key}))}),Re("receiverType",t,e.receiverType)),t.conditions.indexOf("Week Day")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,id:"expressions[".concat(o,"].weekDay"),name:"expressions[".concat(o,"].weekDay"),value:e.weekDay,label:D("weekDay"),required:t.conditions.indexOf("Week Day")>-1,onChange:n,options:["Select"].concat((0,Me.Z)(0!==R.length?null===(d=R.filter((function(e){return"weekDay"===e.condition}))[0])||void 0===d?void 0:d.conditionOptions:[])).map((function(e){return{value:"Select"===e?"-":e,key:e.charAt(0).toUpperCase()+e.slice(1)}}))}),Re("weekDay",t,e.weekDay)),t.conditions.indexOf("Operation Type")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,id:"expressions[".concat(o,"].operationType"),name:"expressions[".concat(o,"].operationType"),value:e.operationType,label:D("operationType"),required:t.conditions.indexOf("Operation Type")>-1,onChange:n,options:["Select"].concat((0,Me.Z)(0!==R.length?null===(m=R.filter((function(e){return"operationType"===e.condition}))[0])||void 0===m?void 0:m.conditionOptions:[])).map((function(e){return{value:"Select"===e?"-":e,key:e.charAt(0).toUpperCase()+e.slice(1)}}))}),Re("operationType",t,e.operationType)),t.conditions.indexOf("Transaction Date")>-1&&a.createElement(ot.M,{utils:nt.Z},a.createElement(He.Z,{item:!0,xs:2,style:{paddingLeft:"0"}},a.createElement(fn.B,{fullWidth:!0,autoOk:!0,className:(0,Be.default)(b.dateField),disableToolbar:!0,variant:"inline",format:"dd/MM/yyyy HH:mm:ss",margin:"normal",id:"transactionFromDate",disablePast:!0,required:t.conditions.indexOf("Transaction Date")>-1,label:D("transactionFromDate"),name:"expressions[".concat(o,"].transactionFromDate"),value:e.transactionFromDate,onChange:function(e){null!=e&&e.getDate()?n({target:{value:null==e?void 0:e.toISOString(),name:"expressions[".concat(o,"].transactionFromDate")}}):n({target:{value:"",name:"expressions[".concat(o,"].transactionFromDate")}})},KeyboardButtonProps:{"aria-label":"change date"}})),a.createElement(He.Z,{item:!0,xs:2,style:{paddingLeft:"0"}},a.createElement(fn.B,{fullWidth:!0,autoOk:!0,className:(0,Be.default)(b.dateField),disableToolbar:!0,variant:"inline",format:"dd/MM/yyyy HH:mm:ss",margin:"normal",id:"transactionToDate",disablePast:!0,required:t.conditions.indexOf("Transaction Date")>-1,label:D("transactionToDate"),name:"expressions[".concat(o,"].transactionToDate"),value:e.transactionToDate,onChange:function(e){null!=e&&e.getDate()?n({target:{value:null==e?void 0:e.toISOString(),name:"expressions[".concat(o,"].transactionToDate")}}):n({target:{value:"",name:"expressions[".concat(o,"].transactionToDate")}})},KeyboardButtonProps:{"aria-label":"change date"}}))),t.conditions.indexOf("Transaction Time")>-1&&a.createElement(ot.M,{utils:nt.Z},a.createElement(He.Z,{item:!0,xs:2},a.createElement(lt.e,{className:(0,Be.default)(b.dateField),margin:"normal",format:"HH:mm:ss",required:t.conditions.indexOf("Transaction Time")>-1,label:D("transactionFromTime"),value:e.transactionFromTime,name:"expressions[".concat(o,"].transactionFromTime"),onChange:function(e){null!=e&&e.getDate()?n({target:{value:null==e?void 0:e.toISOString(),name:"expressions[".concat(o,"].transactionFromTime")}}):n({target:{value:"",name:"expressions[".concat(o,"].transactionFromTime")}})},KeyboardButtonProps:{"aria-label":"change time"}})),a.createElement(He.Z,{item:!0,xs:2},a.createElement(lt.e,{className:(0,Be.default)(b.dateField),margin:"normal",format:"HH:mm:ss",required:t.conditions.indexOf("Transaction Time")>-1,label:D("transactionToTime"),value:e.transactionToTime,name:"expressions[".concat(o,"].transactionToTime"),onChange:function(e){null!=e&&e.getDate()?n({target:{value:null==e?void 0:e.toISOString(),name:"expressions[".concat(o,"].transactionToTime")}}):n({target:{value:"",name:"expressions[".concat(o,"].transactionToTime")}})},KeyboardButtonProps:{"aria-label":"change time"}}))),t.conditions.indexOf("Gateway Code")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,id:"expressions[".concat(o,"].Gateway Code"),name:"expressions[".concat(o,"].gatewayCode"),value:e.gatewayCode,label:D("gatewayCode"),onChange:n,options:["Select"].concat((0,Me.Z)(0!==R.length?null===(p=R.filter((function(e){return"gatewayCode"===e.condition}))[0])||void 0===p?void 0:p.conditionOptions:[])).map((function(e){var t=e.split(":"),n=t[1]||t[0];return{value:"Select"===e?"-":t[0],key:n.charAt(0).toUpperCase()+n.slice(1)}}))})),t.conditions.indexOf("Region Code")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,disabled:!(!S||"ALL"===S),id:"expressions[".concat(o,"].Region Code"),name:"expressions[".concat(o,"].regionCode"),value:e.regionCode,label:D("regionCode"),onChange:function(n){if(ke(n.target.value),e.regionCode!=n.target.value){var a=yn({},t.expressions[o]);a.regionCode=n.target.value,a.areaCode="-",a.territoryCode="-",a.thanaCode="-",t.expressions[o]=a,En[o]={territoryCode:!0,thanaCode:!0},s("expressions",t.expressions)}},options:["Select"].concat((0,Me.Z)(xe)).map((function(e){var t=e.split(":"),n=t[1]||t[0];return{value:"Select"===e?"-":t[0],key:n.charAt(0).toUpperCase()+n.slice(1)}}))})),t.conditions.indexOf("Area Code")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,id:"expressions[".concat(o,"].Area Code"),name:"expressions[".concat(o,"].areaCode"),value:e.areaCode,label:D("areaCode"),onChange:function(n){if(r=n.target.value,_(!0),["-","ALL"].includes(r)?(ve({}),Te({})):function(e){return h("".concat(T,"/rule-condition/subregions/").concat(e,"/level/3"))}(r).then((function(e){if(0==e.resultCode){var t=null==e?void 0:e.conditionOptions.map((function(e){var t=e.split(":"),n=t[0],a=t[1]||t[0];return{value:n,key:a.charAt(0).toUpperCase()+a.slice(1)}}));ye[r]=(0,Me.Z)(t),ve(ye)}else Z(e.resultDescription)})).catch((function(e){return Z(e)})).finally((function(){return _(!1)})),e.areaCode!=n.target.value){var a=yn({},t.expressions[o]);a.areaCode=n.target.value,a.territoryCode="-",a.thanaCode="-",t.expressions[o]=a,En[o]={territoryCode:!1,thanaCode:!0},s("expressions",t.expressions)}var r},options:(null===(f=me[e.regionCode])||void 0===f?void 0:f.length)>0?[].concat(hn,(0,Me.Z)(me[e.regionCode])):["Select"].concat((0,Me.Z)(0!==R.length?null===(g=R.filter((function(e){return"areaCode"===e.condition}))[0])||void 0===g?void 0:g.conditionOptions:[])).map((function(e){var t=e.split(":"),n=t[1]||t[0];return{value:"Select"===e?"-":t[0],key:n.charAt(0).toUpperCase()+n.slice(1)}}))})),t.conditions.indexOf("Territory Code")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,disabled:null===(y=En[o])||void 0===y?void 0:y.territoryCode,id:"expressions[".concat(o,"].Territory Code"),name:"expressions[".concat(o,"].territoryCode"),value:e.territoryCode,label:D("territoryCode"),onChange:function(n){if(r=n.target.value,_(!0),["-","ALL"].includes(r)?Te({}):function(e){return h("".concat(T,"/rule-condition/subregions/").concat(e,"/level/4"))}(r).then((function(e){if(0==e.resultCode){var t=null==e?void 0:e.conditionOptions.map((function(e){var t=e.split(":"),n=t[0],a=t[1]||t[0];return{value:n,key:a.charAt(0).toUpperCase()+a.slice(1)}}));Se[r]=(0,Me.Z)(t),Te(Se)}else Z(e.resultDescription)})).catch((function(e){return Z(e)})).finally((function(){return _(!1)})),e.territoryCode!=n.target.value){var a=yn({},t.expressions[o]);a.territoryCode=n.target.value,a.thanaCode="-",t.expressions[o]=a,En[o]={thanaCode:!1},s("expressions",t.expressions)}var r},options:(null===(v=ye[e.areaCode])||void 0===v?void 0:v.length)>0?[].concat(hn,(0,Me.Z)(ye[e.areaCode])):["Select"].concat((0,Me.Z)(0!==R.length?null===(E=R.filter((function(e){return"territoryCode"===e.condition}))[0])||void 0===E?void 0:E.conditionOptions:[])).map((function(e){var t=e.split(":"),n=t[1]||t[0];return{value:"Select"===e?"-":t[0],key:n.charAt(0).toUpperCase()+n.slice(1)}}))})),t.conditions.indexOf("Thana Code")>-1&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,disabled:null===(C=En[o])||void 0===C?void 0:C.thanaCode,id:"expressions[".concat(o,"].Thana Code"),name:"expressions[".concat(o,"].thanaCode"),value:e.thanaCode,label:D("thanaCode"),onChange:n,options:(null===(w=Se[e.territoryCode])||void 0===w?void 0:w.length)>0?[].concat(hn,(0,Me.Z)(Se[e.territoryCode])):["Select"].concat((0,Me.Z)(0!==R.length?null===(x=R.filter((function(e){return"thanaCode"===e.condition}))[0])||void 0===x?void 0:x.conditionOptions:[])).map((function(e){var t=e.split(":"),n=t[1]||t[0],a=" ("+t[0]+")";return{value:"Select"===e?"-":t[0],key:n.charAt(0).toUpperCase()+n.slice(1)+"".concat("Select"!==e?a:"")}}))})),a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,id:"expressions[".concat(o,"].valueType"),name:"expressions[".concat(o,"].valueType"),value:e.valueType,label:D("valueType"),required:!0,onChange:n,options:Ze}),a.createElement(Oe,{name:"expressions[".concat(o,"].valueType")})),a.createElement(He.Z,{item:!0,xs:1},a.createElement(c.SeamlessInput,{fullWidth:!0,required:!0,id:"expressions[".concat(o,"].amount"),name:"expressions[".concat(o,"].amount"),value:e.amount,label:D("amount"),onChange:function(e){(""===e.target.value||/^[+-]?\d*(?:[.,]\d*)?$/.test(e.target.value))&&n(e)}})),a.createElement(Oe,{name:"expressions[".concat(o,"].amount")}),0!==o&&a.createElement(He.Z,{item:!0,xs:1},a.createElement(sn.Z,{onClick:function(){return r(o)},size:"small",color:"primary"},a.createElement(Q.Z,null,"delete"))))}))),a.createElement(He.Z,{container:!0,spacing:2,className:b.spacingBottom},a.createElement(He.Z,{item:!0,xs:3},a.createElement(c.SeamlessButton,{variant:"outlined",type:"button",className:b.button,startIcon:a.createElement(Ye.Z,null),onClick:function(){var e;S&&(En[null===(e=t.expressions)||void 0===e?void 0:e.length]={territoryCode:!0,thanaCode:!0}),o({amount:"",paymentAgreement:"-",paymentMode:"-",transactionFromDate:(new Date).toISOString(),transactionToDate:(new Date).toISOString(),transactionFromTime:(new Date).toISOString(),transactionToTime:(new Date).toISOString(),receiverType:"-",weekDay:"-",operationType:"-",valueType:"per",gatewayCode:"-",regionCode:S||"-",areaCode:"-",territoryCode:"-",thanaCode:"-"})}},D("addEntities")))))}}),a.createElement(He.Z,{container:!0,alignItems:"center",spacing:2,className:(0,Be.default)(b.spacingBottom,b.fieldArrayWrapper)},a.createElement(He.Z,{item:!0,xs:12},a.createElement($.Z,{variant:"body1",className:b.fontBold},D("elseConditions"))),a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{fullWidth:!0,id:"valueType",name:"valueType",required:!0,value:t.valueType,label:D("valueType"),error:!(!o.valueType||!r.valueType),helperText:o.valueType&&r.valueType?D("valueTypeRequired"):void 0,onChange:n,options:Ze})),a.createElement(He.Z,{item:!0,xs:1},a.createElement(c.SeamlessInput,{fullWidth:!0,id:"amount",required:!0,name:"amount",error:!(!o.amount||!r.amount),value:t.amount,helperText:o.amount&&r.amount?D("amountRequired"):void 0,label:D("amount"),onChange:function(e){(""===e.target.value||/^[+-]?\d*(?:[.,]\d*)?$/.test(e.target.value))&&n(e)}}))),a.createElement("div",{className:b.spacingBottom},a.createElement($.Z,{variant:"caption",className:b.label},D("expressionType"),a.createElement(J.ZP,{title:a.createElement("span",null,D("expressionTypeTooltip")),placement:"top-start"},a.createElement(pn.Z,{style:{fontSize:"16px",cursor:"pointer"}}))),a.createElement("div",null,a.createElement($.Z,{variant:"caption",style:{marginBottom:"0"},className:(0,Be.default)(t.operation?"":b.fontHeavy)},D("debit")),a.createElement(ht.Z,{checked:t.operation,color:"primary",onChange:n,name:"operation"}),a.createElement($.Z,{variant:"caption",className:(0,Be.default)(t.operation?b.fontHeavy:"")},D("credit")))),a.createElement(He.Z,{container:!0,spacing:2,className:b.spacingBottom},a.createElement(He.Z,{item:!0,xs:3},a.createElement(c.SeamlessButton,{variant:"contained",type:"submit",className:b.button,startIcon:a.createElement(Ye.Z,null),disabled:U?!i:!!re||!(i&&l),onSubmit:function(e){return e.preventDefault()}},D("validate"),V&&a.createElement(Ae.Z,{color:"inherit",size:14,thickness:6,style:{marginLeft:"8px"}}))),!m&&a.createElement(He.Z,{item:!0,xs:3},a.createElement(c.SeamlessButton,{variant:"outlined",type:"button",className:b.button,onClick:g},D("cancel")))),m&&a.createElement(a.Fragment,null,a.createElement(He.Z,{container:!0,alignItems:"center",spacing:2,className:(0,Be.default)(b.spacingBottom,b.fieldArrayWrapper)},a.createElement(c.SeamlessInput,{fullWidth:!0,name:"ftlExpression",value:m,label:D("ftlExpressions"),disabled:!0,onChange:function(e){v(e.target.value,t),d(e.target.value)}})),a.createElement(He.Z,{container:!0,spacing:2,className:b.spacingBottom},a.createElement(He.Z,{item:!0,xs:3},a.createElement(c.SeamlessButton,{variant:"outlined",type:"button",className:b.button,disabled:!L,onClick:function(e){u(!1),E()}},D("ok"))),a.createElement(He.Z,{item:!0,xs:3},a.createElement(c.SeamlessButton,{variant:"outlined",type:"button",className:b.button,onClick:g},D("cancel"))))))}))};var Tn=n(36717),bn=n(89587),Cn=n(15459),Zn=n(87685),wn=(0,Cn.Z)((function(e){return(0,ie.Z)({root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}})}))((function(e){var t=e.children,n=e.classes,a=e.onClose,o=(0,m.Z)(e,["children","classes","onClose"]);return r().createElement(ze.Z,(0,d.Z)({disableTypography:!0,className:n.root},o),r().createElement($.Z,{variant:"h6"},t),a?r().createElement(sn.Z,{"aria-label":"close",className:n.closeButton,onClick:a},r().createElement(Zn.Z,null)):null)})),Dn=(0,Cn.Z)((function(e){return{root:{padding:e.spacing(2)}}}))(ee.Z),xn=(0,Cn.Z)((function(e){return{root:{margin:0,padding:e.spacing(1)}}}))(je.Z);const In=function(e){var t=e.open,n=e.title,a=e.content,o=e.actions,i=(e.handleClickOpen,e.handleClose);return r().createElement("div",null,r().createElement(Y.Z,{onClose:i,fullWidth:!0,maxWidth:"md","aria-labelledby":"customized-dialog-title",open:t},r().createElement(wn,{id:"customized-dialog-title",onClose:i},n),r().createElement(Dn,{dividers:!0},a),o&&r().createElement(xn,null,o)))};var On=(0,oe.Z)((function(e){return(0,ie.Z)({fieldArrayWrapper:{border:"1px solid #EDEDED",marginLeft:"0",marginTop:"10px",width:"100%",borderRadius:"10px",padding:"10px",background:"#F7F7F7"},table:{minWidth:650},spacingBottom:{marginBottom:e.spacing(2)},tableHead:{backgroundColor:e.palette.primary.main},tableRow:{"& th":{color:e.palette.primary.contrastText},"& .MuiTableCell-sizeSmall:first-child":{borderLeft:"1px solid ".concat(e.palette.divider," !important")},"& .MuiTableCell-sizeSmall":{borderBottom:"1px solid ".concat(e.palette.divider," !important"),borderRight:"1px solid ".concat(e.palette.divider," !important")}}})}));const Rn=function(){(0,s.useTranslation)().t;var e=On(),t=function(e,t,n,a,r,o,i,l,c){return{id:e,accountType:t,contractValue:n,value:a,amount1:r,amount2:o,amount3:i,amount4:l,amount5:c}},n=[{id:1,type:"Expression and Absolute",data:[t(1,"Sender","-x","Expression","-500","-400","-300","-200","-100"),t(2,"Receiver","x-3000","Expression","470","370","270","170","30"),t(3,"TAX","1000","Absolute","10","10","10","10","10"),t(4,"Fee","1000","Absolute","10","10","10","10","10"),t(5,"BONUS","500","Absolute","5","5","5","5","5"),t(6,"Comission","500","Absolute","5","5","5","5","5"),t(7,"","","","0","0","0","0","0")]},{id:2,type:"Percentage and Absolute",data:[t(1,"Sender","-10000","Expression","-500","-400","-300","-200","-100"),t(2,"Receiver","8000","Expression","400","320","240","160","80"),t(3,"TAX","1000","Percentage","50","40","30","20","10"),t(4,"Fee","1000","Percentage","50","40","30","20","10"),t(5,"BONUS","2000","Absolute","20","20","20","20","20"),t(6,"Operator","-2000","Absolute","-20","-20","-20","-20","-20"),t(7,"","","","0","0","0","0","0")]},{id:3,type:"Only Percentage",data:[t(1,"Sender","-10000","Percentage","-500","-400","-300","-200","-100"),t(2,"Receiver","8000","Percentage","400","320","240","160","80"),t(3,"TAX","1000","Percentage","50","40","30","20","10"),t(4,"Fee","500","Percentage","25","20","15","10","5"),t(5,"BONUS","500","Percentage","25","20","15","10","5"),t(6,"","","","0","0","0","0","0")]},{id:4,type:"Only Expression",data:[t(1,"Sender","-x","Expression","-500","-400","-300","-200","-100"),t(2,"Receiver","x-(x*10/100+x*10/100+x*10/100)","Expression","350","280","210","140","70"),t(3,"TAX","x*10/100","Expression","50","40","30","20","10"),t(4,"Fee","x*10/100","Expression","50","40","30","20","10"),t(5,"BONUS","x*10/100","Expression","50","40","30","20","10"),t(6,"","","","0","0","0","0","0")]},{id:5,type:"Only Absolute",data:[t(1,"Sender","-10000","Absolute","-100","-100","-100","-100","-100"),t(2,"Receiver","8000","Absolute","80","80","80","80","80"),t(3,"BONUS","1000","Absolute","10","10","10","10","10"),t(4,"TAX","1000","Absolute","10","10","10","10","10"),t(5,"","","","0","0","0","0","0")]}];return a.createElement(a.Fragment,null,a.createElement("h3",null,"Combination of Value types for margin rules can be any of the follows"),a.createElement("div",{className:e.spacingBottom},a.createElement("p",null,"Total Absolute"),a.createElement("p",null,"Total Percentage"),a.createElement("p",null,"Total expression"),a.createElement("p",null,"Combination of Absolute and expression"),a.createElement("p",null,"Combination of Absolute and Percentage"),a.createElement("p",null,"If Contract Value =10000 absolute, it means 100(Absolute)"),a.createElement("p",null,"If Contract Value =10000 percentage it means 100(percentage)")),n.map((function(t){return a.createElement(Et.Z,{component:St.Z,className:e.spacingBottom},a.createElement(Tt.Z,{className:e.table,size:"small","aria-label":t.type},a.createElement(bt.Z,{className:e.tableHead},a.createElement(Ct.Z,{className:e.tableRow},a.createElement(Zt.Z,{colSpan:8,align:"center",style:{fontWeight:"bold"}},-1!==t.type.indexOf("and")?"Example ".concat(t.id,": Combination of ").concat(t.type," (0-500)"):"Example ".concat(t.id,": ").concat(t.type," (0-500)"))),a.createElement(Ct.Z,{className:e.tableRow},a.createElement(Zt.Z,null,"Account Type"),a.createElement(Zt.Z,{align:"center"},"Contract Value"),a.createElement(Zt.Z,{align:"center"},"Value"),a.createElement(Zt.Z,{align:"center",colSpan:5},"Amount"))),a.createElement(wt.Z,null,t.data.map((function(t){return a.createElement(Ct.Z,{key:t.id,className:e.tableRow},a.createElement(Zt.Z,null,t.accountType),a.createElement(Zt.Z,{align:"center"},t.contractValue),a.createElement(Zt.Z,{align:"center"},t.value),a.createElement(Zt.Z,{align:"center"},t.amount1),a.createElement(Zt.Z,{align:"center"},t.amount2),a.createElement(Zt.Z,{align:"center"},t.amount3),a.createElement(Zt.Z,{align:"center"},t.amount4),a.createElement(Zt.Z,{align:"center"},t.amount5))})))))})),a.createElement("div",{className:e.spacingBottom},a.createElement("h3",null,"FTL Example"),a.createElement("p",null,"A user can select conditions e.g Payment Agreement, Payment mode, Transaction Date and Time, Receiver Type, Week Day, and then define the values for each condition. This will generate the IF part of the FTL and ELSE is a default part. An example of an FTL is as follows:"),a.createElement("div",{className:e.fieldArrayWrapper},a.createElement($.Z,{gutterBottom:!0},"<#if paymentAgreement?matches('upfront') && paymentMode?matches('cash')>5per\n<#elseif paymentAgreement?matches('pod') && paymentMode?matches('cash')>4per\n<#elseif paymentAgreement?matches('pod') && paymentMode?matches('card')>3per\n<#elseif paymentAgreement?matches('pod') && (transactionDate?datetime('yyyy-MM-dd HH:mm:ss') >= '2021-06-20 12:12:12'?datetime('yyyy-MM-dd HH:mm:ss') && transactionDate?datetime('yyyy-MM-dd HH:mm:ss') <= '2021-06-25 12:12:12'?datetime('yyyy-MM-dd HH:mm:ss'))>1.3per\n<#elseif weekDay?matches('Fri') && (transactionTime?datetime('HH:mm:ss') >= '10:12:12'?datetime('HH:mm:ss') && transactionTime?datetime('HH:mm:ss') <= '12:12:12'?datetime('HH:mm:ss'))>1.9per\n<#else>1abs</#if>"))))};function kn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Nn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kn(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Mn=(0,oe.Z)((function(e){return(0,ie.Z)({formControl:{margin:e.spacing(1),minWidth:120},selectInput:{width:"100%",lineHeight:"2em"},btnSpace:{marginRight:e.spacing(2)},button:{width:"100%"},element:{marginRight:e.spacing(1),marginBottom:e.spacing(2)},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1},form:{display:"flex",flexDirection:"column"},dateField:{margin:e.spacing(1),width:"100%"},spacingBottom:{marginBottom:e.spacing(2)},spacingTop:{marginTop:e.spacing(2)},label:{color:"#292b2b",fontSize:"14px"},fontHeavy:{fontWeight:e.typography.fontWeightBold},inputHelper:{"& .MuiFormHelperText-root":{fontSize:"8px"}},fieldArrayWrapper:{border:"1px solid #EDEDED",marginLeft:"0",marginTop:"10px",width:"100%",borderRadius:"10px",padding:"10px",background:"#F7F7F7"},fontBold:{fontWeight:"bold",marginRight:e.spacing(.5)},clear:{clear:"both"}})})),Pn=[],Fn=[{value:" ",key:"Select"}];const An=function(e){var t,n,r=e.isVariablePrice,o=e.onlyFutureAllowed,i=e.update,u=e.accountTypes,d=e.contractTags,m=e.valueTypes,f=e.walletTypes,g=e.productDetails,v=e.changeChildValues,E=e.contractValueInputName,S=e.ftlExpression,T=e.FTLValues,b=e.ftlCallback,C=Mn(),Z=(0,l.useHistory)(),w=y().showErrorMessage,D=(0,s.useTranslation)().t,x=(0,Fe.u6)(),I=x.values,O=x.handleChange,R=x.errors,k=x.isValid,N=x.dirty,M=x.setFieldValue,P=x.setValues,F=a.useState(!1),A=(0,p.Z)(F,2),B=A[0],V=A[1],W=a.useState(!1),_=(0,p.Z)(W,2),K=(_[0],_[1]),q=a.useState(!1),L=(0,p.Z)(q,2),j=L[0],z=L[1],H=a.useState(Fn),U=(0,p.Z)(H,2),G=U[0],X=U[1],J=null!=g&&g.contractId?g.contractId:null==g?void 0:g.contractKey,Y=function(){V(!0)},ee=function(){V(!1)},te="";g&&(te+=g.productName,g.denominationValue>0&&(te+=" - (".concat(g.denominationValue,")")));var ne=window.config.openCalendarWith||"year",ae=(null===(t=window.config)||void 0===t||null===(n=t.contract)||void 0===n?void 0:n.isAccountTypeFixedAsDropdown)||!1,re=a.useCallback((function(){var e=!0;return Pn.length>0?X(Pn):(K(!0),h("/acms/bookkeeping-accounts").then((function(t){if(t.length>0){var n=t.map((function(e){var t=e.split(":"),n=t[0],a=t[1]||t[0];return{value:n,key:a.charAt(0).toUpperCase()+a.slice(1)}}));Pn=[].concat(Fn,(0,Me.Z)(n)),e&&X([].concat(Fn,(0,Me.Z)(n)))}else w(t)})).catch((function(e){return w(e)})).finally((function(){return K(!1)})),function(){e=!1})}),[]);a.useEffect((function(){ae&&re()}),[re]),a.useEffect((function(){window.location.href.indexOf("view-rules")>-1&&z(!0)}),[]),a.useEffect((function(){if(E){var e=Number(E.split("]")[0].charAt(E.split("]")[0].length-1)),t=Number(E.split("]")[1].charAt(E.split("]")[1].length-1)),n=T.findIndex((function(e){return e.productIndex===t}));if(-1!==n){var a=T[n].details,r=S,o="-"===r.charAt(0)?r.substring(1):r,i=I.rules[e].productRules;if(0===i[t].groupId){var l={expressions:a.expressions,conditions:a.conditions,ftlId:Jt(1e3,1e4),amount:a.amount,valueType:a.valueType,operation:!a.operation};i[t].groupId=t+e+1,i.splice(t+1,0,{accountType:0,accountId:"",expressionValue:4,groupId:t+e+1,ftlGrammar:l,contractValue:l.operation?o:"-".concat(o),walletType:0,tag:0}),T.push({ruleIndex:e,productIndex:t+1,details:l})}else{var c={expressions:a.expressions,conditions:a.conditions,amount:a.amount,ftlId:a.ftlId,valueType:a.valueType,operation:!a.operation},s=[],u=null,d=null;i.map((function(e,n){e.groupId===i[t].groupId&&(s.push(n),i[n]&&i[n].ftlGrammar.ftlId!==a.ftlId&&(u=i[n],d={amount:a.amount,valueType:a.valueType}))}));var m=[];if(s.map((function(e){if(i[e]&&i[e].ftlGrammar.ftlId!==a.ftlId)return m.push(e)})),0!==m.length){var p=T.findIndex((function(e){return m.includes(e.productIndex)}));p>-1&&(c.ftlId=T[p].details.ftlId,T[p].details=c,i.splice(m[0],1,{accountType:i[m[0]].accountType?i[m[0]].accountType:0,accountId:i[m[0]].accountId?i[m[0]].accountId:"",expressionValue:i[m[0]].expressionValue?i[m[0]].expressionValue:4,groupId:i[m[0]].groupId,ftlGrammar:c,contractValue:c.operation?o:"-".concat(o),walletType:i[m[0]].walletType?i[m[0]].walletType:0,tag:i[m[0]].tag?i[m[0]].tag:0})),u&&I.rules.forEach((function(e,t){e.productRules.forEach((function(e,n){u&&e.groupId===u.groupId&&u.ftlGrammar.ftlId===e.ftlGrammar.ftlId&&(e.ftlGrammar=Nn(Nn({},e.ftlGrammar),d),e.ftlGrammar.expressions[0]=Nn(Nn({},e.ftlGrammar.expressions[0]),a.expressions[0]),I.rules[t].productRules[n]=e)}))}))}}P(I),M("rules[".concat(e,"].productRules[").concat(t,"].ftlGrammar"),T[n].details),M(E,S)}}}),[v]);var oe=function(e){var t=e.name;return a.createElement(Fe.gN,{name:t,render:function(e){var n=(0,Fe.u9)(e.form.errors,t),r=(0,Fe.u9)(e.form.touched,t);return a.createElement("span",{style:{color:"red"}},r&&n?n:null)}})},ie=function(e,t){var n=t.groupId;0!==n&&(I.rules[e].productRules.map((function(e){e.groupId===n&&(e.groupId=0,e.contractValue="",e.ftlGrammar={expressions:[{amount:"",paymentAgreement:"-",paymentMode:"-",transactionFromDate:(new Date).toISOString(),transactionToDate:(new Date).toISOString(),transactionFromTime:(new Date).toISOString(),transactionToTime:(new Date).toISOString(),receiverType:"-",weekDay:"-",operationType:"-",valueType:"per",gatewayCode:"-",regionCode:"-",areaCode:"-",territoryCode:"-",thanaCode:"-"}],conditions:[],ftlId:e.ftlGrammar.ftlId,amount:"",valueType:"per",operation:!1})})),P(I))};return a.createElement(Fe.l0,{className:C.form},a.createElement(He.Z,{container:!0,spacing:2},a.createElement(He.Z,{item:!0,xs:6},te?a.createElement(a.Fragment,null,a.createElement($.Z,{color:"primary",variant:"body1",display:"inline",className:C.fontBold},"".concat(D("productName"),": ")),a.createElement($.Z,{variant:"body1",display:"inline"},te)):"")),a.createElement(He.Z,{container:!0,spacing:2,className:C.spacingBottom},a.createElement(He.Z,{item:!0,xs:4},o||i?a.createElement(a.Fragment,null):a.createElement(a.Fragment,null,a.createElement($.Z,{variant:"caption",className:C.label},D("validFrom")),a.createElement("div",null,a.createElement($.Z,{variant:"caption",style:{marginBottom:"0"},className:(0,Be.default)(I.validFrom?"":C.fontHeavy)},D("startLater")),a.createElement(ht.Z,{checked:!o&&I.validFrom,color:"primary",disabled:i,onChange:O,name:"validFrom"}),a.createElement($.Z,{variant:"caption",className:(0,Be.default)(I.validFrom?C.fontHeavy:"")},D("startNow"))))),a.createElement(He.Z,{item:!0,xs:3}),a.createElement(He.Z,{item:!0,xs:5},a.createElement(c.SeamlessInput,{fullWidth:!0,id:"comment",name:"comment",value:I.comment,label:D("comment"),onChange:O,disabled:j}))),!I.validFrom&&a.createElement(He.Z,{container:!0,spacing:2,className:C.spacingBottom},a.createElement(ot.M,{utils:nt.Z},a.createElement(He.Z,{item:!0,xs:2,style:{paddingLeft:"0"}},a.createElement(it.e,{views:["year","month","date"],openTo:ne,className:(0,Be.default)(C.dateField),variant:"inline",format:"dd/MM/yyyy",margin:"normal",label:D("date"),name:"startDate",disabled:i,minDate:!o||i?void 0:new Date,error:!!R.startDate,value:I.startDate,onChange:function(e){null!=e&&e.getDate()?O({target:{value:null==e?void 0:e.toISOString(),name:"startDate"}}):O({target:{value:"",name:"startDate"}})},KeyboardButtonProps:{"aria-label":"change date"}})),a.createElement(He.Z,{item:!0,xs:2},a.createElement(lt.e,{className:(0,Be.default)(C.dateField),margin:"normal",format:"HH:mm:ss",label:D("time"),disabled:i,name:"startTime",value:I.startTime,error:!!R.startTime,onChange:function(e){null!=e&&e.getDate()?O({target:{value:null==e?void 0:e.toISOString(),name:"startTime"}}):O({target:{value:"",name:"startTime"}})},KeyboardButtonProps:{"aria-label":"change time"}})))),a.createElement(Fe.F2,{name:"rules",render:function(e){e.insert;var t=e.remove,n=e.push;return a.createElement(a.Fragment,null,I&&I.rules.length>0?a.createElement(a.Fragment,null,I.rules.map((function(e,n){return a.createElement("div",{key:n},a.createElement(He.Z,{container:!0,spacing:2},a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessInput,{fullWidth:!0,id:"rules[".concat(n,"].rangeFrom"),name:"rules[".concat(n,"].rangeFrom"),value:e.rangeFrom,label:D("rangeFrom"),onChange:O,disabled:j}),a.createElement(oe,{name:"rules[".concat(n,"].rangeFrom")})),a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessInput,{fullWidth:!0,id:"rules[".concat(n,"].rangeTo"),name:"rules[".concat(n,"].rangeTo"),value:e.rangeTo,label:D("rangeTo"),onChange:O,disabled:j}),a.createElement(oe,{name:"rules[".concat(n,"].rangeTo")})),a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessInput,{disabled:!0,fullWidth:!0,id:"rules[".concat(n,"].quantity"),name:"rules[".concat(n,"].quantity"),value:"".concat(e.rangeFrom,"-").concat(e.rangeTo),label:D(!0===r?"amount":"quantity"),onChange:O})),0==j&&I.rules.length>1&&0!==n&&a.createElement(He.Z,{item:!0,xs:2},a.createElement(sn.Z,{onClick:function(){return t(n)},size:"small",color:"primary"},a.createElement(Q.Z,null,"delete")))),a.createElement(Fe.F2,{name:"rules[".concat(n,"].productRules"),render:function(t){t.insert;var r=t.remove,o=t.push;return a.createElement(a.Fragment,null,e.productRules&&e.productRules.length>0?a.createElement(a.Fragment,null,e.productRules.map((function(e,t){return a.createElement(He.Z,{key:"rule-fields-".concat(t),container:!0,alignItems:"center",spacing:2,className:(0,Be.default)(C.spacingBottom,C.fieldArrayWrapper)},0!==e.groupId&&a.createElement(He.Z,{container:!0,spacing:2},a.createElement(He.Z,{item:!0,xs:6},a.createElement($.Z,{variant:"caption",className:C.label},"Group ".concat(e.groupId)))),a.createElement(He.Z,{container:!0,spacing:2,className:C.spacingTop},a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{disabled:j,fullWidth:!0,id:"rules[".concat(n,"].productRules[").concat(t,"].accountType"),label:D("account_type"),options:[{id:0,accountType:"Select"}].concat((0,Me.Z)(u)).map((function(e){return{value:e.id,key:e.accountType}})),name:"rules[".concat(n,"].productRules[").concat(t,"].accountType"),value:e.accountType,onChange:function(e){O(e)}}),a.createElement(oe,{name:"rules[".concat(n,"].productRules[").concat(t,"].accountType")})),a.createElement(He.Z,{item:!0,xs:1},ae&&3==e.accountType?a.createElement(c.SeamlessDropDown,{disabled:j,fullWidth:!0,id:"rules[".concat(n,"].productRules[").concat(t,"].accountId"),label:D("accountID"),options:G,name:"rules[".concat(n,"].productRules[").concat(t,"].accountId"),value:e.accountId,onChange:O}):a.createElement(c.SeamlessInput,{disabled:j,fullWidth:!0,name:"rules[".concat(n,"].productRules[").concat(t,"].accountId"),value:e.accountId,label:D("accountID"),onChange:O}),a.createElement(oe,{name:"rules[".concat(n,"].productRules[").concat(t,"].accountId")})),a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{disabled:j,fullWidth:!0,id:"rules[".concat(n,"].productRules[").concat(t,"].expressionValue"),label:a.createElement("span",null,D("dataValue")," ",a.createElement(pn.Z,{style:{fontSize:"16px",cursor:"pointer"},onClick:Y})),options:[{contractValueTypeId:0,valueType:"Select"}].concat((0,Me.Z)(m)).map((function(e){return{value:e.contractValueTypeId,key:e.valueType}})),name:"rules[".concat(n,"].productRules[").concat(t,"].expressionValue"),value:e.expressionValue,onChange:function(a){!function(e,t,n,a){4===Number(e.target.value)?b(t,n,a):ie(t,a)}(a,n,t,e),O(a)}}),a.createElement(oe,{name:"rules[".concat(n,"].productRules[").concat(t,"].expressionValue")})),a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessInput,{fullWidth:!0,disabled:j||4===Number(e.expressionValue),name:"rules[".concat(n,"].productRules[").concat(t,"].contractValue"),value:e.contractValue,label:D("contractValue"),className:C.inputHelper,helperText:D("valueExpressionHelperText"),onDoubleClick:function(){4===Number(e.expressionValue)&&b(n,t,e)},onChange:O}),a.createElement(oe,{name:"rules[".concat(n,"].productRules[").concat(t,"].contractValue")})),a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{disabled:j,fullWidth:!0,id:"rules[".concat(n,"].productRules[").concat(t,"].walletType"),label:D("walletType"),options:[{accountTypeKey:0,walletId:"Select"}].concat((0,Me.Z)(f)).map((function(e){return{value:e.accountTypeKey,key:e.walletId}})),name:"rules[".concat(n,"].productRules[").concat(t,"].walletType"),value:e.walletType,onChange:O}),a.createElement(oe,{name:"rules[".concat(n,"].productRules[").concat(t,"].walletType")})),a.createElement(He.Z,{item:!0,xs:2},a.createElement(c.SeamlessDropDown,{disabled:j,fullWidth:!0,id:"rules[".concat(n,"].productRules[").concat(t,"].tag"),label:D("tag"),options:[{contractTagId:0,tagName:"Select"}].concat((0,Me.Z)(d)).map((function(e){return{value:e.contractTagId,key:e.tagName}})),name:"rules[".concat(n,"].productRules[").concat(t,"].tag"),value:e.tag,onChange:O}),a.createElement(oe,{name:"rules[".concat(n,"].productRules[").concat(t,"].tag")})),0==j&&a.createElement(He.Z,{item:!0,xs:1},a.createElement(sn.Z,{onClick:function(){r(t),ie(n,e)},size:"small",color:"primary"},a.createElement(Q.Z,null,"delete")))))}))):a.createElement(a.Fragment,null,a.createElement($.Z,{variant:"subtitle1",className:C.spacingBottom},D("noRulesText"))),a.createElement(He.Z,{container:!0,spacing:2,className:C.spacingBottom},a.createElement(He.Z,{item:!0,xs:3},0==j&&a.createElement(c.SeamlessButton,{variant:"outlined",type:"button",className:C.button,startIcon:a.createElement(Ye.Z,null),onClick:function(){o({accountType:0,accountId:"",expressionValue:3,contractValue:"",groupId:0,ftlGrammar:{expressions:[{amount:"",paymentAgreement:"-",paymentMode:"-",transactionFromDate:(new Date).toISOString(),transactionToDate:(new Date).toISOString(),transactionFromTime:(new Date).toISOString(),transactionToTime:(new Date).toISOString(),valueType:"per",receiverType:"-",weekDay:"-",operationType:"-",gatewayCode:"-",regionCode:"-",areaCode:"-",territoryCode:"-",thanaCode:"-"}],conditions:[],ftlId:Jt(1e3,1e4),amount:"",valueType:"per",operation:!1},walletType:0,tag:0})}},D("addEntities")))))}}))})),a.createElement(He.Z,{container:!0,spacing:2,className:C.spacingBottom},a.createElement(He.Z,{item:!0,xs:3},0==j&&a.createElement(c.SeamlessButton,{variant:"outlined",type:"button",className:C.button,onClick:function(){n({rangeFrom:"",rangeTo:"",quantity:"",productRules:[{accountType:1,accountId:"",expressionValue:3,contractValue:"",groupId:0,ftlGrammar:{expressions:[{amount:"",paymentAgreement:"-",paymentMode:"-",transactionFromDate:(new Date).toISOString(),transactionToDate:(new Date).toISOString(),transactionFromTime:(new Date).toISOString(),transactionToTime:(new Date).toISOString(),valueType:"per",receiverType:"-",weekDay:"-",operationType:"-",gatewayCode:"-",regionCode:"-",areaCode:"-",territoryCode:"-",thanaCode:"-"}],conditions:[],ftlId:Jt(1e3,1e4),amount:"",valueType:"per",operation:!1},walletType:0,tag:1},{accountType:2,accountId:"",expressionValue:3,contractValue:"",groupId:0,ftlGrammar:{expressions:[{amount:"",paymentAgreement:"-",paymentMode:"-",transactionFromDate:(new Date).toISOString(),transactionToDate:(new Date).toISOString(),transactionFromTime:(new Date).toISOString(),transactionToTime:(new Date).toISOString(),valueType:"per",receiverType:"-",weekDay:"-",operationType:"-",gatewayCode:"-",regionCode:"-",areaCode:"-",territoryCode:"-",thanaCode:"-"}],conditions:[],ftlId:Jt(1e3,1e4),amount:"",valueType:"per",operation:!1},walletType:0,tag:2}]})}},D("addRange"))))):a.createElement(a.Fragment,null,a.createElement($.Z,{variant:"subtitle1",className:C.spacingBottom},D("noRangeText"))))}}),a.createElement(He.Z,{container:!0,spacing:2},0==j&&a.createElement(He.Z,{item:!0,xs:3},a.createElement(c.SeamlessButton,{variant:"contained",type:"submit",disabled:i?!k:!(k&&N),className:C.button,startIcon:i?a.createElement(bn.Z,null):a.createElement(Ye.Z,null),onSubmit:function(e){return e.preventDefault()}},D(i?"update":"add"))),a.createElement(He.Z,{item:!0,xs:4},a.createElement(c.SeamlessButton,{variant:"outlined",type:"button",className:C.button,startIcon:a.createElement(Tn.Z,null),onClick:function(){Z.replace("/home/contract/contracts/".concat(J,"/products/"))}},D("backToProducts"))),a.createElement(In,{title:D("helpForContractValue"),handleClickOpen:Y,handleClose:ee,open:B,content:a.createElement(a.Fragment,null,a.createElement(Rn,null),a.createElement(He.Z,{container:!0,spacing:2,justify:"center",className:(0,Be.default)(C.spacingBottom,C.spacingTop)},a.createElement(He.Z,{item:!0,xs:3},a.createElement(c.SeamlessButton,{variant:"outlined",type:"button",className:C.button,onClick:ee},D("ok"))),a.createElement(He.Z,{item:!0,xs:3},a.createElement(c.SeamlessButton,{variant:"outlined",type:"button",className:C.button,onClick:ee},D("cancel")))))})))};function Bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Vn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bn(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Wn=(0,oe.Z)((function(e){return(0,ie.Z)({formControl:{margin:e.spacing(1),minWidth:120},selectInput:{width:"100%",lineHeight:"2em"},btnSpace:{marginRight:e.spacing(2)},button:{width:"100%"},element:{marginRight:e.spacing(1),marginBottom:e.spacing(2)},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1},form:{display:"flex",flexDirection:"column"},dateField:{margin:e.spacing(1),width:"100%"},spacingBottom:{marginBottom:e.spacing(2)},label:{color:"#292b2b",fontSize:"14px"},fontHeavy:{fontWeight:e.typography.fontWeightBold},inputHelper:{"& .MuiFormHelperText-root":{fontSize:"8px"}},fieldArrayWrapper:{border:"1px solid #EDEDED",marginLeft:"0",marginTop:"10px",width:"100%",borderRadius:"10px",padding:"10px",background:"#F7F7F7"},fontBold:{fontWeight:"bold",marginRight:e.spacing(.5)},clear:{clear:"both"}})}));const _n=function(e){var t=e.productDetails,n=e.rangeRuleDetails,r=e.accountTypes,o=e.contractTags,i=e.valueTypes,m=e.walletTypes,f=e.contractPriceEntryList,g=e.originalResponse,v=e.onlyFutureAllowed,E=e.update,S=e.loading,T=e.rowIndex,b=Wn(),Z=(0,l.useHistory)(),w=y(),D=w.showErrorMessage,O=w.showSuccessMessage,R=(w.showInfoMessage,w.showWarningMessage,(0,s.useTranslation)().t),k=(0,l.useParams)(),N=k.id,M=k.productId,P=k.range,F=(0,W.useSelector)((function(e){return e.auth.user})).userId,A=a.useState(!1),V=(0,p.Z)(A,2),_=V[0],K=V[1],q=a.useState(!1),L=(0,p.Z)(q,2),j=L[0],z=L[1],H=a.useState(""),U=(0,p.Z)(H,2),G=U[0],X=U[1],Q=a.useState(""),J=(0,p.Z)(Q,2),ae=J[0],re=J[1],oe=a.useState(!1),ie=(0,p.Z)(oe,2),le=ie[0],ce=ie[1],se=a.useState(!1),ue=(0,p.Z)(se,2),de=(ue[0],ue[1]),me=a.useState(""),pe=(0,p.Z)(me,2),fe=pe[0],ge=pe[1],ye=a.useState({expressions:[{amount:"",paymentAgreement:"-",paymentMode:"-",transactionFromDate:(new Date).toISOString(),transactionToDate:(new Date).toISOString(),transactionFromTime:(new Date).toISOString(),transactionToTime:(new Date).toISOString(),valueType:"per",receiverType:"-",weekDay:"-",operationType:"-",gatewayCode:"-",regionCode:"-",areaCode:"-",territoryCode:"-",thanaCode:"-"}],amount:"",ftlId:Jt(1e3,1e4),valueType:"per",conditions:[],operation:!0}),ve=(0,p.Z)(ye,2),he=ve[0],Ee=ve[1],Se=null==P?void 0:P.split("-"),Te=a.useState(""),be=(0,p.Z)(Te,2),Ce=be[0],Ze=be[1],we=a.useState(!1),De=(0,p.Z)(we,2),xe=De[0],Ie=De[1],Oe=a.useState([{ruleIndex:0,productIndex:0,details:he}]),Re=(0,p.Z)(Oe,2),ke=Re[0],Ne=(Re[1],a.useState("")),Me=(0,p.Z)(Ne,2),Be=Me[0],Ve=Me[1],We=a.useState(!1),_e=(0,p.Z)(We,2)[1],Ke=a.useState([]),qe=(0,p.Z)(Ke,2),Le=qe[0],je=(qe[1],a.useState({rules:[],comment:"",validFrom:!0,startDate:"",startTime:""})),ze=(0,p.Z)(je,2),He=ze[0],Ue=ze[1],Ge=(0,B.useServerTable)({page:0,perPage:20,order:"asc",orderBy:"productName",filter:{}}),Xe=Pe.Ry().shape({rules:Pe.IX().of(Pe.Ry().shape({rangeFrom:Pe.Z_().required(R("rangeRequired")),rangeTo:Pe.Z_().required(R("rangeRequired")),quantity:Pe.Z_(),productRules:Pe.IX().of(Pe.Ry().shape({accountType:Pe.Rx().notOneOf([0],R("accountTypeRequired")).required(R("accountTypeRequired")),accountId:Pe.Z_(),expressionValue:Pe.Rx().notOneOf([0],R("expressionValueRequired")).required(R("expressionValueRequired")),contractValue:Pe.Z_().required(R("contractValueRequired")),walletType:Pe.Rx().notOneOf([0],R("walletTypeRequired")).required(R("walletTypeRequired")),tag:Pe.Rx().notOneOf([0],R("tagValueRequired")).required(R("tagValueRequired"))}))})),comment:Pe.Z_(),validFrom:Pe.O7(),startTime:Pe.Z_(),startDate:Pe.Z_()}),$e=function(e){if(E)Qe(e);else if(v)Qe(e);else{Le.length=0;var t="".concat((0,tn.Z)(new Date(e.startDate),"yyyy-MM-dd")," ").concat((0,tn.Z)(new Date(e.startTime),"HH:mm:ss")),n=0;e.rules.map((function(a,l){var c=[a.productRules[0]],s=a.rangeFrom+"-"+a.rangeTo;0===c.length&&c.push({tag:0,accountType:0,accountId:"",expressionValue:0,walletType:0,contractValue:"",groupId:0,ftlGrammar:{expressions:[],amount:"",conditions:[],ftlId:Jt(1e3,1e4),valueType:"",operation:!0}}),c.map((function(a,l){var c={validFrom:0===n?t:"",range:0===l?s.toString():"",id:n,contractTag:Xt(o,Number(a.tag)),contractAccountTypeId:Gt(r,Number(a.accountType)),accountId:a.accountId?a.accountId:"",valueExpression:a.contractValue?a.contractValue:"",productId:0,contractId:0,walletType:$t(m,Number(a.walletType)),entryKey:0,entryKeyRange:0,valueType:Qt(i,Number(a.expressionValue)),isFuture:Ut(t),comment:0===n?e.comment:""};n+=1,Le.push(c)}))})),z(!0),Ue(e)}},Qe=function(e){var t="".concat((0,tn.Z)(new Date(e.startDate),"yyyy-MM-dd")," ").concat((0,tn.Z)(new Date(e.startTime),"HH:mm:ss")),n=new Date(t).toISOString().replace("T"," ").substring(0,19);if(v&&new Date(t)<=new Date)D(R("onlyFutureDateTimeAllowed"));else{var a=Ye(e,E?t:n);if(E){var r=g[T];Je(r.entryKey,a,I,!0)}else Je(void 0,a,x,void 0)}},Je=function(e,t,n,a){_e(!0),n(e,t,a).then((function(){O(R(e?"updateProductRuleSuccessMessage":"createProductRuleSuccessMessage")),Z.replace("/home/contract/contracts/".concat(t.contractId,"/products/"))})).catch((function(e){var t=e.apierror?e.apierror:e;t.subErrors&&0!==t.subErrors.length?t.subErrors.forEach((function(e){D(e?"".concat(e.field," ").concat(e.message):R("anErrorOccurred"))})):D(e.message||t.message||R("anErrorOccurred"))})).finally((function(){_e(!1)}))},Ye=function(e,a){var r=e.rules,o=g[T];if(E){var i=E?f:n;e.rules.forEach((function(e){var t=i.rules.findIndex((function(t){return t.id===e.id}));t>-1?i.rules[t]=e:i.rules.push(e)})),r=i.rules}var l={comment:e.comment,contractId:Number(E?o.contractId:t.contractKey),createdBy:E?o.createdBy:F,currencyId:Number(E?o.currencyId:t.currencyId),entryKey:E?Number(o.entryKey):void 0,productId:Number(E?o.productId:t.productKey),status:E?o.status:t.status,type:E?o.type:"type1",validFrom:a,priceEntryRange:[]};return r.forEach((function(e,t){l.priceEntryRange.push({entryKey:E?Number(o.entryKey):void 0,fromAmount:Number(e.rangeFrom),id:E&&o.priceEntryRange[t]?Number(o.priceEntryRange[t].id):void 0,toAmount:Number(e.rangeTo),marginRules:[]}),0!==e.productRules.length&&e.productRules.forEach((function(e,n){var a=et(e);l.priceEntryRange[t].marginRules.push({accountId:e.accountId,contractAccountTypeId:Number(e.accountType),contractTag:Number(e.tag),entryKey:E?Number(o.entryKey):void 0,entryKeyRange:E&&o.priceEntryRange[t]&&o.priceEntryRange[t].marginRules[n]?o.priceEntryRange[t].marginRules[n].entryKeyRange:void 0,id:E&&o.priceEntryRange[t]&&o.priceEntryRange[t].marginRules[n]?0===o.priceEntryRange[t].marginRules[n].id?void 0:o.priceEntryRange[t].marginRules[n].id:void 0,groupId:4===Number(e.expressionValue)?e.groupId:0,ftlGrammar:a,valueExpression:e.contractValue,valueType:Number(e.expressionValue),walletType:Number(e.walletType)})}))})),l},et=function(e){var t=[];return 4!==Number(e.expressionValue)?[]:(e.ftlGrammar&&e.ftlGrammar.expressions&&(e.ftlGrammar.expressions.forEach((function(n){var a="".concat((0,tn.Z)(new Date(n.transactionFromDate),"yyyy-MM-dd HH:mm:ss"),"&").concat((0,tn.Z)(new Date(n.transactionToDate),"yyyy-MM-dd HH:mm:ss")).trim(),r="".concat((0,tn.Z)(new Date(n.transactionFromTime),"HH:mm:ss"),"&").concat((0,tn.Z)(new Date(n.transactionToTime),"HH:mm:ss")).trim();t.push({paymentMode:e.ftlGrammar.conditions.indexOf("Payment Mode")>-1?n.paymentMode:void 0,paymentAgreement:e.ftlGrammar.conditions.indexOf("Payment Agreement")>-1?n.paymentAgreement:void 0,receiverType:e.ftlGrammar.conditions.indexOf("Receiver Type")>-1?n.receiverType:void 0,weekDay:e.ftlGrammar.conditions.indexOf("Week Day")>-1?n.weekDay:void 0,operationType:e.ftlGrammar.conditions.indexOf("Operation Type")>-1?n.operationType:void 0,amount:n.amount?n.amount:void 0,valueType:n.valueType?n.valueType:void 0,transactionDate:e.ftlGrammar.conditions.indexOf("Transaction Date")>-1?a:void 0,transactionTime:e.ftlGrammar.conditions.indexOf("Transaction Time")>-1?r:void 0,gatewayCode:e.ftlGrammar.conditions.indexOf("Gateway Code")>-1?"-"===n.gatewayCode?void 0:n.gatewayCode:void 0,regionCode:e.ftlGrammar.conditions.indexOf("Region Code")>-1?"-"===n.regionCode?void 0:n.regionCode:void 0,areaCode:e.ftlGrammar.conditions.indexOf("Area Code")>-1?"-"===n.areaCode?void 0:n.areaCode:void 0,territoryCode:e.ftlGrammar.conditions.indexOf("Territory Code")>-1?"-"===n.territoryCode?void 0:n.territoryCode:void 0,thanaCode:e.ftlGrammar.conditions.indexOf("Thana Code")>-1?"-"===n.thanaCode?void 0:n.thanaCode:void 0})})),t.push({amount:e.ftlGrammar.amount,valueType:e.ftlGrammar.valueType})),t)};a.useEffect((function(){de(!0),C(N).then((function(e){var t;(null==e?void 0:e.name)&&X(e.name),(null==e||null===(t=e.contractDataMap)||void 0===t?void 0:t.regionCode)&&ge(e.contractDataMap.regionCode)})).catch((function(e){return D(e)})).finally((function(){return de(!1)}))}),[]),a.useEffect((function(){de(!0),function(e){return h("/pms/v1/product/variant/".concat(e))}(M).then((function(e){var t,n,a,r,o,i;0==(null==e?void 0:e.resultCode)&&null!=e&&null!==(t=e.productVariant)&&void 0!==t&&t.variant&&(re(null==e||null===(n=e.productVariant)||void 0===n||null===(a=n.variant)||void 0===a?void 0:a.productSKU),ce(null==e||null===(r=e.productVariant)||void 0===r||null===(o=r.variant)||void 0===o||null===(i=o.unitPrice)||void 0===i?void 0:i.variablePrice))})).catch((function(e){return D(e)})).finally((function(){return de(!1)}))}),[]);var tt=f.rules.filter((function(e){var t,n;return(null===(t=Se[0])||void 0===t?void 0:t.includes(e.rangeFrom))&&(null===(n=Se[1])||void 0===n?void 0:n.includes(e.rangeTo))})),nt=(null==tt?void 0:tt.length)>0?Vn(Vn({},f),{},{rules:tt}):f;return a.createElement(a.Fragment,null,S&&a.createElement(cn.Z,{className:b.backdrop,open:S},a.createElement(Ae.Z,{color:"inherit"})),!S&&a.createElement(c.SeamlessContainer,{title:R(E?"updateEditProductRangeRulesPageTitle":"addEditProductRangeRulesPageTitle"),description:v?R("onlyFutureDateTimeAllowed"):""},G?a.createElement(a.Fragment,null,a.createElement($.Z,{color:"primary",variant:"body1",display:"inline",className:b.fontBold},"".concat(R("contract"),": ")),a.createElement($.Z,{variant:"body1",display:"inline"},G)):"",ae?a.createElement(a.Fragment,null,a.createElement("div",{className:b.clear}),a.createElement($.Z,{color:"primary",variant:"body1",display:"inline",className:b.fontBold},"".concat(R("productSKU"),": ")),a.createElement($.Z,{variant:"body1",display:"inline"},ae)):"",a.createElement(Fe.J9,{initialValues:E?nt:n,onSubmit:function(e){return $e&&$e(e)},validationSchema:Xe,enableReinitialize:!0},a.createElement(An,{isVariablePrice:le,onlyFutureAllowed:v,update:E,changeChildValues:xe,accountTypes:r,contractTags:o,ftlExpression:Be,valueTypes:i,walletTypes:m,productDetails:t,contractValueInputName:Ce,FTLValues:ke,ftlCallback:function(e,t,n){var a,r;Ze("rules[".concat(e,"].productRules[").concat(t,"].contractValue")),a=n.ftlGrammar,(r=n.contractValue).startsWith("<#")||r.startsWith("-<#")?Ve(r):Ve(""),a&&(a.operation=!!r.startsWith("<#")),Ee(a||he),K(!0)}})),a.createElement(Y.Z,{fullWidth:!0,maxWidth:"lg",open:_,onClose:function(){return K(!1)},disableBackdropClick:!0,"aria-labelledby":"ftl-grammer-dialog"},a.createElement(te.Z,{className:b.appBar},a.createElement(ne.Z,null,a.createElement($.Z,{variant:"h6",className:b.title},R("ftlExpressions")))),a.createElement(ee.Z,null,a.createElement(Sn,{setOpenView:K,setFtlExpression:Ve,ftlExpression:Be,ftlGrammarDetails:he,regionCode:fe,cancelFTLOperation:function(){Ve(""),K(!1)},FTLSuccessCallback:function(e,t){Ve(e);var n=Number(Ce.split("]")[0].charAt(Ce.split("]")[0].length-1)),a=Number(Ce.split("]")[1].charAt(Ce.split("]")[1].length-1)),r=ke.findIndex((function(e){return e.productIndex===a})),o=Vn({},t);-1===r?(o.ftlId=Jt(1e3,1e4),ke.push({ruleIndex:n,productIndex:a,details:o})):(0===o.ftlId&&(o.ftlId=Jt(1e3,1e4)),ke[r].details=o)},addRuleRowCallback:function(){Ie(!xe)}}))),a.createElement(Y.Z,{fullWidth:!0,maxWidth:"lg",open:j,onClose:function(){return z(!1)},"aria-labelledby":"add-rule-dialog"},a.createElement(te.Z,{className:b.appBar},a.createElement(ne.Z,null,a.createElement($.Z,{variant:"h6",className:b.title},R("addEditProductRangeRulesPageTitle")))),a.createElement(ee.Z,null,a.createElement("div",{style:{height:400,width:"100%"}},a.createElement(on,(0,d.Z)({loading:!1,totalCount:0,productsRule:Le,updateRuleView:!1,accountTypes:[],originalResponse:[],update:!1,contractPriceEntryList:{rules:[],comment:"",startDate:"",startTime:"",validFrom:!1}},Ge,{contractTags:[],walletTypes:[],valueTypes:[],hideActions:!0})))),a.createElement(u.Z,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",marginBottom:"10px"},a.createElement(c.SeamlessButton,{type:"button",variant:"outlined",color:"primary",className:b.btnSpace,onClick:function(){return Qe(He)}},R("saveButton")),a.createElement(c.SeamlessButton,{type:"button",variant:"outlined",color:"primary",className:b.btnSpace,onClick:function(){return z(!1)}},R("cancel")),a.createElement(c.SeamlessButton,{type:"button",variant:"outlined",color:"primary",className:b.btnSpace,onClick:function(){Z.replace("/home/contract/contracts/".concat(t.contractKey,"/products/"))}},R("backToProducts"))))))},Kn=function(){var e=(0,l.useLocation)().state,t=e.data,n=e.onlyFutureAllowed,r=e.rowIndex,o=e.values,i=new Date,c=new Date((new Date).setDate(i.getDate()+1)),s={rules:[{rangeFrom:"",rangeTo:"",quantity:"",productRules:[{accountType:1,accountId:"",expressionValue:3,groupId:0,ftlGrammar:{expressions:[{amount:"",paymentAgreement:"-",paymentMode:"-",transactionFromDate:(new Date).toISOString(),transactionToDate:(new Date).toISOString(),transactionFromTime:(new Date).toISOString(),transactionToTime:(new Date).toISOString(),valueType:"per",receiverType:"-",weekDay:"-",operationType:"-",gatewayCode:"-",regionCode:"-",areaCode:"-",territoryCode:"-",thanaCode:"-"}],conditions:[],ftlId:Jt(1e3,1e4),amount:"",valueType:"per",operation:!1},contractValue:"",walletType:0,tag:1},{accountType:2,accountId:"",expressionValue:3,groupId:0,ftlGrammar:{expressions:[{amount:"",paymentAgreement:"-",paymentMode:"-",transactionFromDate:(new Date).toISOString(),transactionToDate:(new Date).toISOString(),transactionFromTime:(new Date).toISOString(),transactionToTime:(new Date).toISOString(),valueType:"per",receiverType:"-",weekDay:"-",operationType:"-",gatewayCode:"-",regionCode:"-",areaCode:"-",territoryCode:"-",thanaCode:"-"}],conditions:[],ftlId:Jt(1e3,1e4),amount:"",valueType:"per",operation:!1},contractValue:"",walletType:0,tag:2}]}],validFrom:!n,comment:"",startTime:n?c.toISOString():i.toISOString(),startDate:n?c.toISOString():i.toISOString()},u=(0,l.useParams)(),d=u.id,m=u.productId;return u.ruleId,a.createElement(en,{productId:Number(m),contractId:Number(d),values:o,onlyFutureAllowed:n},(function(e){var o=e.accountTypes,i=e.contractPriceEntryList,l=e.contractTags,c=e.walletTypes,u=e.valueTypes,d=e.originalResponse,m=e.update,p=e.productsRule,f=e.loading,g=e.totalCount;return a.createElement(_n,{rangeRuleDetails:s,loading:f,update:m,totalCount:g,tableValues:p,productDetails:t,onlyFutureAllowed:n,contractPriceEntryList:i,accountTypes:o,contractTags:l,walletTypes:c,valueTypes:u,originalResponse:d,rowIndex:r})}))};var qn=(0,oe.Z)((function(e){return(0,ie.Z)({button:{margin:e.spacing(1)},element:{marginRight:e.spacing(1),marginBottom:e.spacing(2)},dateField:{margin:e.spacing(1),width:"100%"},spacingBottom:{marginBottom:e.spacing(2)},textColor:{color:"red"},dialogWrapper:{textAlign:"left","& .MuiDialogContent-root":{marginTop:e.spacing(2),marginBottom:e.spacing(3),marginRight:"auto",marginLeft:"auto"}},fontHeavy:{fontWeight:e.typography.fontWeightBold},btnSpace:{marginRight:e.spacing(2)},alignCenter:{textAlign:"center"},disabled:{opacity:.5},spacingTop:{marginTop:e.spacing(1)}})}));const Ln=function(e){var t,n,r,o,l,d=e.data,m=e.countries,f=e.resellerTypes,g=e.isRegionCreateContract,v=e.deferredCommissionSpans,h=e.onFormSubmit,E=e.update,S=e.loading,T=e.handleViewClose,b=y(),C=b.showWarningMessage,Z=b.showErrorMessage,w=(0,W.useSelector)((function(e){return e.auth})).user,D=i()().checkPermission,x=(0,s.useTranslation)().t,I=qn(),O=a.useState(!1),k=(0,p.Z)(O,2),M=(k[0],k[1]),P=a.useState(!1),F=(0,p.Z)(P,2),A=F[0],B=F[1],V=a.useState(null==d||null===(t=d.contractDataMap)||void 0===t?void 0:t.commission_mode),_=(0,p.Z)(V,2),K=(_[0],_[1]),q=a.useState(null==d||null===(n=d.contractDataMap)||void 0===n?void 0:n.deferred_timespan),L=(0,p.Z)(q,2),j=(L[0],L[1]),z=[{key:"- ".concat(x("select")," -"),value:" "}],H=a.useState(z),U=(0,p.Z)(H,2),G=U[0],X=U[1],$=[{key:x("instant"),value:"Instant"},{key:x("deferred"),value:"Deferred"}],Q=[{key:x("inactive"),value:0}],J=D(pe);1==J&&Q.push({key:x("active"),value:1});var Y=null==w||null===(r=w.info)||void 0===r||null===(o=r.additionalFields)||void 0===o?void 0:o.filter((function(e){return"regionCode"===(null==e?void 0:e.name)})),ee=g&&(null===(l=Y[0])||void 0===l?void 0:l.value),te=Pe.Ry().shape({name:Pe.Z_().required(x("contractNameRequiredError")).matches(/^[a-zA-Z0-9 ]*$/,x("contractNameAlphaNumericAndSpacesError")),importId:Pe.Z_().required(x("importIdRequiredError")).matches(/^[a-zA-Z0-9_]*$/,x("importIdAlphaNumericAndUnderscoreError")),description:Pe.Z_(),region:g?Pe.Z_().required():Pe.Z_()}),ne=(0,Fe.TA)({initialValues:d,onSubmit:function(e){return h&&h(e)},validationSchema:te,enableReinitialize:!0}),ae=ne.values,re=ne.errors,oe=ne.handleChange,ie=ne.handleBlur,le=ne.handleSubmit,ce=(ne.handleReset,ne.validateForm),se=ne.setFieldValue;return a.useEffect((function(){g&&(B(!0),R().then((function(e){if(0==e.resultCode){var t,n=e.conditionOptions;ee&&(n=n.filter((function(e){var t,n;return null===(t=Y[0])||void 0===t||null===(n=t.value)||void 0===n?void 0:n.includes(e.split(":")[0])}))),(null===(t=n)||void 0===t?void 0:t.length)>1&&J&&z.push({key:x("allRegions"),value:"ALL:ALL"});var a=n.map((function(e){var t=e.split(":"),n=e,a=t[1]||t[0];return{value:n,key:a.charAt(0).toUpperCase()+a.slice(1)}}));X(g?[].concat(z,(0,Me.Z)(a)):(0,Me.Z)(a))}else Z(e.resultDescription);B(!1)})).catch((function(e){return Z(e)})).finally((function(){return B(!1)}))),g&&(B(!0),N(w.userId).then((function(e){if(0==e.resultCode){var t,n,a,r,o=null===(t=e.resellerInfo)||void 0===t||null===(n=t.additionalFields)||void 0===n?void 0:n.find((function(e){return"regionCode"===(null==e?void 0:e.name)})),i=null===(a=e.resellerInfo)||void 0===a||null===(r=a.additionalFields)||void 0===r?void 0:r.find((function(e){return"regionName"===(null==e?void 0:e.name)}));if("".concat(null==o?void 0:o.value,":").concat(null==i?void 0:i.value),o&&i){var l="".concat(null==o?void 0:o.value,":").concat(null==i?void 0:i.value),c=null==l?void 0:l.split(",");1==(null==c?void 0:c.length)&&l&&se("region",l)}}else Z(e.resultDescription)})).catch((function(e){return Z(e)})).finally((function(){return B(!1)})))}),[]),S?a.createElement(u.Z,{justifyContent:"flex-start",display:"flex",flexDirection:"column",width:"100%",p:1,borderColor:"grey.200",border:.2,borderRadius:6},a.createElement(u.Z,{m:2,width:"30%"},a.createElement(tt.Z,{height:40,variant:"text",animation:"wave"}),a.createElement(tt.Z,{height:40,variant:"text",animation:"wave"})),a.createElement(u.Z,{m:2,width:"30%"},a.createElement(tt.Z,{height:20,variant:"text",animation:"wave"}),a.createElement(tt.Z,{height:20,variant:"text",animation:"wave"})),a.createElement(u.Z,{m:2,width:"30%"},a.createElement(tt.Z,{height:20,variant:"text",animation:"wave"}),a.createElement(tt.Z,{height:20,variant:"text",animation:"wave"}))):a.createElement(He.Z,{container:!0},a.createElement(He.Z,{container:!0,spacing:2,className:I.spacingBottom},a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessInput,{disabled:!0,className:(0,Be.default)(I.element),fullWidth:!0,name:"clonedContractKey",value:ae.clonedContractKey,label:x("clonedContractKey")})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessInput,{disabled:!0,className:(0,Be.default)(I.element),fullWidth:!0,name:"clonedFrom",value:ae.clonedFrom,label:x("clonedFrom")})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessInput,{className:(0,Be.default)(I.element),fullWidth:!0,required:!0,error:!!re.name,name:"name",value:ae.name,onChange:oe,onBlur:ie,label:x("name")})),g&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,disabled:E||!J,id:"region-drop-down",required:!0,label:x("region"),helperText:x("selectRegion"),options:G,name:"region",value:ae.region,onChange:function(e){var t;return se("region",null===(t=e.target.value)||void 0===t?void 0:t.trim())},error:!!re.region})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessInput,{className:(0,Be.default)(I.element),fullWidth:!0,required:!0,error:!!re.importId,name:"importId",value:ae.importId,onChange:oe,onBlur:ie,label:x("importId")})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessInput,{className:(0,Be.default)(I.element),fullWidth:!0,error:!!re.description,name:"description",value:ae.description,onChange:oe,onBlur:ie,label:x("description")})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,id:"reseller-type-drop-down",required:!0,disabled:E,label:x("usedForResellerType"),helperText:x("selectResellerType"),options:f.map((function(e){return{value:e.typeKey,key:e.name}})),name:"resellerType",value:ae.resellerType,onChange:oe})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,id:"country-drop-down",required:!0,label:x("country"),helperText:x("selectCountry"),options:m.map((function(e){return{value:e.countryKey,key:e.name}})),name:"country",value:ae.country,onChange:oe})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,id:"contract-status-drop-down",required:!0,label:x("contractStatus"),helperText:x("selectContractStatus"),options:Q.map((function(e){return{value:e.value,key:e.key}})),name:"contractStatus",value:ae.contractStatus,onChange:function(e){oe(e),"0"===e.target.value?M(!0):M(!1)}})),a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,id:"commission-mode-drop-down",required:!0,label:x("commissionMode"),helperText:x("selectCommissionMode"),options:$.map((function(e){return{value:e.value,key:e.key}})),name:"commission_mode",value:ae.contractDataMap.commission_mode,onChange:function(e){K(e.currentTarget.value),ae.contractDataMap.commission_mode=e.currentTarget.value,"Instant"===ae.contractDataMap.commission_mode&&(ae.contractDataMap.deferred_timespan="",j(""))}})),"Deferred"===ae.contractDataMap.commission_mode&&a.createElement(He.Z,{item:!0,xs:6},a.createElement(c.SeamlessDropDown,{className:(0,Be.default)(I.element),fullWidth:!0,id:"deferred-time-span",required:!0,label:x("deferredTimeSpan"),helperText:x("selectDeferredTimeSpan"),options:v.map((function(e){return{value:e.deferredCommissionValue,key:e.deferredCommissionLabel}})),name:"deferred_timespan",value:null==ae?void 0:ae.contractDataMap.deferred_timespan,onChange:function(e){j(ae.contractDataMap.deferred_timespan),"Deferred"===ae.contractDataMap.commission_mode&&(ae.contractDataMap.deferred_timespan=e.currentTarget.value)}}))),a.createElement(He.Z,{item:!0,xs:12},a.createElement(c.SeamlessButton,{type:"button",onClick:function(){ce().then((function(e){var t=Object.values(e);t.length>0?C(t[0]):(B(!0),le())}))},className:I.btnSpace,color:"primary",variant:"contained",disabled:A},x("clone"),A&&a.createElement(Ae.Z,{color:"inherit",size:14,thickness:6,style:{marginLeft:"8px"}})),a.createElement(c.SeamlessButton,{type:"button",variant:"outlined",color:"primary",className:I.btnSpace,onClick:T},x("cancel"))))},jn=function(e){var t=e.children,n=a.useState([]),r=(0,p.Z)(n,2),o=r[0],i=r[1],l=a.useState(!1),c=(0,p.Z)(l,2),s=c[0],u=c[1],d=y(),m=d.showErrorMessage;return d.showSuccessMessage,a.useEffect((function(){u(!0),h("/acms/concerted-rule-info").then((function(e){i(e.concertedResponses)})).catch((function(e){m("There was an error")})).finally((function(){return u(!1)}))}),[]),a.createElement(a.Fragment,null,t({c2SRules:o,loading:s}))};var zn=(0,oe.Z)((function(e){return(0,ie.Z)({dialogWrapper:{textAlign:"center","& .MuiDialog-container":{width:"100%"},"& .MuiDialogContent-root":{marginTop:e.spacing(2),marginBottom:e.spacing(3),marginRight:"auto",marginLeft:"auto"}},fontHeavy:{fontWeight:e.typography.fontWeightBold},modalContentSpacing:{marginBottom:e.spacing(3)},btnSpace:{marginRight:e.spacing(2)}})}));const Hn=function(e){var t=e.loading,n=e.c2SRules,r=void 0===n?[]:n,o=(0,s.useTranslation)().t,i=a.useState(!1),c=(0,p.Z)(i,2),u=(c[0],c[1],y()),d=(u.showErrorMessage,u.showSuccessMessage,zn(),[{field:"ruleName",headerName:o("ruleName"),sortable:!0,width:200},{field:"fieldsMap.gatewayCode",headerName:o("gatewayCode"),sortable:!0,width:200,filterable:!0,valueGetter:function(e){var t;return null===(t=e.row.fieldsMap)||void 0===t?void 0:t.gatewayCode}},{field:"fieldsMap.resellerType",headerName:o("resellerType"),sortable:!0,width:150,filterable:!0,valueGetter:function(e){var t;return null===(t=e.row.fieldsMap)||void 0===t?void 0:t.resellerType}},{field:"fieldsMap.serviceType",headerName:o("productCategory"),sortable:!0,width:150,filterable:!0,valueGetter:function(e){var t;return null===(t=e.row.fieldsMap)||void 0===t?void 0:t.serviceType}},{field:"variantIdAndSKUMap",headerName:o("productVariant"),sortable:!0,width:200,renderCell:function(e){var t,n=Object.values(e.row.variantIdAndSKUMap).join(" ,");return a.createElement(J.ZP,{title:n},a.createElement("div",null,((t=n)&&t.length>20&&(t=t.slice(0,20)+" ..."),t)))}},{field:"actions",headerName:o("actions"),sortable:!1,renderCell:function(e){return a.createElement("div",null,a.createElement(X.Z,{size:"small",color:"primary","aria-label":"group action buttons"},a.createElement(G.Z,{component:l.Link,to:"/home/contract/c2sRules/edit/"+e.getValue("ruleId")},a.createElement(se.Z,{fontSize:"small"})),a.createElement(G.Z,{component:l.Link,to:"/home/contract/c2sRules/view/"+e.getValue("ruleId")},a.createElement(ue.Z,{fontSize:"small"}))))},flex:1}]);return a.createElement(a.Fragment,null,a.createElement(V(),{loading:t,columnBuffer:3,rows:r,getRowId:function(e){return e.ruleId},columns:d}))},Un=function(){return a.createElement(jn,null,(function(e){var t=e.c2SRules,n=e.loading;return a.createElement("div",{style:{height:600,width:"100%"}},a.createElement(Hn,{c2SRules:t,loading:n}))}))},Gn=function(e){var t=e.disable,n=void 0!==t&&t,r=(0,s.useTranslation)().t;return a.createElement(c.SeamlessButton,{component:l.Link,to:"/home/contract/c2sRules/create",variant:"contained",color:"primary",disabled:n,endIcon:a.createElement(Ye.Z,null)},r("createNewRule"))};var Xn=n(95549),$n=(0,oe.Z)((function(e){return(0,ie.Z)({button:{marginTop:10},spacingTop:{marginTop:e.spacing(2)},element:{marginRight:e.spacing(1),marginBottom:e.spacing(1)},dateField:{margin:e.spacing(1),width:"100%"},marginRight:{marginRight:e.spacing(1)}})}));const Qn=function(e){var t,n,r,o,i=e.data,u=e.onFormSubmit,m=e.view,f=e.edit,g=e.sku,v=e.setSku,E=!1,S=$n(),T=(0,s.useTranslation)().t,b=y(),C=b.showErrorMessage,Z=b.showWarningMessage,w=a.useState(!1),D=(0,p.Z)(w,2),x=D[0],I=D[1],O=a.useState(!0),R=(0,p.Z)(O,2),k=R[0],N=R[1],M=a.useState([]),P=(0,p.Z)(M,2),F=P[0],A=P[1],B=Pe.Ry().shape({ruleName:Pe.Z_().required(T("valueIsRequired")).matches(/^[a-zA-Z0-9_]+$/,T("alphaNumeric")).max(255),validFrom:Pe.Z_().required(T("valueIsRequired")).nullable(),validUntil:Pe.Z_().required(T("valueIsRequired"))}),V=(0,Fe.TA)({initialValues:i,onSubmit:function(e){return u&&u(e)},validationSchema:B,validateOnBlur:!1,enableReinitialize:!0,validateOnChange:x}),_=V.values,K=V.errors,q=V.handleChange,L=(V.handleBlur,V.handleSubmit),j=V.handleReset,z=a.useState([]),H=(0,p.Z)(z,2),U=H[0],X=H[1],$=a.useState(!1),J=(0,p.Z)($,2),Y=J[0],ee=J[1],te=a.useState([]),ne=(0,p.Z)(te,2),re=ne[0],oe=ne[1],ie=a.useState([]),le=(0,p.Z)(ie,2),ce=(le[0],le[1]),se=(0,W.useSelector)((function(e){return e.auth})).user;a.useEffect((function(){ee(!0),h("/acms/rule-transaction-fields").then((function(e){var t=["gatewayCode","serviceType","resellerType"],n=[];for(var a in t.forEach((function(t){if(e.transactionFields[t]){var a,r=null===(a=e.transactionFields[t])||void 0===a?void 0:a.map((function(e){var t=e.split(":");return{key:t[1],value:t[0].trim()}}));n.push({id:t,options:r})}else C(T("failedToMapField",{field:T(t)}))})),e.transactionFields)if(t.indexOf("".concat(a))<0){var r=e.transactionFields[a].map((function(e){var t=e.split(":");return{key:t[1],value:t[0].trim()}}));n.push({id:a,options:r})}X(n)})).catch((function(e){C(T("anErrorOccurred"))})).finally((function(){return ee(!1)}))}),[]);a.useEffect((function(){var e,t=null==_||null===(e=_.fieldsMap)||void 0===e?void 0:e.serviceType;" "!=t?function(e){var t,n;ee(!0),(t=e,n=" "!=t?"?categoryName=".concat(t):"",h("/acms/fetch-products-variants".concat(n))).then((function(e){var t=null==e?void 0:e.map((function(e){return{key:e.globalSku,value:e.productKey}}));A(t),N(!1),E=F.length===re.length})).catch((function(e){C(e)})).finally((function(){return ee(!1)}))}(t):N(!0)}),[null==_||null===(t=_.fieldsMap)||void 0===t?void 0:t.serviceType]);var ue=(0,Xn.D)(),de=function(){oe([]),v&&v([])},me=function(e){e?(oe(F),v&&v(F)):de()},pe=function(e){oe(e),v&&v(e)};a.useEffect((function(){g&&(oe(g),ce(g))}),[g]),_.validFrom;var fe="".concat(null==_||null===(n=_.fieldsMap)||void 0===n?void 0:n.gatewayCode,"_").concat(null==_||null===(r=_.fieldsMap)||void 0===r?void 0:r.serviceType,"_").concat(null==_||null===(o=_.fieldsMap)||void 0===o?void 0:o.resellerType);return _.ruleName=fe,a.createElement(a.Fragment,null,a.createElement(He.Z,{container:!0,spacing:3},a.createElement(He.Z,{item:!0,xs:12,sm:6,md:3},a.createElement(c.SeamlessInput,{fullWidth:!0,error:!!K.ruleName,helperText:K.ruleName?K.ruleName.toString():T("ruleNameHelperText"),className:(0,Be.default)(S.element),name:"ruleName",value:_.ruleName,onChange:q,label:T("ruleName"),required:!0,readOnly:!0}))),a.createElement(He.Z,{container:!0,spacing:3,sm:6},U.map((function(e,t){var n,r;return a.createElement(He.Z,{item:!0,xs:12,sm:6,key:t},m?a.createElement(c.SeamlessInput,{required:!0,fullWidth:!0,error:!!K[e.id],className:(0,Be.default)(S.element),name:"fieldsMap.".concat(e.id),value:null==_||null===(n=_.fieldsMap)||void 0===n?void 0:n[e.id],label:T(e.id),readOnly:m}):a.createElement(c.SeamlessDropDown,{required:!0,className:(0,Be.default)(S.element),fullWidth:!0,id:"".concat(e.id,"-drop-down"),error:!!K[e.id],label:T(e.id),helperText:K[e.id]||T("pleaseSelectValue"),options:[{key:T("selectOption"),value:" "}].concat((0,Me.Z)(e.options)),name:"fieldsMap.".concat(e.id),value:null==_||null===(r=_.fieldsMap)||void 0===r?void 0:r[e.id],onChange:q,disabled:m||f}))}))),a.createElement(He.Z,{container:!0,spacing:3},a.createElement(He.Z,{item:!0,xs:12,sm:6,md:6},a.createElement(ct.ZP,{disabled:k,multiple:!0,size:"small",options:F,value:m?g:re,disableCloseOnSelect:!0,getOptionLabel:function(e){return"".concat(e.key)},getOptionSelected:function(e,t){return e.value===t.value},filterOptions:function(e,t){var n=ue(e,t);return[{key:T("selectAll"),value:"select-all"}].concat((0,Me.Z)(n))},onChange:m?function(){return null}:function(e,t,n){"select-option"===n||"remove-option"===n?t.find((function(e){return"select-all"===e.value}))?(me&&me(!E),null==F||F.filter((function(e){return"select-all"!==e.value}))):pe&&pe(t):"clear"===n&&de&&de()},renderOption:function(e,t){var n=t.selected,r="select-all"===e.value?{checked:E}:{};return a.createElement(a.Fragment,null,a.createElement(at.Z,(0,d.Z)({color:"primary",icon:a.createElement(Q.Z,{color:"primary"},"check_box_outline_blank"),checkedIcon:a.createElement(Q.Z,{color:"secondary"},"check_box"),className:S.marginRight,checked:n},r)),"".concat(e.key))},renderInput:function(e){return a.createElement(rt.Z,(0,d.Z)({},e,{label:T("productVariant")}))},limitTags:5}))),a.createElement(He.Z,{container:!0,spacing:3},a.createElement(He.Z,{item:!0,xs:12,sm:6,md:6},Y?a.createElement(ae.Z,null):null)),a.createElement(He.Z,{item:!0,xs:12,className:S.spacingTop},m?a.createElement(G.Z,{type:"button",variant:"contained",color:"primary",component:l.Link,to:"/home/contract/c2sRules"},T("backButton")):a.createElement(a.Fragment,null,a.createElement(G.Z,{disabled:Y,type:"button",onClick:function(e){var t,n,a,r,o,i,l="",c=!1;if(!U.find((function(e){return"gatewayCode"===e.id}))||""!==(null===(t=_.fieldsMap)||void 0===t?void 0:t.gatewayCode)&&" "!==(null===(n=_.fieldsMap)||void 0===n?void 0:n.gatewayCode)||(l+="".concat(T("gatewayCode")," "),c=!0),!U.find((function(e){return"serviceType"===e.id}))||""!==(null===(a=_.fieldsMap)||void 0===a?void 0:a.serviceType)&&" "!==(null===(r=_.fieldsMap)||void 0===r?void 0:r.serviceType)||(l+="".concat(T("serviceType")," "),c=!0),!U.find((function(e){return"resellerType"===e.id}))||""!==(null===(o=_.fieldsMap)||void 0===o?void 0:o.resellerType)&&" "!==(null===(i=_.fieldsMap)||void 0===i?void 0:i.resellerType)||(l+="".concat(T("resellerType")," "),c=!0),0===re.length&&(l+="".concat(T("productVariant")," "),c=!0),l.split(" ").length<=3?l+=" ".concat(T("isRequired")):l+=" ".concat(T("areRequired")),c)Z(l);else{var s={};null==re||re.forEach((function(e){s["".concat(e.value)]=e.key})),_.variantIdAndSKUMap=s,_.createdBy=se.userId,L(),I(!0)}},className:(0,Be.default)(S.element,S.button),color:"primary",variant:"contained"},T("submitButton")),a.createElement(G.Z,{type:"button",onClick:function(e){oe(f?g:[]),j(e),I(!0)},className:(0,Be.default)(S.element,S.button),color:"primary",variant:"outlined"},T("resetButton")))))},Jn=function(){var e=(0,s.useTranslation)().t;return a.createElement(c.SeamlessContainer,{title:e("viewContractsPageTitle"),description:e("viewContractsPageDescription")},a.createElement(u.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end"},a.createElement(et,null)),a.createElement(Je,null))};var Yn={contractKey:0,name:"",importId:"",description:"",contractStatus:0,contract_type:"Regular",country:1,commission_mode:"Instant",resellerType:0,selectedDay:""};const ea=function(){var e,t,n=y(),r=n.showErrorMessage,o=n.showSuccessMessage,i=(0,s.useTranslation)().t,l=a.useState(!1),u=(0,p.Z)(l,2),d=u[0],m=u[1],f=a.useState([]),g=(0,p.Z)(f,2),v=g[0],E=g[1],S=a.useState([]),b=(0,p.Z)(S,2),C=b[0],x=b[1],I=a.useState([]),O=(0,p.Z)(I,2),R=O[0],k=O[1],N=Ue(),M=(null===(e=window.config)||void 0===e||null===(t=e.contract)||void 0===t?void 0:t.isRegionCreateContract)||!1;a.useEffect((function(){m(!0),D().then((function(e){return E(e),w()})).then((function(e){var t=[{typeKey:0,id:"ALL",name:i("all")}].concat(e);return x(t),Z()})).then((function(e){k(e)})).catch((function(e){return r(e)})).finally((function(){return m(!1)}))}),[]);var P=a.useCallback((function(e){var t,n={name:e.name,description:e.description,importId:e.importId,resellerType:e.resellerType,country:e.country,contractStatus:parseInt("".concat(e.contractStatus)),createdBy:N?N.requestedPrincipalId:"",contractDataMap:{contract_type:e.contract_type,commission_mode:e.commission_mode}};if("Deferred"===e.commission_mode&&(n.contractDataMap.deferred_timespan=e.deferred_timespan),e.startDate&&(n.contractDataMap.startDate=e.startDate.toISOString()),e.endDate&&(n.contractDataMap.endDate=e.endDate.toISOString()),e.contractSubType&&(n.contractDataMap.contractSubType=e.contractSubType),e.selectedDay&&(n.contractDataMap.selectedDay=e.selectedDay),M){var a=e.region&&e.region.split(":");n.contractDataMap.regionCode=a&&a[0],n.contractDataMap.regionName=a&&a[1]}(t=n,h("".concat(T,"/contracts"),{method:"POST",body:t})).then((function(e){o(i("createContractSuccessMessage")),history.back()})).catch((function(e){return r(e)}))}),[]);return a.createElement(c.SeamlessContainer,{title:i("createContractPageTitle"),description:i("createContractPageDescription")},a.createElement(ut,{"data-testid":"create-contract",data:Yn,loading:d,resellerTypes:C,deferredCommissionSpans:R,countries:v,isRegionCreateContract:M,onFormSubmit:function(e){return P(e)}}))},ta=function(){var e,t,n=y(),r=n.showErrorMessage,o=n.showSuccessMessage,i=(0,s.useTranslation)().t,u=(0,l.useParams)().id,d=a.useState(!1),m=(0,p.Z)(d,2),f=m[0],g=m[1],v=Ue(),E=a.useState([]),S=(0,p.Z)(E,2),b=S[0],x=S[1],I=a.useState([]),O=(0,p.Z)(I,2),R=O[0],k=O[1],N=a.useState([]),M=(0,p.Z)(N,2),P=M[0],F=M[1],A=a.useState({contractKey:0,name:"",importId:"",description:"",contractStatus:1,contract_type:"Regular",country:1,commission_mode:"Instant",resellerType:0}),B=(0,p.Z)(A,2),V=B[0],W=B[1],_=(null===(e=window.config)||void 0===e||null===(t=e.contract)||void 0===t?void 0:t.isRegionCreateContract)||!1;a.useEffect((function(){g(!0),D().then((function(e){return x(e),w()})).then((function(e){var t=[{typeKey:0,id:"ALL",name:i("all")}].concat(e);return k(t),Z()})).then((function(e){return F(e),C(u)})).then((function(e){var t={contractKey:e.contractKey,name:e.name,description:e.description,importId:e.importId,resellerType:e.resellerType,country:e.country,contractStatus:e.contractStatus,createdBy:e.createdBy};e.contractDataMap&&(t.contract_type=e.contractDataMap.contract_type,t.commission_mode=e.contractDataMap.commission_mode,"Deferred"===e.contractDataMap.commission_mode&&(t.deferred_timespan=e.contractDataMap.deferred_timespan),e.contractDataMap.startDate&&(t.startDate=e.contractDataMap.startDate),e.contractDataMap.endDate&&(t.endDate=e.contractDataMap.endDate),e.contractDataMap.contractSubType&&(t.contractSubType=e.contractDataMap.contractSubType),e.contractDataMap.selectedDay&&(t.selectedDay=e.contractDataMap.selectedDay),_&&e.contractDataMap.regionCode&&(t.region="".concat(e.contractDataMap.regionCode,":").concat(e.contractDataMap.regionName))),W(t)})).catch((function(e){return r(e.message)})).finally((function(){return g(!1)}))}),[]);var K=a.useCallback((function(e){var t={contractKey:parseInt(u),name:e.name,description:e.description,importId:e.importId,resellerType:e.resellerType,country:e.country,contractStatus:parseInt("".concat(e.contractStatus)),modifiedBy:v?v.requestedPrincipalId:""};if(e.region){var n=e.region&&e.region.split(":");t.contractDataMap=t.contractDataMap||{},n&&(t.contractDataMap.regionCode=n[0]),n&&(t.contractDataMap.regionName=n[1])}(function(e,t){return h("".concat(T,"/contracts/").concat(e),{method:"PUT",body:t})})(u,t).then((function(e){o(i("updateContractSuccessMessage")),history.back()})).catch((function(e){return r(e)}))}),[]);return a.createElement(c.SeamlessContainer,{title:i("updateContractPageTitle"),description:i("updateContractPageDescription")},a.createElement(ut,{"data-testid":"update-contract",data:V,update:!0,loading:f,countries:b,resellerTypes:R,deferredCommissionSpans:P,isRegionCreateContract:_,onFormSubmit:function(e){return K(e)}}))},na=function(){var e,t,n=y().showErrorMessage,r=(0,s.useTranslation)().t,o=(0,l.useParams)().id,i=a.useState(!1),u=(0,p.Z)(i,2),d=u[0],m=u[1],f=a.useState([]),g=(0,p.Z)(f,2),v=g[0],h=g[1],E=a.useState([]),S=(0,p.Z)(E,2),T=S[0],b=S[1],x=a.useState([]),I=(0,p.Z)(x,2),O=I[0],R=I[1],k=a.useState({contractKey:0,name:"",importId:"",description:"",contractStatus:1,contract_type:"Regular",country:1,commission_mode:"Instant",resellerType:0}),N=(0,p.Z)(k,2),M=N[0],P=N[1],F=(null===(e=window.config)||void 0===e||null===(t=e.contract)||void 0===t?void 0:t.isRegionCreateContract)||!1;return a.useEffect((function(){m(!0),D().then((function(e){return h(e),w()})).then((function(e){var t=[{typeKey:0,id:"ALL",name:r("all")}].concat(e);return b(t),Z()})).then((function(e){return R(e),C(o)})).then((function(e){var t={contractKey:e.contractKey,name:e.name,description:e.description,importId:e.importId,resellerType:e.resellerType,country:e.country,contractStatus:e.contractStatus,createdBy:e.createdBy};e.contractDataMap&&(t.contract_type=e.contractDataMap.contract_type,t.commission_mode=e.contractDataMap.commission_mode,"Deferred"===e.contractDataMap.commission_mode&&(t.deferred_timespan=e.contractDataMap.deferred_timespan),e.contractDataMap.startDate&&(t.startDate=e.contractDataMap.startDate),e.contractDataMap.endDate&&(t.endDate=e.contractDataMap.endDate),e.contractDataMap.contractSubType&&(t.contractSubType=e.contractDataMap.contractSubType),e.contractDataMap.selectedDay&&(t.selectedDay=e.contractDataMap.selectedDay),F&&e.contractDataMap.regionCode&&(t.region="".concat(e.contractDataMap.regionCode,":").concat(e.contractDataMap.regionName))),P(t)})).catch((function(e){return n(e.message)})).finally((function(){return m(!1)}))}),[]),a.createElement(c.SeamlessContainer,{title:r("viewContractPageTitle"),description:r("viewContractPageDescription")},a.createElement(ut,{"data-testid":"view-contract",data:M,update:!0,view:!0,loading:d,countries:v,resellerTypes:T,deferredCommissionSpans:O,isRegionCreateContract:F}))},aa=function(){return(0,s.useTranslation)().t,a.createElement(Kn,null)};var ra=!1,oa=(0,oe.Z)((function(e){return(0,ie.Z)({fontBold:{fontWeight:"bold",marginRight:e.spacing(.5)}})}));const ia=function(){var e=y().showErrorMessage,t=a.useState(ra),n=(0,p.Z)(t,2),r=n[0],o=n[1],i=(0,l.useParams)().id,d=(0,s.useTranslation)().t,m=a.useState(""),f=(0,p.Z)(m,2),g=f[0],v=f[1],h=a.useState(!1),E=(0,p.Z)(h,2),S=(E[0],E[1]),T=oa();return a.useEffect((function(){S(!0),C(i).then((function(e){(null==e?void 0:e.name)&&v(e.name)})).catch((function(t){return e(t)})).finally((function(){return S(!1)}))}),[]),a.useEffect((function(){ra=!1,new URLSearchParams(window.location.search).has("show")&&(ra=!0),o(ra)}),[]),a.createElement(c.SeamlessContainer,{title:d(r?"viewAddMarginForProductPageTitle":"viewManageProductRangeRulesPageTitle"),description:""},g?a.createElement(a.Fragment,null,a.createElement($.Z,{color:"primary",variant:"body1",display:"inline",className:T.fontBold},"".concat(d("contract"),": ")),a.createElement($.Z,{variant:"body1",display:"inline"},g)):"",a.createElement(u.Z,{display:"flex",flexDirection:"row"},a.createElement("div",{style:{height:600,width:"100%"}},a.createElement(jt,null))))},la=function(){var e=(0,l.useRouteMatch)().path,t=i()().AccessControlled;return a.createElement(l.Switch,null,a.createElement(l.Route,{path:["".concat(e,"/:id/products/:productId/add-rules"),"".concat(e,"/:id/products/:productId/edit-rules/:range"),"".concat(e,"/:id/products/:productId/view-rules/:range")]},a.createElement(aa,null)),a.createElement(l.Route,{path:"".concat(e,"/create")},a.createElement(t,{feature:me},a.createElement(ea,null))),a.createElement(l.Route,{path:e+"/view/:id"},a.createElement(t,{feature:ye},a.createElement(na,null))),a.createElement(l.Route,{path:e+"/edit/:id"},a.createElement(t,{feature:ge},a.createElement(ta,null))),a.createElement(l.Route,{path:e+"/:id/products/"},a.createElement(t,{feature:ve},a.createElement(ia,null))),a.createElement(l.Route,null,a.createElement(t,{feature:ye},a.createElement(Jn,null))))},ca=function(){var e=(0,s.useTranslation)().t;return a.createElement(c.SeamlessContainer,{title:e("C2SRules"),description:e("C2SRulesPageDescription")},a.createElement(u.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end"},a.createElement(Gn,null)),a.createElement(Un,null))};var sa={ruleName:"",variantIdAndSKUMap:{},validFrom:(new Date).toISOString().slice(0,10)+" 00:00:59",validUntil:(new Date).toISOString().slice(0,10)+" 23:59:59",fieldsMap:{serviceType:" ",gatewayCode:" ",resellerType:" "}};const ua=function(){var e=(0,s.useTranslation)().t,t=a.useState(!1),n=(0,p.Z)(t,2),r=(n[0],n[1]),o=y(),i=o.showErrorMessage,u=o.showSuccessMessage,d=(o.showWarningMessage,(0,l.useHistory)()),m=a.useCallback((function(t){r(!0);var n,a={};Object.keys(t).forEach((function(e){t["".concat(e)]&&(a["".concat(e)]=t["".concat(e)])})),(n=a,h("/acms/concerted-rule-info",{method:"POST",body:n})).then((function(t){0===t.resultCode?(u(t.resultDescription||e("createdSuccesfully")),d.push("/home/contract/c2sRules")):(i(t.resultDescription),d.push("/home/contract/c2sRules"))})).catch((function(e){return i(e)})).finally((function(){return r(!1)}))}),[]);return a.createElement(c.SeamlessContainer,{title:e("createC2SRulesPageTitle"),description:e("createC2SRulesPageDescription")},a.createElement(Qn,{data:sa,view:!1,edit:!1,onFormSubmit:function(e){return m(e)}}))},da=function(){var e=(0,l.useParams)().id,t=(0,s.useTranslation)().t,n=y().showErrorMessage,r=a.useState(!1),o=(0,p.Z)(r,2),i=(o[0],o[1]),u=a.useState([]),d=(0,p.Z)(u,2),m=d[0],f=d[1],g=a.useState({}),v=(0,p.Z)(g,2),h=v[0],E=v[1],S=a.useState([]),T=(0,p.Z)(S,2),b=(T[0],T[1]);return a.useEffect((function(){i(!0),k(e).then((function(e){var t=Object.keys(e.variantIdAndSKUMap).map((function(t){return{value:parseInt(t),key:e.variantIdAndSKUMap[t]}}));E(e),f(t),b(t)})).catch((function(e){n(t("anErrorOccurred"))})).finally((function(){return i(!1)}))}),[]),a.createElement(c.SeamlessContainer,{title:t("ViewC2SRules"),description:t("ViewC2SRulesPageDescription")},h&&a.createElement(Qn,{data:h,view:!0,edit:!1,sku:m}))};var ma={ruleName:"",variantIdAndSKUMap:{},validFrom:"",validUntil:""};const pa=function(){var e=(0,l.useParams)().id,t=(0,s.useTranslation)().t,n=y(),r=n.showErrorMessage,o=n.showSuccessMessage,i=a.useState(!1),u=(0,p.Z)(i,2),d=(u[0],u[1]),m=a.useState([]),f=(0,p.Z)(m,2),g=f[0],v=f[1],E=(0,l.useHistory)(),S=a.useState(ma),T=(0,p.Z)(S,2),b=T[0],C=T[1];a.useEffect((function(){d(!0),k(e).then((function(e){var t=Object.keys(e.variantIdAndSKUMap).map((function(t){return{value:parseInt(t),key:e.variantIdAndSKUMap[t]}}));e.variantIdAndSKUMap=t,C(e),v(t)})).catch((function(e){r(t("anErrorOccurred"))})).finally((function(){return d(!1)}))}),[]);var Z=a.useCallback((function(n){var a,i,l,c,s={ruleId:e,ruleName:n.ruleName,variantIdAndSKUMap:n.variantIdAndSKUMap,validFrom:null===(a=n.validFrom)||void 0===a?void 0:a.slice(0,19),validUntil:null===(i=n.validUntil)||void 0===i?void 0:i.slice(0,19),fieldsMap:n.fieldsMap,createdBy:n.createdBy};d(!0),(l=s,c=e,h("/acms/update-product-rule-association/".concat(c),{method:"PUT",body:l})).then((function(e){0===e.resultCode?(o(e.resultDescription||t("C2SRuleupdatedsuccessfully")),E.push("/home/contract/c2sRules")):r(e.resultDescription)})).catch((function(e){return r(e)})).finally((function(){return d(!1)}))}),[]);return a.createElement(c.SeamlessContainer,{title:t("editc2sRulesPageTitle"),description:t("editc2sRulesPageDescription")},a.createElement(Qn,{data:b,view:!1,sku:g,edit:!0,onFormSubmit:function(e){return Z(e)}}))},fa=function(){var e=(0,l.useRouteMatch)().path;return a.createElement(l.Switch,null,a.createElement(l.Route,{path:e+"/create"},a.createElement(ua,null)),a.createElement(l.Route,{path:e+"/view/:id"},a.createElement(da,null)),a.createElement(l.Route,{path:e+"/edit/:id"},a.createElement(pa,null)),a.createElement(l.Route,{path:"".concat(e)},a.createElement(ca,null)))}}}]);