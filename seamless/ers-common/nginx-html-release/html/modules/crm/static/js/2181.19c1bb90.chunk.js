(self.webpackChunk_unified_crm=self.webpackChunk_unified_crm||[]).push([[2181],{40227:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>z});var a=t(2411),r=t(74315),i=t(48049),l=t(13248),u=t(63135);const o=function(){var e=(0,l.useSnackbar)().enqueueSnackbar,n=(0,u.useTranslation)().t;function t(e){var t=n("anErrorOccurred");return["resultMessage","message","resultDescription"].forEach((function(n){e.hasOwnProperty(n)&&(t=e[n])})),t}return{showSuccessMessage:function(n){e("string"!=typeof n?t(n):n,{variant:"success"})},showErrorMessage:function(n){e("string"!=typeof n?t(n):n,{variant:"error"})},showInfoMessage:function(n){e("string"!=typeof n?t(n):n,{variant:"info"})},showWarningMessage:function(n){e("string"!=typeof n?t(n):n,{variant:"warning"})}}};var c=t(3266),d=t(8526),s=t(29971);const m=function(e){var n=e.type,t=e.component,l=e.children,u=o().showErrorMessage,d=(0,i.useHistory)(),m=a.useState(),v=(0,r.Z)(m,2),p=v[0],f=v[1],h=a.useState(!1),g=(0,r.Z)(h,2),b=g[0],E=g[1],w=a.useState({}),Z=(0,r.Z)(w,2),y=Z[0],k=Z[1],S=(0,s.useSelector)((function(e){var n,t,a;return null==e||null===(n=e.auth)||void 0===n||null===(t=n.user)||void 0===t||null===(a=t.info)||void 0===a?void 0:a.additionalFields}));return a.useEffect((function(){E(!0);var e=null==S?void 0:S.find((function(e){return"dealerId"===(null==e?void 0:e.name)}));(0,c.t4)(t,n).then((function(n){f(null==n?void 0:n.value);var t=function(e,n){return null===e?{}:function(e){return e.sections.reduce((function(e,n){return e.concat(n.widgets)}),[])}(e).reduce((function(e,t){var a={};switch(t.type){case"date":a=new Date;break;case"checkbox":t.options.forEach((function(e){a[e.key]=!1}));break;case"select":var r=t.options.find((function(e){return e.value===t.defaultValue}));a=r||null;break;case"radio":var i=t.options.find((function(e){return e.value===t.defaultValue}));a=i?i.value:"";break;default:a="customerAccountId"===t.id?n:t.defaultValue}var l=t.id.split(".");if(2===l.length){var u=l[0],o=l[1];e[u]=e[u]||{},e[u][o]=a}else e[t.id]=a;return e}),{})}(null==n?void 0:n.value,null==e?void 0:e.value);k(t)})).catch((function(e){u(e),d.push("/home/crm/tickets")})).finally((function(){return E(!1)}))}),[n,t]),a.createElement(a.Fragment,null,l({template:p,loading:b,data:y,type:n,reloadHandler:function(){d.push("/home/crm/tickets/create")}}))};var v=t(56470),p=t(77162),f=t.n(p),h=t(98069),g=t(54297),b=t(33553),E=t(79692),w=t(12420),Z=t(77114),y=t(6277),k=t(11746),S=t(7560),C=t(61564),x=t(39590),q=t(2682),A=t(5806),T=t(44962),D=t(42494),M=t(84899),I=t(64326),O=t(21324),R=t(86619),W=t(77954),_=t(19258),F=t(77790),L=t.n(F),B=(0,E.Z)((function(e){return(0,w.Z)({testStyle:{"& textarea":{padding:"auto!important",height:"100px !important",resize:"both"}}})}));const H=function(e){var n,t,r,i,l,o,c=e.section,d=e.values,s=e.handleChange,m=(0,u.useTranslation)().t,v=B(),p=null==c||null===(n=c.widgets)||void 0===n?void 0:n.find((function(e){return"subArea"==e.id})),f=null==c||null===(t=c.widgets)||void 0===t?void 0:t.find((function(e){return"thirdLevelArea"==e.id})),h=window.config.openCalendarWith||"year";return null!=d&&d.area&&(r=null==p||null===(l=p.options)||void 0===l?void 0:l.filter((function(e){var n;return(null==e||null===(n=e.area)||void 0===n?void 0:n.indexOf(null==d?void 0:d.area))>-1}))),null!=d&&d.subArea&&(i=null==f||null===(o=f.options)||void 0===o?void 0:o.filter((function(e){var n;return(null==e||null===(n=e.subArea)||void 0===n?void 0:n.indexOf(null==d?void 0:d.subArea))>-1}))),a.createElement(b.Z,{width:"100%"},a.createElement(b.Z,{mt:2,mr:2,mb:2,display:"flex",flexDirection:"row",flexWrap:"wrap"},null==c?void 0:c.widgets.map((function(e){var n,t,l=null,u=e.id.split(".");switch(t=1===u.length?d[e.id]:d[u[0]][u[1]],e.type){case"text":l=a.createElement(b.Z,{width:"90%"},a.createElement(b.Z,{width:"30%",pb:3,pr:2},a.createElement(g.SeamlessInput,{fullWidth:!0,required:e.required,name:e.id,label:e.name,value:t,onChange:s})));break;case"textarea":l=a.createElement(b.Z,{width:"90%",pb:2,pr:2},a.createElement(g.SeamlessInput,{fullWidth:!0,required:e.required,name:e.id,label:e.name,value:t,multiline:!0,onChange:s,inputClassName:v.testStyle}));break;case"date":l=a.createElement(b.Z,{width:"30%",pb:3,pr:2},a.createElement(C.M,{utils:_.Z},a.createElement(x.e,{required:e.required,views:["year","month","date"],openTo:h,variant:"inline",format:"yyyy/MM/dd",margin:"normal",label:e.name,name:e.id,value:t,onChange:function(n){s({target:{value:n,name:e.id}})},KeyboardButtonProps:{"aria-label":"change date"}})));break;case"radio":l=a.createElement(b.Z,{width:"30%",pb:3,pr:2},a.createElement(D.Z,{component:"fieldset"},a.createElement(M.Z,{component:"legend",required:e.required},e.name),a.createElement(q.Z,{name:e.id,value:t,onChange:s},null==e||null===(n=e.options)||void 0===n?void 0:n.map((function(e){return a.createElement(A.Z,{value:e.value,control:a.createElement(T.Z,null),label:e.name})})))));break;case"checkbox":l=a.createElement(b.Z,{width:"30%",pb:3,pr:2},a.createElement(D.Z,{component:"fieldset"},a.createElement(M.Z,{component:"legend",required:e.required}," ",e.name),a.createElement(I.Z,null,e.options.map((function(n){return a.createElement(A.Z,{control:a.createElement(O.Z,{checked:t[n.key],onChange:s,name:"".concat(e.id,".").concat(n.name)}),label:n.key})})))));break;case"select":l=a.createElement(b.Z,{width:"30%",pb:3,pr:2},a.createElement(W.ZP,{id:"combo-box-".concat(e.id),value:t,options:e.options,getOptionLabel:function(e){return e.name},style:{width:"100%"},onChange:function(n){s({target:{value:n,name:e.id}})},renderInput:function(n){return a.createElement(R.Z,(0,S.Z)({},n,{autoComplete:"new-password",label:e.name,variant:"outlined",required:e.required}))}}));break;case"file":l=a.createElement(b.Z,{width:"30%",pb:3,pr:2},a.createElement(L(),{name:e.id,value:t,label:e.name,onChange:s,resourceType:"agent"}),t&&m("uploadSuccessful"));break;default:l=a.createElement(b.Z,{width:"30%",pb:3,pr:2},"area"==e.id?a.createElement(g.SeamlessDropDown,{fullWidth:!0,id:e.id,label:e.name,options:[{name:"Select",value:null}].concat((0,k.Z)(null==e?void 0:e.options)).map((function(e){return{value:e.value,key:e.name}})),name:e.id,value:t,onChange:function(n){s({target:{value:null==n?void 0:n.target.value,name:e.id}})}}):null,"subArea"==e.id?a.createElement(g.SeamlessDropDown,{fullWidth:!0,id:e.id,label:e.name,options:[{name:"Select",value:null}].concat((0,k.Z)(r||[])).map((function(e){return{value:e.value,key:e.name}})),name:e.id,value:t,disabled:!Boolean(null==d?void 0:d.area),onChange:function(n){s({target:{value:null==n?void 0:n.target.value,name:e.id}})}}):null,"thirdLevelArea"==e.id?a.createElement(g.SeamlessDropDown,{fullWidth:!0,id:e.id,label:e.name,options:[{name:"Select",value:null}].concat((0,k.Z)(i||[])).map((function(e){return{value:e.value,key:e.name}})),disabled:!Boolean(null==d?void 0:d.subArea),name:e.id,value:t,onChange:function(n){s({target:{value:null==n?void 0:n.target.value,name:e.id}})}}):null,"area"!=e.id&&"subArea"!=e.id&&"thirdLevelArea"!=e.id?a.createElement(g.SeamlessInput,{fullWidth:!0,required:e.required,name:e.id,label:e.name,value:t,onChange:s}):null)}return l}))))};var N=(0,E.Z)((function(e){return(0,w.Z)({root:{height:500,overflowY:"scroll"},button:{margin:e.spacing(1)},element:{margin:e.spacing(1)},dividerSpacing:{marginBottom:e.spacing(3)},btnSpacing:{marginLeft:e.spacing(2),marginRight:e.spacing(2)},spacingTop:{marginTop:e.spacing(3)}})}));const V=function(e){var n=e.template,t=e.loading,r=e.data,l=(e.type,e.reloadHandler),s=(0,i.useHistory)(),m=N(),p=(0,u.useTranslation)().t,E=o(),w=E.showErrorMessage,k=E.showSuccessMessage,S=(E.showInfoMessage,E.showWarningMessage),C=function(){var e=(0,v.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(r);case 2:l();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(e){var n=(0,u.useTranslation)().t;return e?e.sections.map((function(e){var t=e.widgets.reduce((function(e,t){var a={};["text","file","radio"].includes(t.type)?a[t.id]=d.Z_():"number"===t.type?a[t.id]=d.Rx():"email"===t.type?a[t.id]=d.Z_().email():"date"===t.type?a[t.id]=d.hT().nullable():"textarea"===t.type?a[t.id]=d.Z_():"select"===t.type?a[t.id]=d.Ry().nullable():"/^[a-zA-Z0-9]*$/"===t.validation&&(a[t.id]=d.Z_().matches(/^[a-zA-Z0-9]*$/)),t.required&&a[t.id]&&(a[t.id]=a[t.id].required("".concat(t.name," ").concat(n("isRequiredField"))));var r=t.id.split(".");if(2===r.length){var i=r[0],l={};l[r[1]]=a[t.id],e[i]=e[i]?e[i].concat(d.Ry(l)):d.Ry().shape(l)}else e[t.id]=a[t.id];return e}),{});return d.Ry().shape(t)})):[]}(n),q=(0,Z.TA)({initialValues:r,onSubmit:function(e){(0,c.ax)(e).then((function(e){"INTERNAL_FAILED"==(null==e?void 0:e.resultDescription)?w((null==e?void 0:e.resultDescription)||p("anErrorOccurred")):0===(null==e?void 0:e.resultCode)?(k(null==e?void 0:e.resultDescription),s.push("/home/crm/tickets")):w((null==e?void 0:e.resultDescription)||p("anErrorOccurred"))})).catch((function(e){return w(e.message||p("anErrorOccurred"))}))},validationSchema:null==x?void 0:x[0],enableReinitialize:!0}),A=q.values,T=q.handleChange,D=q.handleSubmit,M=q.validateForm,I=q.resetForm;return q.setValues,t?a.createElement(b.Z,{width:"100%"},a.createElement(b.Z,{m:1},a.createElement(h.Z,{animation:"wave",variant:"text",width:200,height:45})),a.createElement(b.Z,{m:1},a.createElement(h.Z,{variant:"text",animation:"wave",width:"90%",height:45})),a.createElement(b.Z,{m:1},a.createElement(h.Z,{variant:"text",animation:"wave",width:"90%",height:45})),a.createElement(b.Z,{m:1},a.createElement(h.Z,{variant:"text",animation:"wave",width:"30%",height:45}))):n?a.createElement(a.Fragment,null,null==n?void 0:n.sections.map((function(e){return a.createElement(H,{section:e,key:e.title,values:A,handleChange:T})})),(null==n?void 0:n.sections)&&a.createElement("div",null,a.createElement(g.SeamlessButton,{className:(0,y.default)(m.element,m.button),color:"primary",variant:"contained",onClick:function(e){M().then((function(e){var n,t=Object.values(e);t.length>0?(n=t[0],S("string"==typeof n?n:n[Object.keys(n)[0]])):D()}))}},p("submit")),a.createElement(g.SeamlessButton,{onClick:C,className:(0,y.default)(m.element,m.button),color:"primary",variant:"outlined"},p("reset")))):null},z=function(){var e=(0,u.useTranslation)().t;return a.createElement(g.SeamlessContainer,{title:e("createTicketTitle","Create ticket"),description:e("createTicketDescription","Create new customer request ticket")},a.createElement(m,{type:"Ticket",component:"CRM"},(function(e){var n=e.template,t=e.loading,r=e.data,i=e.type,l=e.reloadHandler;return a.createElement(V,{template:n,loading:t,data:r,type:i,reloadHandler:l})})))}}}]);