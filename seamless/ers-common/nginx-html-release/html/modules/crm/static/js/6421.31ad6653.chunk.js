(self.webpackChunk_unified_crm=self.webpackChunk_unified_crm||[]).push([[6421],{35077:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>X});var n=a(74315),l=a(2411),i=a.n(l),r=a(33553),s=a(54297),o=a(63135),c=a(18896),u=a(77277),m=a(48049),d=a(7560),f=a(55238),p=a(51119),g=a(41744),v=a.n(g),E=a(3266),Z=a(29971);function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){(0,p.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const S=function(e){var t=e.children,a=((0,o.useTranslation)().t,l.useState([])),i=(0,n.Z)(a,2),r=i[0],s=i[1],c=l.useState(),u=(0,n.Z)(c,2),m=u[0],d=u[1],f=l.useState(!1),p=(0,n.Z)(f,2),v=p[0],y=p[1],S=l.useState(!0),b=(0,n.Z)(S,2),x=b[0],w=(b[1],l.useState(0)),C=(0,n.Z)(w,2),N=C[0],k=(C[1],l.useState("Open")),O=(0,n.Z)(k,2),D=O[0],T=O[1],P=(0,Z.useSelector)((function(e){var t,a,n;return null==e||null===(t=e.auth)||void 0===t||null===(a=t.user)||void 0===a||null===(n=a.info)||void 0===n?void 0:n.additionalFields})),R=(0,g.useServerTable)({page:0,perPage:20,order:"desc",orderBy:"startTime",filter:{}}),j=l.useCallback((function(){y(!0);var e=null==P?void 0:P.find((function(e){return"dealerId"===(null==e?void 0:e.name)}));if(null!=e&&e.value){var t={customerId:"SFC",operationId:"GETCRMREQUEST",additionalFields:{customerAccountId:null==e?void 0:e.value,status:D}};(0,E.PA)(t).then((function(e){var t,a;d(e),s(null!=e&&null!==(t=e.additionalFields)&&void 0!==t&&t.rows?null==e||null===(a=e.additionalFields)||void 0===a?void 0:a.rows:[])})).catch((function(e){s([])})).finally((function(){y(!1)}))}else y(!1)}),[R.page,R.perPage,D]);return l.useEffect((function(){j()}),[j]),l.createElement(l.Fragment,null,t(h(h({tickets:r,loading:v,totalCount:N},R),{},{ticketsResponse:m,setStatus:T,isDealerExist:x})))};var b=a(38592),x=a(60552),w=a(13248),C=a(79692),N=a(12420),k=a(60364),O=a(60905),D=a(90436),T=a(27068),P=a(6277),R=(0,C.Z)((function(e){return(0,N.Z)({spacingTop:{marginTop:e.spacing(3)},spacingBottom:{marginBottom:e.spacing(1)},skeleton:{height:20},percentTop:{top:"25%"},responsiveImage:{maxWidth:200,width:"100%"},fieldHeading:{fontWeight:"bold",textTransform:"capitalize",fontSize:14},fieldValue:{textTransform:"capitalize",fontSize:14,wordBreak:"break-all"},rowSpacing:{marginBottom:e.spacing(.7)},statusChip:{marginBottom:"15px",fontSize:12}})}));const j=function(e){var t,a=e.ticket,n=(e.loading,(0,o.useTranslation)().t),i=R();return l.createElement("div",null,l.createElement(O.Z,{container:!0,spacing:3},l.createElement(O.Z,{item:!0,xs:12,sm:10},l.createElement(O.Z,{container:!0,className:(0,P.default)(i.rowSpacing),spacing:3},l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("serviceRequestNumber","Service request number"))),l.createElement(O.Z,{item:!0,xs:12,sm:3},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a?void 0:a.serviceRequestId)),l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("serviceRequestStatus","Service request status"))),l.createElement(O.Z,{item:!0,xs:12,sm:3},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a?void 0:a.status))),l.createElement(O.Z,{container:!0,className:(0,P.default)(i.rowSpacing),spacing:3},l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("owner"))),l.createElement(O.Z,{item:!0,xs:12,sm:3},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a?void 0:a.owner)),l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("customerDocType","Doc type"))),l.createElement(O.Z,{item:!0,xs:12,sm:3},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a?void 0:a.customerDocType))),l.createElement(O.Z,{container:!0,spacing:3,className:(0,P.default)(i.rowSpacing)},l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("category","Category"))),l.createElement(O.Z,{item:!0,xs:12,sm:3},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a?void 0:a.area)),l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("srType","SR Type"))),l.createElement(O.Z,{item:!0,xs:12,sm:3},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a?void 0:a.subArea))),l.createElement(O.Z,{container:!0,spacing:3,className:(0,P.default)(i.rowSpacing)},l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("serviceRequestItem","Service request item"))),l.createElement(O.Z,{item:!0,xs:12,sm:6},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a?void 0:a.thirdLevelArea))),l.createElement(O.Z,{container:!0,spacing:3,className:(0,P.default)(i.rowSpacing)},l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("createdDate","Created date"))),l.createElement(O.Z,{item:!0,xs:12,sm:3},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},(null==a?void 0:a.openedDate)&&(0,T.Z)(new Date(null==a?void 0:a.openedDate),"dd-MM-yyyy"))),l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("closedDate","Closed date"))),l.createElement(O.Z,{item:!0,xs:12,sm:3},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},(null==a?void 0:a.closedDate)&&(0,T.Z)(new Date(null==a?void 0:a.closedDate),"dd-MM-yyyy"))))),l.createElement(O.Z,{container:!0,spacing:3,className:(0,P.default)(i.rowSpacing)},l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("sladate","SLA date"))),l.createElement(O.Z,{item:!0,xs:12,sm:6},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},(null==a?void 0:a.closedDate)&&(0,T.Z)(new Date(null==a?void 0:a.closedDate),"dd-MM-yyyy")))),l.createElement(O.Z,{container:!0,spacing:3,className:(0,P.default)(i.rowSpacing)},l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("attachmentFileName","Attachment filename"))),l.createElement(O.Z,{item:!0,xs:12,sm:6},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a||null===(t=a.attachmentURL)||void 0===t?void 0:t.activityFileName))),l.createElement(O.Z,{container:!0,spacing:3,className:(0,P.default)(i.rowSpacing)},l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("description"))),l.createElement(O.Z,{item:!0,xs:12,sm:9},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a?void 0:a.description))),l.createElement(O.Z,{container:!0,spacing:3,className:(0,P.default)(i.rowSpacing)},l.createElement(O.Z,{item:!0,xs:12,sm:2},l.createElement(D.Z,{className:(0,P.default)(i.fieldHeading)},n("resolution","Resolution details"))),l.createElement(O.Z,{item:!0,xs:12,sm:6},l.createElement(D.Z,{className:(0,P.default)(i.fieldValue)},null==a?void 0:a.resolution))))))};var I=a(8629),M=a(49429),F=a(38724),V=a(79249),H=a(7089),B=a(73698),q=a(42494),z=a(56939),W=a(67801),A=a(44104),_=a.n(A);function L(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function K(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?L(Object(a),!0).forEach((function(t){(0,p.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):L(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var U=(0,C.Z)((function(e){return(0,N.Z)({root:{marginTop:e.spacing(5),width:"100%",padding:e.spacing(2)},formWrapper:{padding:"".concat(e.spacing(1.5)," 0")},formWidget:{marginTop:e.spacing(5),"& .MuiFormControl-root":{marginBottom:e.spacing(1.5),marginRight:e.spacing(1.5)},"& .MuiTypography-root":{marginBottom:e.spacing(1)}},saveBtn:{marginTop:e.spacing(3)},modalImageSize:{maxWidth:70},dialogWrapper:{"& .MuiDialog-container":{width:"100%"},"& .MuiDialogContent-root":{marginTop:e.spacing(2),marginBottom:e.spacing(3)}},fontHeavy:{fontWeight:e.typography.fontWeightBold},modalContentSpacing:{marginTop:e.spacing(3),marginBottom:e.spacing(3)},btnSpace:{marginRight:e.spacing(2),marginTop:e.spacing(3)},modalFooter:{display:"flex",justifyContent:"flex-end"},statusChip:{fontSize:12,marginLeft:"10px"}})}));function G(e){U();var t=e.item,a=e.applyValue;return l.createElement("div",null,l.createElement(q.Z,{fullWidth:!0},l.createElement(z.Z,{htmlFor:"age-native-simple"},"Status"),l.createElement(B.Z,{native:!0,fullWidth:!0,value:t.value,onChange:function(e){a(K(K({},t),{},{value:e.target.value}))}},l.createElement("option",{value:"Open"},"Open"),l.createElement("option",{value:"In Progress"},"In Progress"),l.createElement("option",{value:"Closed"},"Closed"),l.createElement("option",{value:"Pending"},"Pending"),l.createElement("option",{value:"Rejected"},"Rejected"))))}const Q=function(e){var t=e.loading,a=e.tickets,i=(e.ticketsResponse,e.page),r=e.perPage,s=e.onPageChange,c=e.onPageSizeChange,d=e.totalCount,f=e.setStatus,g=e.isDealerExist,E=U(),Z=l.useState(!1),y=(0,n.Z)(Z,2),h=y[0],S=y[1],C=l.useState(),N=(0,n.Z)(C,2),O=N[0],D=N[1],P=l.useState("primary"),R=(0,n.Z)(P,2),B=R[0],q=R[1],z=l.useState({}),A=(0,n.Z)(z,2),L=A[0],Q=A[1],J=((0,w.useSnackbar)().enqueueSnackbar,(0,o.useTranslation)().t),X=((0,m.useHistory)(),(0,k.Z)()),Y=_()().AccessControlled,$=function(){S(!1)},ee=l.useCallback((function(e){var t=e.filterModel.items[0].value,a=e.filterModel.items[0].columnField;Q(K(K({},L),{},(0,p.Z)({},a,t))),f(t||"Open")}),[]),te=[{label:"Equal",value:"equal",getApplyFilterFn:function(e){return e.columnField&&e.value&&e.operatorValue?function(t){return t.value==e.value}:null},InputComponent:G}],ae=[{field:"serviceRequestId",headerName:J("serviceRequestId","SR ID"),flex:1,filterable:!1},{field:"area",headerName:J("category","Category"),flex:1,filterable:!1},{field:"subArea",headerName:J("srType","SR Type"),flex:1.5,filterable:!1},{field:"openedDate",headerName:J("openedDate","Opened Date"),flex:1,filterable:!1,renderCell:function(e){return l.createElement("div",null,(null==e?void 0:e.row.openedDate)&&(0,T.Z)(new Date(null==e?void 0:e.row.openedDate),"dd-MM-yyyy"))}},{field:"status",headerName:J("status"),flex:1,filterOperators:te},{field:"actions",headerName:J("actions"),sortable:!1,filterable:!1,renderCell:function(e){return l.createElement("div",null,l.createElement(Y,{feature:W.R.VIEW_TICKET},l.createElement(b.Z,{size:"small",color:"primary",variant:"text"},l.createElement(u.Z,{onClick:function(){var t;D(null==e?void 0:e.row),function(e){var t,a,n,l,i,r,s,o,c,u,m;switch(e){case"Open":case"Rejected":m=null==X||null===(t=X.palette)||void 0===t||null===(a=t.error)||void 0===a?void 0:a.main;break;case"Pending":case"In Progress":m=null==X||null===(n=X.palette)||void 0===n||null===(l=n.warning)||void 0===l?void 0:l.main;break;case"Closed":m=null==X||null===(i=X.palette)||void 0===i||null===(r=i.success)||void 0===r?void 0:r.main;break;default:m=null==X||null===(s=X.palette)||void 0===s||null===(o=s.success)||void 0===o?void 0:o.main}q(m||(null==X||null===(c=X.palette)||void 0===c||null===(u=c.success)||void 0===u?void 0:u.main))}(null==e||null===(t=e.row)||void 0===t?void 0:t.status),S(!0)}},l.createElement(x.Z,{fontSize:"small"})))))},flex:1}];return l.createElement(l.Fragment,null,g?l.createElement(v(),{onPageSizeChange:function(e){c(e.pageSize)},onPageChange:function(e){s(e.page)},pagination:!0,paginationMode:"server",page:i,pageSize:r,rowCount:d,rows:a,loading:t,columns:ae,getRowId:function(e){return e.serviceRequestId},columnBuffer:3,sortingMode:"server",filterMode:"server",onFilterModelChange:ee}):null,l.createElement(I.Z,{open:h,onClose:$,maxWidth:"md",fullWidth:!0},l.createElement(V.Z,{id:"alert-dialog-title"},J("viewTicketDetails","Ticket details"),l.createElement(H.Z,{style:{backgroundColor:B,color:"#fff"},label:null==O?void 0:O.status,className:E.statusChip})),l.createElement(F.Z,null,l.createElement(j,{ticket:O,loading:!1})),l.createElement(M.Z,null,l.createElement(u.Z,{onClick:$,color:"primary",autoFocus:!0},"close"))))},J=function(){return i().createElement(S,null,(function(e){var t=e.ticketsResponse,a=e.tickets,n=e.loading,l=e.totalCount,r=e.setStatus,s=e.isDealerExist,o=(0,f.Z)(e,["ticketsResponse","tickets","loading","totalCount","setStatus","isDealerExist"]);return i().createElement("div",{style:{height:600,width:"100%"}},i().createElement(Q,(0,d.Z)({},o,{loading:n,tickets:a,totalCount:l,ticketsResponse:t,setStatus:r,isDealerExist:s})))}))},X=function(){var e=(0,o.useTranslation)().t,t=_()().checkPermission,a=l.useState(!0),i=(0,n.Z)(a,2),d=i[0],f=(i[1],(0,Z.useSelector)((function(e){var t,a,n;return null==e||null===(t=e.auth)||void 0===t||null===(a=t.user)||void 0===a||null===(n=a.info)||void 0===n?void 0:n.additionalFields})));return l.useEffect((function(){var e,t,a=(null===(e=window.config)||void 0===e||null===(t=e.crm)||void 0===t?void 0:t.fieldName)||"dealerId";null==f||f.find((function(e){return(null==e?void 0:e.name)===a}))}),[f]),l.createElement(s.SeamlessContainer,{title:e("createTicketTitle","Create ticket"),description:e("createTicketDescription","Create new customer request ticket")},t(W.R.CRM_CREATE_TICKET_BTN)&&l.createElement(r.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end"},l.createElement(u.Z,{style:{visibility:"hidden"}}),l.createElement(s.SeamlessButton,{component:m.Link,to:"/home/crm/tickets/create",variant:"contained",color:"primary",endIcon:l.createElement(c.Z,null)},e("createTicket","Create ticket"))),d?l.createElement("div",{style:{height:"600px"}},l.createElement(J,null)):null)}}}]);