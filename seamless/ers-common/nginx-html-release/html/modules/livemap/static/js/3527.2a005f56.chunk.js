(self.webpackChunk_unified_livemap=self.webpackChunk_unified_livemap||[]).push([[3527],{3527:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ae});var a=n(1746),r=n(4315),l=n(2411),o=n(1120),i=n(5117),s=n(5167),c=n(1749),u=n(2318),d=n(8049),p=n(9609),m=n(6277),g=n(4174),f=n(7428),v=n(3901),h=n(8463),E=n(4697),Z=n(7273),b=n(6498),y=n(8416),S=n(974),w=n(7871),I=n(3664),x=(0,o.Z)((function(e){return(0,i.Z)({input:{marginTop:e.spacing(2),marginBottom:e.spacing(2)},orderBox:{border:"1px solid #EDEDED",marginTop:"10px",marginBottom:"10px",width:"100%",borderRadius:"10px",padding:"10px",background:"#F7F7F7",height:350},infoWrapper:{display:"flex",justifyContent:"space-between",borderBottom:"1px solid #c3c3c3",height:"fit-content"},root:{margin:50,width:"100%","& > * + *":{marginTop:e.spacing(2)}},activeTripWrapper:{borderBottom:"1px solid #c3c3c3"},widgetWrapper:{marginTop:10,marginRight:60},widgetDiv:{overflow:"auto",height:"250px"},cardWrapper:{margin:5},iconWrapper:{marginTop:12,marginRight:5}})}));const k=function(e){var t,n,a,o,i,s,d,m,f=e.agentId,k=e.markers,C=e.error,N=e.loading,O=e.plannedRoutes,W=e.routes,D=e.widgets,P=e.center,T=l.useState(),M=(0,r.Z)(T,2),F=M[0],R=M[1],B=(0,I.Z)().showErrorMessage,L=(0,p.useTranslation)().t,j=x();l.useEffect((function(){if(f){var e={dealerID:{id:f,type:"RESELLERID"},fetchAccountBalanceInformation:!0};(0,g.Gg)(e).then((function(e){R(e.resellerInfo)})).catch((function(e){return B(e)}))}}),[f]);var z=F&&(null==F||null===(t=F.additionalFields)||void 0===t?void 0:t.find((function(e){return"region"===e.name})));return l.createElement(l.Fragment,null,l.createElement(c.Z,{item:!0,className:j.input,lg:5,md:5},l.createElement(c.Z,{container:!0,spacing:3,className:j.orderBox},l.createElement(c.Z,{item:!0,xs:12,className:j.infoWrapper},l.createElement(u.Z,{variant:"h6"},L("basicInformation"))),l.createElement(c.Z,{item:!0,xs:12,sm:6},l.createElement(u.Z,{variant:"body2"},L("name"),": ",null==F||null===(n=F.resellerData)||void 0===n?void 0:n.resellerName)),l.createElement(c.Z,{item:!0,xs:12,sm:6},null!=F&&null!==(a=F.resellerData)&&void 0!==a&&a.resellerMSISDN?l.createElement(u.Z,{variant:"body2"},L("MSISDN"),": ",null==F||null===(o=F.resellerData)||void 0===o?void 0:o.resellerMSISDN):l.createElement(u.Z,{variant:"body2"},L("phone"),": ",null==F||null===(i=F.resellerData)||void 0===i||null===(s=i.address)||void 0===s?void 0:s.phone)),l.createElement(c.Z,{item:!0,xs:12,sm:6},l.createElement(u.Z,{variant:"body2"},L("region"),": ",z?z.value:"")),l.createElement(c.Z,{item:!0,xs:12,sm:6},l.createElement(u.Z,{variant:"body2"},L("parent"),": ",null==F||null===(d=F.resellerData)||void 0===d?void 0:d.parentResellerId)),l.createElement(c.Z,{item:!0,xs:12,sm:6},l.createElement(u.Z,{variant:"body2"},L("status"),": ",null==F||null===(m=F.resellerData)||void 0===m?void 0:m.status)))),l.createElement(c.Z,{item:!0,className:j.input,lg:7,md:7},l.createElement(c.Z,{container:!0,item:!0,spacing:2,className:j.orderBox},N?l.createElement(l.Fragment,null):C?l.createElement("div",{className:j.root},l.createElement(S.Alert,{severity:"info"},l.createElement(S.AlertTitle,null,"Info"),L("activeTripInfo"))):l.createElement(l.Fragment,null,l.createElement(c.Z,{item:!0,xs:12,className:j.activeTripWrapper},l.createElement(u.Z,{variant:"h6"},L("activeTrip"))),l.createElement(c.Z,{item:!0,container:!0,xs:12,spacing:2,className:j.widgetWrapper},l.createElement(c.Z,{item:!0,xs:6},l.createElement("div",{className:j.widgetDiv},D&&D.map((function(e,t){return l.createElement(h.Z,{className:j.cardWrapper,key:t},l.createElement(E.Z,{avatar:l.createElement(v.Z,{style:"OPEN"!==(null==e?void 0:e.status)?{backgroundColor:"#91ed81",color:"black"}:{backgroundColor:"#fff02a8a",color:"black"}},null==e?void 0:e.id.charAt(0)),action:l.createElement("div",{className:j.iconWrapper},"OPEN"!==(null==e?void 0:e.status)?l.createElement(b.Z,{style:{color:"#91ed81"}}):l.createElement(Z.Z,{style:{color:"#fff02a8a"}})),title:null==e?void 0:e.id}))})))),l.createElement(c.Z,{item:!0,xs:6},l.createElement(y.Z,{height:250,width:280,markers:k,center:P},O&&O.length>0?O.map((function(e,t){var n;return l.createElement(w.aH,{key:t,options:{path:null===(n=e.routes[0])||void 0===n?void 0:n.overview_path,strokeColor:"blue",strokeWeight:7.5,strokeOpacity:.6,zIndex:1}})})):null,W&&W.length>0?l.createElement(w.aH,{options:{path:W,strokeColor:"#474a54",strokeWeight:7.5,strokeOpacity:.6,zIndex:100}}):null)))))))};var C=n(7560),N=n(5238),O=n(1119);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){(0,O.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const P=function(e){var t=e.children,n=e.agentId,a=l.useState([]),o=(0,r.Z)(a,2),i=o[0],s=o[1],c=l.useState(!1),u=(0,r.Z)(c,2),d=u[0],p=u[1],m=l.useState(0),f=(0,r.Z)(m,2),v=f[0],h=f[1],E=l.useState(30),Z=(0,r.Z)(E,2),b=Z[0],y=(Z[1],l.useState(1)),S=(0,r.Z)(y,2),w=S[0],x=S[1],k=l.useState("desc"),C=(0,r.Z)(k,2),N=C[0],W=C[1],P=l.useState("tripCreated"),T=(0,r.Z)(P,2),M=T[0],F=T[1],R=l.useState({}),B=(0,r.Z)(R,2),L=B[0],j=B[1],z=l.useState(""),H=(0,r.Z)(z,2),_=H[0],A=H[1],U=l.useCallback((function(e){var t=e.sortModel[0].field,n=e.sortModel[0].sort;F(t),W(n)}),[]),V=l.useCallback((function(e){var t=e.filterModel.items[0].value,n=e.filterModel.items[0].columnField;j(D(D({},L),{},(0,O.Z)({},n,t)))}),[]),G=l.useCallback((function(e){x(e)}),[]),X=l.useCallback((function(e){A(e)}),[]),q={sort:"".concat(M,"_").concat(null==N?void 0:N.toLowerCase()),page:w,perPage:b,filter:n?"agentId:".concat(n):""},J=(0,I.Z)(),K=J.showErrorMessage,Q=J.showWarningMessage;return l.useEffect((function(){p(!0),(0,g.XS)(q).then((function(e){var t;0==e.resultCode?(s(e.trips),h(null==e||null===(t=e.metaData)||void 0===t?void 0:t.totalCount)):(Q(e.resultMessage),s([]))})).catch((function(e){return K(e)})).finally((function(){return p(!1)}))}),[M,N,w,b,L,_]),l.createElement(l.Fragment,null,t({trips:i,loading:d,totalCount:v,page:w,perPage:b,orderBy:M,order:N,filter:L,onSort:U,setParentPage:G,onFilterChange:V,setParentSelectedType:X}))};var T,M,F=n(1744),R=n.n(F),B=n(5258),L=n(282),j=n(4837),z=n(2663),H=n(9525),_=n(2863),A=n(7812),U=n(8358),V=n(868),G=n(552),X=n(8623),q=(0,o.Z)((function(e){return(0,i.Z)({dialogWrapper:{textAlign:"center","& .MuiDialog-container":{width:"100%"},"& .MuiDialogContent-root":{marginTop:e.spacing(2),marginBottom:e.spacing(3),marginRight:"auto",marginLeft:"auto"}},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1}})})),J=(null===(T=window.config)||void 0===T||null===(M=T.livemap)||void 0===M?void 0:M.center)||{lat:22.590965206150827,lng:88.33408749042945};const K=function(e){var t=e.trips,n=e.loading,o=e.totalCount,i=e.page,s=e.perPage,c=(e.orderBy,e.order,e.onSort),m=e.setParentPage,v=e.onFilterChange,h=((0,N.Z)(e,["trips","loading","totalCount","page","perPage","orderBy","order","onSort","setParentPage","onFilterChange"]),(0,p.useTranslation)().t),E=q(),Z=(0,I.Z)(),b=Z.showWarningMessage,S=Z.showErrorMessage,x=l.useState(!1),k=(0,r.Z)(x,2),C=k[0],O=k[1],W=l.useState(),D=(0,r.Z)(W,2),P=D[0],T=D[1],M=l.useState([]),F=(0,r.Z)(M,2),K=F[0],Q=F[1],Y=l.useState(J),$=(0,r.Z)(Y,2),ee=$[0],te=$[1],ne=l.useState([]),ae=(0,r.Z)(ne,2),re=ae[0],le=ae[1],oe=i>=1?i-1:1,ie=function(){T([]),Q([]),O(!1)},se=[{field:"tripId",headerName:h("tripId"),width:200,sortable:!1,filterable:!1},{field:"totalTasks",headerName:h("totalOrders"),flex:1,sortable:!1,filterable:!1},{field:"tripCreated",headerName:h("tripCreated"),flex:1,sortable:!1,filterable:!1},{field:"tripUpdated",headerName:h("tripUpdated"),sortable:!0,flex:1},{field:"status",headerName:h("status"),sortable:!0,flex:1},{field:"actions",headerName:h("actions"),sortable:!1,renderCell:function(e){return l.createElement("div",null,l.createElement(j.Z,{size:"small",color:"primary",variant:"text","aria-label":"trip action buttons"},l.createElement(V.ZP,{title:h("view")},l.createElement(L.Z,{color:"primary",component:d.Link,to:"/home/trip/trips/view/"+e.getValue("tripId")},l.createElement(G.Z,{fontSize:"small"}))),l.createElement(V.ZP,{title:h("map")},l.createElement(L.Z,{color:"primary",onClick:function(t){var n;O(!0),n=e.getValue("tripId"),(0,f.zO)(n).then((function(e){return{mapped:e.result.points.map((function(e){return{lat:e.point.lat,lng:e.point.lon}})),plannedRoutes:e.result.planned_routes}})).then((function(e){return function(e,t){T(e),Q(t),te(e[0])}(e.mapped,e.plannedRoutes)})).catch((function(e){b(h("noRouteFound"))})),(0,g.Ig)(n).then((function(e){if(0===e.resultCode){var t=e.posList.map((function(e){return{id:e.posId,status:e.status}})),n=e.warehouseList.map((function(e){return{id:e.warehouseId,status:e.status}})),r=e.collectorList.map((function(e){return{id:e.collectorId,status:e.status}}));return[].concat((0,a.Z)(t),(0,a.Z)(n),(0,a.Z)(r))}})).then((function(e){return(0,f.Ou)(e.map((function(e){return e.id})))})).then((function(e){le(e.markers)})).catch((function(e){return S(e.message||e.resultMessage||h("anErrorOccurred"))}))}},l.createElement(X.Z,{fontSize:"small"})))))},flex:1}];return l.createElement(l.Fragment,null,l.createElement(z.Z,{fullWidth:!0,maxWidth:"md",open:C,disableEnforceFocus:!0,onClose:ie,"aria-labelledby":"product-variant-dialog"},l.createElement(B.Z,{className:E.appBar},l.createElement(U.Z,null,l.createElement(A.Z,{edge:"start",color:"inherit",onClick:ie,"aria-label":"close"},l.createElement(_.Z,null,"close")),l.createElement(u.Z,{variant:"h6",className:E.title},h("tripRoute")))),l.createElement(H.Z,null,l.createElement(y.Z,{height:400,width:"100%",markers:re,center:ee},K&&K.length>0?K.map((function(e){var t;return l.createElement(w.aH,{options:{path:null===(t=e.routes[0])||void 0===t?void 0:t.overview_path,strokeColor:"blue",strokeWeight:7.5,strokeOpacity:.6,zIndex:1}})})):null,P&&P.length>0?l.createElement(w.aH,{options:{path:P,strokeColor:"#474a54",strokeWeight:7.5,strokeOpacity:.6,zIndex:100}}):null))),l.createElement("div",{style:{height:600,flex:1}},l.createElement(R(),{loading:n,columnBuffer:3,rows:t,onPageChange:function(e){m(e.page+1)},pagination:!0,paginationMode:"server",page:oe,pageSize:s,rowCount:o,onFilterModelChange:v,onSortModelChange:c,getRowId:function(e){return e.tripId},columns:se,disableColumnSelector:!0,disableDensitySelector:!0,disableSelectionOnClick:!0,disableColumnFilter:!0})))},Q=function(e){var t=e.agentId;return l.createElement(P,{agentId:t},(function(t){var n=t.trips,a=t.loading,r=t.totalCount,o=(t.setParentSelectedType,(0,N.Z)(t,["trips","loading","totalCount","setParentSelectedType"]));return l.createElement(l.Fragment,null,l.createElement(K,(0,C.Z)({},e,{trips:n,loading:a,totalCount:r},o)))}))};var Y,$,ee=n(773),te=(0,o.Z)((function(e){return(0,i.Z)({input:{padding:e.spacing(2)},fieldHeading:{fontWeight:"bold",textTransform:"capitalize",fontSize:18},element:{display:"flex",margin:e.spacing(1),border:"1px solid #EDEDED",borderRadius:"10px",background:"#F7F7F7",alignItems:"center",padding:"20px"},mainWrapper:{height:"100%",width:"100%"},buttonWrapper:{margin:15},idWrapper:{marginTop:5},tripHistoryWrapper:{marginLeft:15,fontWeight:"bold"}})})),ne=(null===(Y=window.config)||void 0===Y||null===($=Y.livemap)||void 0===$?void 0:$.center)||{lat:22.590965206150827,lng:88.33408749042945};const ae=function(){var e=(0,d.useRouteMatch)().params,t=(0,I.Z)(),n=t.showWarningMessage,o=t.showInfoMessage,i=(0,p.useTranslation)().t,v=l.useState(!1),h=(0,r.Z)(v,2),E=h[0],Z=h[1],b=l.useState(!1),y=(0,r.Z)(b,2),S=y[0],w=y[1],x=l.useState([]),C=(0,r.Z)(x,2),N=C[0],O=C[1],W=l.useState([]),D=(0,r.Z)(W,2),P=D[0],T=D[1],M=l.useState(),F=(0,r.Z)(M,2),R=F[0],B=F[1],L=l.useState([]),j=(0,r.Z)(L,2),z=j[0],H=j[1],_=l.useState([]),A=(0,r.Z)(_,2),U=A[0],V=A[1],G=l.useState(ne),X=(0,r.Z)(G,2),q=X[0],J=X[1],K=te();return l.useEffect((function(){e.agentId&&(Z(!0),(0,g.HH)(e.agentId).then((function(e){0===e.resultCode&&T(e);var t=e.posTripList.map((function(e){return{id:e.posId,status:e.status}})),n=e.warehouseTripList.map((function(e){return{id:e.warehouseId,status:e.status}})),r=e.collectorTripList.map((function(e){return{id:e.collectorId,status:e.status}})),l=[].concat((0,a.Z)(r),(0,a.Z)(t),(0,a.Z)(n));return V(l),l})).then((function(e){return(0,f.Ou)(e.map((function(e){return e.id})))})).then((function(e){O(e.markers)})).catch((function(e){w(!0),Z(!1),o(i("activeTripInfo"))})).finally((function(){return Z(!1)})))}),[e.agentId]),l.useEffect((function(){null!=P&&P.tripId&&(Z(!0),(0,f.zO)(null==P?void 0:P.tripId).then((function(e){return{mapped:e.result.points.map((function(e){return{lat:e.point.lat,lng:e.point.lon}})),plannedRoutes:e.result.planned_routes}})).then((function(e){var t=e.mapped;!function(e,t){B(e),H(t)}(t,e.plannedRoutes),J(t[0])})).catch((function(e){w(!0),Z(!1),n(i("activeRouteInfo"))})).finally((function(){return Z(!1)})))}),[P]),l.createElement("div",{className:(0,m.default)(K.mainWrapper)},l.createElement(c.Z,{container:!0,className:(0,m.default)(K.input),spacing:3},l.createElement(c.Z,{item:!0,xs:12,sm:3},l.createElement(u.Z,{color:"primary",className:(0,m.default)(K.fieldHeading)},i("agent")),l.createElement(u.Z,{variant:"caption",className:(0,m.default)(K.idWrapper)},i("id"),": ",e.agentId))),l.createElement(c.Z,{container:!0,spacing:2,className:K.input},l.createElement(k,{agentId:e.agentId,markers:N,error:S,loading:E,plannedRoutes:z,routes:R,widgets:U,center:q})),l.createElement(s.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-start"},l.createElement(u.Z,{variant:"body1",className:K.tripHistoryWrapper},i("tripHistory"))),l.createElement(c.Z,{container:!0,className:K.input},l.createElement(Q,{agentId:e.agentId})),l.createElement(ee.SeamlessButton,{type:"button",className:K.buttonWrapper,component:d.Link,to:"/home/livemap",variant:"contained",color:"primary"},i("back","Back")))}}}]);