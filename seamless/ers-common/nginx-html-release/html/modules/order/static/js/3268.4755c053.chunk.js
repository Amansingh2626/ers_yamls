(self.webpackChunk_unified_order=self.webpackChunk_unified_order||[]).push([[3268],{38636:(e,t,n)=>{"use strict";n.d(t,{a4:()=>o,$f:()=>a});var l=n(30781),r=n(99367);function o(e){return r.Z.cms("/v2/calculate-pricing",{method:"POST",body:e})}function a(e){return function(e){return r.Z.cms("/v2/fetch-product-range/".concat(e))}(e).then((function(e){return e.products})).then((function(e){return(0,l.WI)({variantIds:e})})).then((function(e){return e.productVariants}))}},13268:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Q});var l=n(51119),r=n(11746),o=n(74315),a=n(2411),i=n.n(a),u=n(60905),c=n(41262),d=n(4614),s=n(77277),m=n(8629),p=n(49429),v=n(38724),f=n(79249),y=n(90436),g=n(38636),E=n(61715),h=n(76635),Z=n(94339),b=n(24579),S=(0,n(79692).Z)((function(e){return{space:{paddingRight:10,fontWeight:600},table:{minWidth:500},stepper:{minWidth:500,minHeight:500,height:"auto",marginTop:10},border:{borderBottom:"1px solid grey"},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},additionalInfoWrapper:{color:"red",textAlign:"end",marginBottom:10}}})),x=function(e){var t,n=e.source,l=S();return i().createElement(Z.Z,{variant:"outlined",style:{flex:1,padding:5,marginRight:10}},i().createElement(b.Z,null,i().createElement(y.Z,{style:{marginBottom:10,fontWeight:"bold"}}," Stock From "),i().createElement(y.Z,{title:"Name"},i().createElement("span",{className:l.space},"Name:"),n.resellerName),i().createElement(y.Z,{title:"Reseller ID"},i().createElement("span",{className:l.space},"Reseller ID:"),n.resellerId),i().createElement(y.Z,{title:"MSISDN"},i().createElement("span",{className:l.space},"Reseller MSISDN:"),n.resellerMSISDN),n.pickupLocation&&(null===(t=n.pickupLocation)||void 0===t?void 0:t.length)>0&&i().createElement(y.Z,{title:"Pickup Location"},i().createElement("span",{className:l.space},"Pickup Location"),n.pickupLocation[0].resellerId)))},N=function(e){var t,n=e.destination,l=S();return i().createElement(Z.Z,{variant:"outlined",style:{flex:1,padding:5,marginLeft:10}},i().createElement(b.Z,null,i().createElement(y.Z,{style:{marginBottom:10,fontWeight:"bold"}}," Stock To "),i().createElement(y.Z,{title:"Name"},i().createElement("span",{className:l.space},"Name:"),n.resellerName),i().createElement(y.Z,{title:"Reseller ID"},i().createElement("span",{className:l.space},"Reseller ID:"),n.resellerId),i().createElement(y.Z,{title:"Reseller MSISDN"},i().createElement("span",{className:l.space},"Reseller MSISDN:"),n.resellerMSISDN),n.dropLocation&&(null===(t=n.dropLocation)||void 0===t?void 0:t.length)>0&&i().createElement(y.Z,{title:"Drop Location"},i().createElement("span",{className:l.space},"Drop Location"),n.dropLocation[0].resellerId)))},w=n(97485),T=n(15584),I=n(91256),P=n(58987),O=n(89571),k=n(33553),D=n(37390),j=n(80030),A=n(75696),R=n(64659),C=n(4730),U=n(24235);function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var L=function(){function e(t,n,r,o){(0,R.Z)(this,e),(0,l.Z)(this,"lineItems",void 0),(0,l.Z)(this,"taxList",void 0),(0,l.Z)(this,"products",[]),(0,l.Z)(this,"discount",null),this.lineItems=t,this.taxList=n,this.products=r,this.discount=o}return(0,C.Z)(e,[{key:"getTax",value:function(e){return this.taxList.find((function(t){return t.id===e}))}},{key:"getNetAmount",value:function(e){var t;return e.amount?e.amount:e.price?e.price*e.quantity:(null===(t=(0,U.CH)(this.products,e.productSKU))||void 0===t?void 0:t.price)*e.quantity}},{key:"getTaxes",value:function(e){var t=this,n=(0,U.br)(this.products,this.taxList,e.productSKU);return 0===n.length?[{name:"N/A",amount:0,description:"Not applicable"}]:n.map((function(n){var l=0===n.percentValue?"".concat(n.fixedValue," "):"".concat(n.percentValue," %");return{name:"".concat(n.taxType," ").concat(l),amount:t.calculateTax(e,n),description:n.description}}))}},{key:"calculateTax",value:function(e,t){var n=this.getNetAmount(e);return 0!==t.percentValue?n*t.percentValue/100:t.fixedValue}},{key:"getPostTaxAmount",value:function(e){var t=this.getTaxes(e).reduce((function(e,t){return e+t.amount}),0);return this.getNetAmount(e)+t}},{key:"totalCalucaltion",get:function(){var e=this.rows,t=e.reduce((function(e,t){return e+t.taxes.reduce((function(e,t){return e+t.amount}),0)}),0),n=e.reduce((function(e,t){return e+t.netAmount}),0),l=e.reduce((function(e,t){return e+t.quantity}),0);return{totalAmount:e.reduce((function(e,t){return e+t.postTaxAmount}),0)+this.discount,totalTax:t,subTotal:n,totalQuantity:l,totalDiscount:this.discount}}},{key:"rows",get:function(){var e=this;return this.lineItems.map((function(t){return K(K({},t),{},{taxes:e.getTaxes(t),netAmount:e.getNetAmount(t),postTaxAmount:e.getPostTaxAmount(t)})}))}}]),e}(),q=n(63135),B=(0,A.makeStyles)((function(e){return(0,A.createStyles)({container:{},table:{minWidth:650},tableBody:{"& td":{border:".8px solid #d3d3d369"}},tableHead:{backgroundColor:"#607d8b;","& th":{color:"white","text-align":"center",border:".8px solid #d3d3d369"}},tableHeadRowCell:{color:"white"},totalTitles:{fontWeight:"bold"}})}));const W=function(e){var t,n,l,r,o,u,c,d,s,m,p,v,f,y,g,E,h,Z,b=e.paymentInfo,S=void 0!==b&&b,x=e.taxes,N=void 0===x?[]:x,A=e.itemRows,R=void 0===A?[]:A,C=e.products,U=void 0===C?[]:C,F=e.discount,K=void 0===F?0:F,W=e.dispatch,M=e.data1,_=e.newItemRows,V=B(),H=(0,q.useTranslation)().t,z=new L(R,N,U,K).totalCalucaltion;return(0,a.useEffect)((function(){var e;S&&W&&W({type:"total_amount",payload:{key:"invoiceAmount",value:_?null==_||null===(e=_.dueAmount)||void 0===e?void 0:e.amount:z.totalAmount}})}),[_]),i().createElement(I.Z,{component:k.Z,className:V.container},i().createElement(D.Z,{className:V.table,size:"medium","aria-label":"a dense table"},i().createElement(P.Z,{className:V.tableHead},i().createElement(O.Z,null,i().createElement(T.Z,null,H("srNo")),i().createElement(T.Z,null,H("productSku")),i().createElement(T.Z,null,H("productName")),S&&i().createElement(T.Z,null,H("price")),"ISO_DST"===(null==M?void 0:M.orderType)?i().createElement(T.Z,null,H("amount")):i().createElement(T.Z,null,H("quantity")),S?i().createElement(i().Fragment,null,i().createElement(T.Z,null,H("netAmount")),i().createElement(T.Z,null,H("discountAmount")),i().createElement(T.Z,null,H("tax")),i().createElement(T.Z,null,H("taxAmount")),i().createElement(T.Z,null,H("payableAmountForOrder"))):null)),i().createElement(w.Z,{className:V.tableBody},_?null==_||null===(t=_.invoiceEntryList)||void 0===t?void 0:t.map((function(e,t){var n,l,r,o,a,u,c,d,s,m,p,v,f,y,g,E,h,Z,b;return i().createElement(O.Z,{key:t},i().createElement(T.Z,{width:30}," ",t+1),i().createElement(T.Z,{width:230},null==e?void 0:e.productSKU),i().createElement(T.Z,{width:230},null==e?void 0:e.productName),S&&i().createElement(T.Z,{width:100,align:"right"},null==e||null===(n=e.unitPrice)||void 0===n?void 0:n.amount," ",null==e||null===(l=e.unitPrice)||void 0===l?void 0:l.currency),i().createElement(T.Z,{width:100,align:"right"},e&&null!=e&&e.uom?null==e||null===(r=e.uom)||void 0===r?void 0:r.quantity:null!=e&&e.quantity?null==e?void 0:e.quantity:((null==e||null===(o=e.totalPrice)||void 0===o?void 0:o.amount)/(null==e||null===(a=e.unitPrice)||void 0===a?void 0:a.amount)).toFixed()),S?i().createElement(i().Fragment,null,i().createElement(T.Z,{width:250,align:"right"},null==e||null===(u=e.totalPrice)||void 0===u?void 0:u.amount," ",null==e||null===(c=e.totalPrice)||void 0===c?void 0:c.currency),i().createElement(T.Z,{width:250,align:"right"},null==e||null===(d=e.discount)||void 0===d?void 0:d.amount," ",null==e||null===(s=e.discount)||void 0===s?void 0:s.currency),i().createElement(T.Z,{width:130,align:"center"},i().createElement("section",null,(null==e||null===(m=e.taxDetails)||void 0===m?void 0:m.length)>0?null==e||null===(p=e.taxDetails)||void 0===p?void 0:p.map((function(t,n){return i().createElement("div",{key:n,title:t.taxType,style:{padding:5,borderBottom:1===e.taxDetails.length?"unset":".2px solid lightgrey"}},i().createElement(j.ZP,{title:null==t?void 0:t.taxType},i().createElement("span",null,null==t?void 0:t.taxType," ",null==t?void 0:t.percentValue,"%")))})):"0")),i().createElement(T.Z,{width:130,align:"right"},e&&null!=e&&e.calculatedTax&&null!=e&&null!==(v=e.calculatedTax)&&void 0!==v&&v.amount?(null===(f=Number.parseFloat(null==e||null===(y=e.calculatedTax)||void 0===y||null===(g=y.amount)||void 0===g?void 0:g.toString()))||void 0===f?void 0:f.toFixed(4))+" "+(null==e||null===(E=e.calculatedTax)||void 0===E?void 0:E.currency):"0 "+(null==e||null===(h=e.calculatedTax)||void 0===h?void 0:h.currency)),i().createElement(T.Z,{align:"right",width:250},null==e||null===(Z=e.netPrice)||void 0===Z?void 0:Z.amount," ",null==e||null===(b=e.netPrice)||void 0===b?void 0:b.currency)):null)})):"",_&&S&&i().createElement(i().Fragment,null,i().createElement(O.Z,null,i().createElement(T.Z,{rowSpan:4}),i().createElement(T.Z,{rowSpan:4}),i().createElement(T.Z,{rowSpan:4}),i().createElement(T.Z,{rowSpan:4}),i().createElement(T.Z,{rowSpan:4}),i().createElement(T.Z,{rowSpan:4}),i().createElement(T.Z,{colSpan:2,className:V.totalTitles},H("subtotal")),i().createElement(T.Z,{align:"right",className:V.totalTitles},_&&null!=_&&_.totalPrice&&null!=_&&null!==(n=_.totalPrice)&&void 0!==n&&n.amount?(null===(l=Number.parseFloat(null==_||null===(r=_.totalPrice)||void 0===r||null===(o=r.amount)||void 0===o?void 0:o.toString()))||void 0===l?void 0:l.toFixed(4))+" "+(null==_||null===(u=_.totalPrice)||void 0===u?void 0:u.currency):"")),_&&_.totalDiscount&&_.totalDiscount.amount?i().createElement(O.Z,null,i().createElement(T.Z,{colSpan:2,className:V.totalTitles},H("discountMargin")),i().createElement(T.Z,{style:{backgroundColor:"rgb(33 178 39 / 26%)"},align:"right",className:V.totalTitles},null==_||null===(c=_.totalDiscount)||void 0===c?void 0:c.amount," ",null==_||null===(d=_.totalDiscount)||void 0===d?void 0:d.currency)):null,i().createElement(O.Z,null,i().createElement(T.Z,{colSpan:2,className:V.totalTitles},H("tax")),i().createElement(T.Z,{align:"right",className:V.totalTitles},_&&null!=_&&_.totalTax&&null!=_&&null!==(s=_.totalTax)&&void 0!==s&&s.amount?(null===(m=Number.parseFloat(null==_||null===(p=_.totalTax)||void 0===p||null===(v=p.amount)||void 0===v?void 0:v.toString()))||void 0===m?void 0:m.toFixed(4))+" "+(null==_||null===(f=_.totalTax)||void 0===f?void 0:f.currency):"")),i().createElement(O.Z,null,i().createElement(T.Z,{colSpan:2,className:V.totalTitles},H("totalAmountForOrder")),i().createElement(T.Z,{align:"right",className:V.totalTitles},_&&null!=_&&_.totalNetPrice&&null!=_&&null!==(y=_.totalNetPrice)&&void 0!==y&&y.amount?(null===(g=Number.parseFloat(null==_||null===(E=_.totalNetPrice)||void 0===E||null===(h=E.amount)||void 0===h?void 0:h.toString()))||void 0===g?void 0:g.toFixed(4))+" "+(null==_||null===(Z=_.totalNetPrice)||void 0===Z?void 0:Z.currency):""))))))};var M=n(29e3),_=n(29971),V=n(23664);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Q=function(e){var t,n,l,Z,b,w,T,I,P,O,k,D,j,A,R,C,F,K,L,B,H,Q=e.dataAPI,Y=e.state,$=e.from,G=e.to,J=e.paymentInfo,X=void 0!==J&&J,ee=e.itemList,te=e.dispatch,ne=e.setDisableSubmit,le=S(),re=(0,a.useState)(!1),oe=(0,o.Z)(re,2),ae=oe[0],ie=oe[1],ue=(0,a.useState)(null),ce=(0,o.Z)(ue,2),de=ce[0],se=ce[1],me=(0,a.useState)(!1),pe=(0,o.Z)(me,2),ve=pe[0],fe=pe[1],ye=(0,q.useTranslation)().t,ge=(0,a.useState)(!1),Ee=(0,o.Z)(ge,2),he=Ee[0],Ze=Ee[1],be=(0,a.useState)([]),Se=(0,o.Z)(be,2),xe=Se[0],Ne=Se[1],we=(0,a.useState)(),Te=(0,o.Z)(we,2),Ie=Te[0],Pe=Te[1],Oe=(0,V.Z)().showErrorMessage,ke=(0,a.useState)(),De=(0,o.Z)(ke,2),je=De[0],Ae=De[1],Re=["SO","PO","IPO_D","IPO","ISO"],Ce=(null===(t=window)||void 0===t||null===(n=t.config)||void 0===n||null===(l=n.order)||void 0===l?void 0:l.erpBalanceResellerTypesId)||["hq","hq_mpesa"],Ue=(null===(Z=window)||void 0===Z||null===(b=Z.config)||void 0===b||null===(w=b.order)||void 0===w?void 0:w.showERPBalancePaymentMode)||["ERP"],Fe=null!==(T=null===(I=window)||void 0===I||null===(P=I.config)||void 0===P||null===(O=P.order)||void 0===O?void 0:O.showERPBalance)&&void 0!==T&&T,Ke=(null===(k=window)||void 0===k||null===(D=k.config)||void 0===D||null===(j=D.order)||void 0===j?void 0:j.showERPShowableOrder)||["PO","IPO_D"],Le=(0,_.useSelector)((function(e){return e.auth})).user;function qe(e){var t;return null===(t=(0,U.CH)(Y.products,e))||void 0===t?void 0:t.price}function Be(){var e=Y.selectedByRange,t=Y.stockRows,n=Y.stockQuantity,l=Y.products;if(ee&&ee.length>0)return ee.forEach((function(e){l&&l.length>0&&l.forEach((function(t){e.productSKU==t.variant.productSKU&&(e.productName=t.product.name)}))})),ee;var o=Y.serials,a=e.concat(t);n.forEach((function(e){l&&l.length>0&&l.forEach((function(t){e.productSKU==t.variant.productSKU&&(e.productName=t.product.name)}))}));var i=n.map((function(e){return{productSKU:e.productSKU,quantity:e.quantity,boxId:"-",reserverType:e.reserveType,productName:e.productName}}));a.forEach((function(e){l.forEach((function(t){e.productSKU==t.variant.productSKU&&(e.productName=t.product.name)}))}));var u,c,d=a.map((function(e){var t;return{productSKU:e.productSKU,quantity:parseInt(e.quantity,10),boxId:e.boxId,price:null===(t=e.unitPrice)||void 0===t?void 0:t.price,productName:e.productName}})),s=Object.keys(o).map((function(e){var t=l.filter((function(t){if(t.variant.productSKU==e)return t}));return Object.keys(o[e]).map((function(n){return{productSKU:e,quantity:o[e][n].length,boxId:n,price:qe(e),productName:t.length>0?t[0].product.name:""}}))})).flat(),m=(u=Y.services.topups,c=(0,h.groupBy)(u,"productSKU"),Object.keys(c).map((function(e){var t=l.filter((function(t){if(t.variant.productSKU==e)return t}));return{productSKU:e,quantity:c[e].length,boxId:"-",reserverType:"TOPUP",amount:c[e].reduce((function(e,t){return e+parseInt(t.amount)}),0),productName:t.length>0?t[0].product.name:""}})));return[].concat((0,r.Z)(d),(0,r.Z)(s),(0,r.Z)(i),(0,r.Z)(m))}function We(e){if(e.amount)return e.amount;var t=qe(e.productSKU);return Number(t)*Number(e.quantity)}return Le&&null!==(A=Le.info)&&void 0!==A&&A.resellerData&&(C=null===(F=Le.info.resellerData)||void 0===F?void 0:F.resellerTypeId,R=null===(K=Le.info.resellerData)||void 0===K?void 0:K.resellerId,null===(L=Le.info.resellerData)||void 0===L||L.resellerMSISDN),(0,a.useEffect)((function(){var e,t,n,l=null===(e=window)||void 0===e||null===(t=e.config)||void 0===t||null===(n=t.order)||void 0===n?void 0:n.addtionalInformation;if(l){fe(l.enabled&&l.fields.map((function(e){return e.orderType})).flat().includes(Y.orderType));var r=(l.fields.filter((function(e){var t;return null===(t=e.orderType)||void 0===t?void 0:t.includes(Y.orderType)}))||[]).map((function(e){var t=Y.additionalFields.filter((function(t){return t.key==e.key}));return t.length>0&&""!==t[0].value?z(z({},e),{},{value:t[0].value}):e}));Ne(r)}}),[Y.orderType]),(0,a.useEffect)((function(){var e,t,n;if(Re.includes(Y.orderType)?(ie(!0),(0,E.xO)(Q).then((function(e){0===e.resultCode?(ne&&ne(!1),Pe(e.invoices&&e.invoices.length?e.invoices[0]:[])):(ne&&ne(!0),Oe(e.resultMessage))})).catch((function(e){ie(!1)})).finally((function(){return ie(!1)}))):X&&(ie(!0),(0,g.a4)((e=ee&&ee.length>0?ee:Be(),t=null==e?void 0:e.map((function(e){return{itemCount:e.quantity,productSku:e.productSKU,receiver:G.resellerId,receiverWallet:"",requestedAmount:We(e),sender:$.resellerId,senderWallet:""}})),n=(0,h.map)((0,h.groupBy)(t,"productSku"),(function(e,t){return(0,h.reduce)(e,(function(e,t){for(var n in t)e[n]="itemCount"===n||"requestedAmount"===n?(e[n]||0)+t[n]:t[n];return e}),{productSku:t})})),{products:(0,r.Z)(n),profileId:"",referenceNumber:""})).then((function(e){if(1!==e.resultCode&&0===e.resultCode){var t,n=null===(t=e.products.map((function(e){var t;return{discount:null===(t=e.transactionRows.find((function(e){return"DISCOUNT"===e.tag})))||void 0===t?void 0:t.amount}})))||void 0===t?void 0:t.filter((function(e){return void 0!==e.discount})).reduce((function(e,t){return e+t.discount}),0);se(n)}})).catch((function(e){ie(!1)})).finally((function(){return ie(!1)}))),Ce.includes(C)&&Ue.includes(Y.paymentMode)&&Ke.includes(Y.orderType)){var l={dealerCode:R};(0,E.Y7)(l).then((function(e){0===e.resultCode&&Ae(e)})).catch((function(e){ie(!1)})).finally((function(){return ie(!1)}))}}),[X]),i().createElement(i().Fragment,null,i().createElement(c.Z,{className:le.backdrop,open:ae},i().createElement(d.Z,{color:"inherit"})),ve&&i().createElement("section",{style:{overflow:"hidden",marginBottom:15}},i().createElement(y.Z,{className:le.additionalInfoWrapper},ye("additionalInformationWarning")),i().createElement(s.Z,{variant:"outlined",color:"primary",onClick:function(){return Ze(!0)},style:{float:"right"}},ye("additionalInformation"))),i().createElement("section",null,je&&Fe&&i().createElement(i().Fragment,null,i().createElement(u.Z,{style:{display:"flex"}},i().createElement("p",{style:{marginTop:"-40px",marginLeft:"2px",fontWeight:700,fontSize:"15px"}},"ERP Balance:"),i().createElement("span",{style:{marginTop:"-40px",marginLeft:"10px",fontSize:"15px"}},null==je?void 0:je.availableBalance)))),he&&i().createElement(i().Fragment,null,i().createElement(m.Z,{open:!0,scroll:"body",fullWidth:!0,maxWidth:"sm",disableBackdropClick:!0},i().createElement(f.Z,{id:"scroll-dialog-title"},ye("additionalInformation","Additional Information")),i().createElement(v.Z,{dividers:!0},i().createElement(M.Z,{data:xe,setData:Ne})),i().createElement(p.Z,null,i().createElement(s.Z,{onClick:function(){return Ze(!1)}},ye("cancel","Cancel")),i().createElement(s.Z,{color:"primary",variant:"contained",onClick:function(){if(te){var e=Y.additionalFields.filter((function(e){return"invoiceAmount"===e.key})).concat((0,r.Z)(xe));te({type:"set_addtional_info",payload:e})}Ze(!1)}},ye("submit","Submit"))))),i().createElement("section",{style:{marginTop:10}},i().createElement(u.Z,{container:!0,justify:"space-between"},i().createElement(x,{source:$}),i().createElement(N,{destination:G}))),i().createElement("div",{className:le.stepper},i().createElement(W,{data1:Q,itemRows:Be(),taxes:Y.taxes,products:Y.products,paymentInfo:X,discount:de,dispatch:te,newItemRows:(B=Ie,H={invoiceEntryList:Be()},Re.includes(Y.orderType)?B:H)})))}}}]);