(self.webpackChunk_unified_survey=self.webpackChunk_unified_survey||[]).push([[4215],{4215:(e,r,n)=>{"use strict";n.r(r),n.d(r,{default:()=>A});var t=n(773),a=n(2411),o=n.n(a),s=n(9609),l=n(6470),i=n(1746),u=n(1119),c=n(4315),d=n(7162),m=n.n(d),f=n(8049),v=n(1120),p=n(5117),g=n(2318),h=n(282),y=n(8670);var w=n(5072),x=n(1749),Z=n(6277),b=n(5167),q=n(3258),E=n(4436),I=n(553),k=n(6562),S=n(585),O=n(6019),K=n(8662),N=n(2541),C=n(484),D=(0,v.Z)((function(e){return(0,p.Z)({textBoxWidth:{width:500},text:{marginBottom:e.spacing(1)},image:{marginBottom:e.spacing(2),marginLeft:e.spacing(3)},margins:{marginTop:e.spacing(2)},rowSpace:{marginLeft:e.spacing(1),justifyContent:"center"},testStyle:{"& textarea":{padding:"auto!important",height:"100px !important",resize:"both"}}})}));const M=function(e){var r,n,a,l,u,c,d,m,f,v,p,y,w,M,T,B,j,V,R,A=e.type,F=e.options,P=e.name,L=e.className,W=e.data,z=e.id,_=e.answers,U=e.onRadioChange,$=e.handleTextChange,H=e.handleCheckBoxChange,Q=e.handleDropdownChange,Y=e.handleImageChange,G=e.handleDecimalChange,J=e.onImageDelete,X=D(),ee=(0,s.useTranslation)().t,re="dropdown"===A?F.map((function(e){return{key:e.value,value:e.key}})):[];switch(A){case"short_answer":return o().createElement(t.SeamlessInput,{fullWidth:!0,error:W.required&&(null===(r=_[z])||void 0===r?void 0:r.error),label:P,name:"".concat(z),required:W.required,helperText:null!==(n=_[z])&&void 0!==n&&n.error?W.errorMessage:W.helperText,className:(0,Z.default)(L,X.textBoxWidth),value:_[z].textAnswer,inputProps:{maxLength:(null==W||null===(a=W.extraInfo)||void 0===a?void 0:a.maxLength)||100},onChange:function(e){$(e,z)}});case"paragraph":return o().createElement(t.SeamlessInput,{error:W.required&&(null===(l=_[z])||void 0===l?void 0:l.error),name:"".concat(z),fullWidth:!0,helperText:null!==(u=_[z])&&void 0!==u&&u.error?W.errorMessage:W.helperText,required:W.required,label:P,multiline:!0,inputProps:{maxLength:(null==W||null===(c=W.extraInfo)||void 0===c?void 0:c.maxLength)||1e8},inputClassName:X.testStyle,className:(0,Z.default)(L,X.textBoxWidth),value:null===(d=_[z])||void 0===d?void 0:d.textAnswer,onChange:function(e){return $(e,z)}});case"checkbox":return o().createElement(E.Z,{component:"fieldset",name:"".concat(z),className:L,required:W.required,error:W.required&&(null===(m=_[z])||void 0===m?void 0:m.error)},o().createElement(O.Z,{component:"legend"},P),o().createElement(k.Z,null,null==F?void 0:F.map((function(e,r){return o().createElement(I.Z,{label:null==e?void 0:e.value,key:e.key,control:o().createElement(q.Z,{name:null==e?void 0:e.key,value:null==e?void 0:e.value,checked:_[z].answerKeys.indexOf(e.key)>=0,onChange:function(){return H(null==e?void 0:e.key,null==e?void 0:e.value,z)}})})}))),o().createElement(S.Z,null,_[z].error?_[z].errorMessage:W.helperText));case"dropdown":return o().createElement(t.SeamlessDropDown,{name:"".concat(z),fullWidth:!0,required:W.required,label:P,className:(0,Z.default)(L,X.textBoxWidth),options:[{key:ee("select"),value:" "}].concat((0,i.Z)(re)),value:_[z].answerKeys[0],error:W.required&&(null===(f=_[z])||void 0===f?void 0:f.error),onChange:function(e){Q(e,z,F)},helperText:null!==(v=_[z])&&void 0!==v&&v.error?_[z].errorMessage:W.helperText});case"radio_button":return o().createElement(E.Z,{component:"fieldset",name:"".concat(z),className:L,required:W.required,error:W.required&&(null===(p=_[z])||void 0===p?void 0:p.error)},o().createElement(O.Z,{component:"legend"},P),o().createElement(N.Z,null,null==F?void 0:F.map((function(e,r){return o().createElement(I.Z,{key:e.key,checked:_[z].answerKeys[0]===e.key,onChange:function(){return U(e.key,e.value,z)},value:_[z].answerKeys[0],control:o().createElement(K.Z,null),label:null==e?void 0:e.value})}))),o().createElement(S.Z,null,null!==(y=_[z])&&void 0!==y&&y.error?_[z].errorMessage:W.helperText));case"decimal":return o().createElement(t.SeamlessInput,{name:"".concat(z),required:W.required,className:(0,Z.default)(L,X.textBoxWidth),fullWidth:!0,helperText:null!==(w=_[z])&&void 0!==w&&w.error?null===(M=_[z])||void 0===M?void 0:M.errorMessage:W.helperText,label:P,type:"number",error:W.required&&(null===(T=_[z])||void 0===T?void 0:T.error),value:null===(B=_[z])||void 0===B?void 0:B.textAnswer,onChange:function(e){var r;return G(e,z,null==W||null===(r=W.extraInfo)||void 0===r?void 0:r.maxLength)},inputProps:{max:Math.pow(10,(null==W||null===(j=W.extraInfo)||void 0===j?void 0:j.maxLength)||10)-1}});case"image":return o().createElement(o().Fragment,null,o().createElement(E.Z,{component:"fieldset",name:"".concat(z),className:L,required:W.required,error:null===(V=_[z])||void 0===V?void 0:V.error},o().createElement(O.Z,{component:"legend"},P),o().createElement("input",{accept:"image/*",disabled:_[z].answerKeys.length===W.extraInfo.noOfImage,type:"file",id:"select-image"+z,style:{display:"none"},onChange:function(e){return Y(e,z,W.extraInfo.noOfImage,W.extraInfo.maxSizeMB)},"input-props":{maxSize:W.extraInfo.maxSizeMB}}),o().createElement("label",{htmlFor:"select-image"+z},o().createElement(h.Z,{variant:"outlined",color:"primary",component:"span",className:X.margins,disabled:_[z].answerKeys.length===W.extraInfo.noOfImage},"Upload Image")),o().createElement(S.Z,null,null!==(R=_[z])&&void 0!==R&&R.error?_[z].errorMessage:W.helperText),_[z].answerValues.length>0&&o().createElement(b.Z,{mt:2},o().createElement(g.Z,{variant:"subtitle2",className:X.text},"Image Preview"),o().createElement(x.Z,{container:!0},_[z].answerValues.map((function(e){return o().createElement(x.Z,{item:!0,key:e,className:X.image},o().createElement(x.Z,{container:!0},o().createElement(x.Z,{item:!0,className:X.rowSpace},o().createElement("img",{src:e,alt:"image",height:"150px",width:"200px"})),o().createElement(x.Z,{item:!0},o().createElement(h.Z,{className:X.rowSpace,onClick:function(){return J(e,z)}},o().createElement(C.Z,{fontSize:"small"})))))}))))));default:return null}};var T=n(3664);function B(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function j(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?B(Object(n),!0).forEach((function(r){(0,u.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var V=(0,v.Z)((function(e){return(0,p.Z)({buttonSpacing:{marginTop:e.spacing(5)},rowSpacing:{marginBottom:e.spacing(4)},title:{fontWeight:600,marginTop:e.spacing(1),marginBottom:e.spacing(2)},desc:{color:"#B4B4B4",fontSize:13},subHeading:{fontWeight:600,marginRight:20}})}));const R=function(){var e=V(),r=(0,s.useTranslation)().t,n=(0,f.useHistory)(),t=((0,y.useSelector)((function(e){return e.auth}),y.shallowEqual).user,(0,f.useParams)().docId),a=o().useState(!1),d=(0,c.Z)(a,2),v=(d[0],d[1]),p=o().useState({}),Z=(0,c.Z)(p,2),b=Z[0],q=Z[1],E=o().useState([]),I=(0,c.Z)(E,2),k=I[0],S=I[1],O=o().useState({}),K=(0,c.Z)(O,2),N=K[0],C=K[1],D=(0,T.Z)(),B=D.showErrorMessage,R=D.showSuccessMessage,A=o().useState(!1),F=(0,c.Z)(A,2),P=F[0],L=F[1],W=o().useState(!1),z=(0,c.Z)(W,2),_=z[0],U=z[1],$=o().useState(""),H=(0,c.Z)($,2),Q=H[0],Y=H[1],G=o().useState(""),J=(0,c.Z)(G,2),X=J[0],ee=J[1],re=o().useState(""),ne=(0,c.Z)(re,2),te=ne[0],ae=ne[1],oe=o().useState(""),se=(0,c.Z)(oe,2),le=se[0],ie=se[1];o().useEffect((function(){(0,w.cQ)(t).then((function(e){0===e.resultCode?(ee(e.surveyDocumentInfo.surveyor),Y(e.surveyDocumentInfo.surveyee),ie(e.surveyDocumentInfo.tripId),ae(e.surveyDocumentInfo.surveyId)):(B(e.resultDescription),n.push("/home/survey/submit-survey"))})).catch((function(e){B(e.resultMessage),n.push("/home/survey/submit-survey")})).finally((function(){return v(!1)}))}),[]),o().useEffect((function(){te&&(v(!0),(0,w.z$)(te).then((function(e){if(0===e.resultCode){var t,a,o,s,l=null==e||null===(t=e.surveyDetails)||void 0===t||null===(a=t.template)||void 0===a?void 0:a.value;q(null==e?void 0:e.surveyDetails),S(null==e||null===(o=e.surveyDetails)||void 0===o||null===(s=o.template)||void 0===s?void 0:s.value);var i=function(){for(var e={},n=1,t=0;t<l.length;t++)for(var a=0;a<l[t].questions.length;a++){var o,s,i,u,c,d,m,f,v,p,g,h,y,w,x,Z,b,q,E,I,k,S;e[null===(o=l[t])||void 0===o?void 0:o.questions[a].id]={index:"autopick"===(null===(s=l[t])||void 0===s||null===(i=s.questions[a].data)||void 0===i?void 0:i.fieldNature)?0:n,questionId:null===(u=l[t])||void 0===u?void 0:u.questions[a].id,fieldNature:null===(c=l[t])||void 0===c||null===(d=c.questions[a].data)||void 0===d?void 0:d.fieldNature,scorable:null===(m=l[t])||void 0===m||null===(f=m.questions[a].data)||void 0===f?void 0:f.scorable,answerKeys:[],answerValues:[],required:null===(v=l[t])||void 0===v||null===(p=v.questions[a].data)||void 0===p?void 0:p.required,type:null===(g=l[t])||void 0===g||null===(h=g.questions[a].data)||void 0===h?void 0:h.type,error:!1,fileNames:[],noOfImages:(null===(y=l[t])||void 0===y||null===(w=y.questions[a].data)||void 0===w||null===(x=w.extraInfo)||void 0===x?void 0:x.noOfImage)||0,maxLength:(null===(Z=l[t])||void 0===Z||null===(b=Z.questions[a].data)||void 0===b||null===(q=b.extraInfo)||void 0===q?void 0:q.maxLength)||0,textAnswer:(null===(E=l[t])||void 0===E||null===(I=E.questions[a].data)||void 0===I?void 0:I.defaultValue)||"",errorMessage:r("thisFieldIsRequired")},"autopick"!==(null===(k=l[t])||void 0===k||null===(S=k.questions[a].data)||void 0===S?void 0:S.fieldNature)&&n++}return e}();C(i)}else B(e.resultDescription),n.push("/home/survey/submit-survey")})).catch((function(e){B(e.resultMessage),n.push("/home/survey/submit-survey")})).finally((function(){return v(!1)})))}),[te]);var ue=function(e,r){var n=N[r];n.textAnswer=e.target.value,n.required&&""===n.textAnswer?n.error=!0:n.error=!1,C((function(e){return j(j({},e),{},(0,u.Z)({},r,n))}))},ce=function(e,n,t){var a=N[n],o=new RegExp("^(?!$)\\d{0,"+t+"}(?:\\.\\d{1,2})?$");a.required&&""===e.target.value?(a.error=!0,a.errorMessage=r("thisFieldIsRequired")):!1===o.test(e.target.value)?(a.error=!0,a.errorMessage=r("maximumNoOfDigitsBeforeDecimal:")+t+" "+r("afterDecimal2")):a.error=!1,a.textAnswer=e.target.value,C((function(e){return j(j({},e),{},(0,u.Z)({},n,a))}))},de=function(e,r,n){var t=N[n];t.answerKeys[0]=e,t.answerValues[0]=r,t.required&&0===t.answerKeys.length?t.error=!0:t.error=!1,C((function(e){return j(j({},e),{},(0,u.Z)({},n,t))}))},me=function(e,r,n){var t=N[n],a=t.answerKeys,o=t.answerValues;a.indexOf(e)>=0?(t.answerKeys=a.filter((function(r){return r!==e})),t.answerValues=o.filter((function(e){return e!==r}))):(t.answerKeys=[].concat((0,i.Z)(a),[e]),t.answerValues=[].concat((0,i.Z)(o),[r])),t.required&&0===t.answerKeys.length?t.error=!0:t.error=!1,C((function(e){return j(j({},e),{},(0,u.Z)({},n,t))}))},fe=function(e,r,n){var t=N[r];t.answerKeys[0]=e.target.value,t.answerValues[0]=n.filter((function(r){return r.key===e.target.value}))[0].value,t.required&&0===t.answerKeys.length?t.error=!0:t.error=!1,C((function(e){return j(j({},e),{},(0,u.Z)({},r,t))}))},ve=function(e,n,t,a){var o=N[n];0!==e.target.files.length&&(e.target.files[0].size/1048576>a?B(r("theImageSizeShouldNotExceed")+a+" MB"):(o.answerKeys.length<t&&(o.answerKeys=[].concat((0,i.Z)(o.answerKeys),[e.target.files[0]]),o.fileNames=[].concat((0,i.Z)(o.fileNames),[e.target.files[0].name]),o.answerValues=[].concat((0,i.Z)(o.answerValues),[URL.createObjectURL(e.target.files[0])])),o.required&&0===o.answerKeys.length?(o.error=!0,o.errorMessage=r("thisFieldIsRequired")):0!==o.answerKeys.length&&o.answerKeys.length!==o.noOfImages?(o.error=!0,o.errorMessage=o.noOfImages+" "+r("imagesRequired")):o.error=!1,C((function(e){return j(j({},e),{},(0,u.Z)({},n,o))}))))},pe=function(e,n){var t=N[n],a=t.answerValues.indexOf(e);t.answerValues=t.answerValues.filter((function(r){return r!==e})),t.answerKeys=t.answerKeys.filter((function(e,r){return r!==a})),t.fileNames=t.fileNames.filter((function(e,r){return r!==a})),t.required&&0===t.answerKeys.length?(t.error=!0,t.errorMessage=r("thisFieldIsRequired")):0!==t.answerKeys.length&&t.answerKeys.length!==t.noOfImages?(t.error=!0,t.errorMessage=t.noOfImages+" "+r("imagesRequired")):t.error=!1,C((function(e){return j(j({},e),{},(0,u.Z)({},n,t))}))},ge=function(e){for(var r=function(r){var n=N[e[r]];"short_answer"===n.type||"paragraph"===n.type||"decimal"===n.type?n.required&&""===n.textAnswer?n.error=!0:n.error=!1:"image"!==n.type&&"dropdown"!==n.type&&"radio"!==n.type&&"checkbox"!==n.type||(n.required&&0===n.answerKeys.length?n.error=!0:n.error=!1),C((function(t){return j(j({},t),{},(0,u.Z)({},e[r],n))}))},n=0;n<e.length;n++)r(n)},he=function(){var e=(0,l.Z)(m().mark((function e(r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.xc)(r).then((function(e){0===e.resultCode?R(e.resultDescription):B(e.resultDescription)})).catch((function(e){B(e.resultMessage)})).finally((function(){return setTimeout((function(){n.push("/home/survey/submit-survey")}),1500)}));case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();function ye(e,r){return we.apply(this,arguments)}function we(){return(we=(0,l.Z)(m().mark((function e(n,t){var a,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=m().mark((function e(a){var o,s,l;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("image"===N[n[a]].type&&N[n[a]].answerKeys.length>0)){e.next=9;break}for(o=new FormData,s=0;s<N[n[a]].answerKeys.length;s++)o.append("files",N[n[a]].answerKeys[s],N[n[a]].fileNames[s]);return o.append("uploadedBy","user"),o.append("uploadedFor","user"),o.append("resourceOwner","user"),o.append("data","{}"),e.next=9,(0,w.cT)(o,"survey").then((function(e){if(0===e.resultCode){var r=e.resourceData.map((function(e){return e.resourceId}));N[n[a]].textAnswer=r.join("|"),N[n[a]].answerKeys=[],N[n[a]].answerValues=[]}})).catch((function(e){B(r("imageResourceUploadFailedTryAgain"))}));case 9:l={questionId:N[n[a]].questionId,fieldNature:N[n[a]].fieldNature,scorable:N[n[a]].scorable,answerKeys:N[n[a]].answerKeys,answerValues:N[n[a]].answerValues,textAnswer:N[n[a]].textAnswer},t.push(l);case 11:case"end":return e.stop()}}),e)})),o=0;case 2:if(!(o<n.length)){e.next=7;break}return e.delegateYield(a(o),"t0",4);case 4:o++,e.next=2;break;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(){return(xe=(0,l.Z)(m().mark((function e(){var n,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object.keys(N),L(!0),P||ge(n),!0!==Ze(n)){e.next=8;break}B(r("fillAllRequiredFields")),e.next=15;break;case 8:return U(!0),a=[],e.next=12,ye(n,a);case 12:return e.next=14,he({answers:a,surveyId:b.surveyId,surveyDocId:t,tripId:le,surveyorId:X,surveyeeId:Q});case 14:U(!1);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ze=function(e){for(var r=0;r<e.length;r++)if(1==N[e[r]].error)return!0;return!1};return o().createElement(o().Fragment,null,null==k?void 0:k.map((function(n,t){return o().createElement(x.Z,{container:!0,key:t},Object.keys(N).length>0&&o().createElement(o().Fragment,null,n.questions.map((function(n,t){return"autopick"!==n.data.fieldNature?o().createElement(o().Fragment,{key:t},o().createElement(g.Z,{key:n.id+"_1",className:e.title,color:"primary",variant:"body2"},r("questionNo")+" ".concat(N[n.id].index)),o().createElement(x.Z,{item:!0,key:t,lg:12,md:12,sm:12},o().createElement(M,{className:e.rowSpacing,key:n.id,options:n.data.options,name:n.data.name,type:n.data.type,data:n.data,answers:N,onRadioChange:de,handleTextChange:ue,id:n.id,handleCheckBoxChange:me,handleDropdownChange:fe,handleImageChange:ve,onImageDelete:pe,handleDecimalChange:ce}))):null}))))})),o().createElement(x.Z,null,o().createElement(h.Z,{variant:"contained",color:"primary",className:e.buttonSpacing,onClick:function(){return xe.apply(this,arguments)},disabled:Ze(Object.keys(N))||_},r("submit"))))},A=function(){var e=(0,s.useTranslation)().t;return a.createElement(t.SeamlessContainer,{title:e("submitSurvey"),description:e("submitSurveyDescription")},a.createElement("div",{style:{height:"100%",marginTop:"10px"}},a.createElement(R,null)))}}}]);