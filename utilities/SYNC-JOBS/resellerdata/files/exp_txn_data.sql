select t2.accountId as 'accountId', t2.balanceAfter as 'balance',t2.accountTypeId,t2.createDate from accountmanagement.transactions t2 inner join( select max(t1.transactionKey) as transactionKey , t1.accountId from accountmanagement.transactions t1 where t1.createDate between DATE_SUB(DATE_FORMAT(now(),'%Y-%m-%d %k:00:00'),INTERVAL 1 HOUR) AND DATE_SUB(DATE_FORMAT(now(),'%Y-%m-%d %k:59:59'),INTERVAL 1 HOUR) group by t1.accountId) temp on temp.transactionKey = t2.transactionKey and temp.accountId=t2.accountId ;
